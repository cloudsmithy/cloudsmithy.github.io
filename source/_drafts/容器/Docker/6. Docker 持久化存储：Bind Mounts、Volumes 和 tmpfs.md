---
abbrlink: '0'
---
### Docker 持久化存储：Bind Mounts、Volumes 和 tmpfs

在 Docker 中，容器的存储是一个常见且重要的话题。在本节课程中，我们将讨论 Docker 提供的三种主要存储选项：**Bind Mounts**、**Volumes** 和 **tmpfs**，以及它们的适用场景。

#### 1. **Bind Mounts**

**Bind Mounts** 是一种非常基础的存储方式，它允许将宿主机上的文件或目录挂载到容器内。与宿主机上的文件直接映射，所以容器停止后，数据仍然保存在宿主机中。

- **优点**：非常适合开发环境，特别是当你需要频繁修改代码时，容器内的代码可以直接映射到宿主机上，不需要重建镜像。
- **缺点**：绑定挂载路径必须是宿主机上的绝对路径，这意味着它们不太适合在不同平台或环境中使用。

在实际应用中，**Bind Mounts** 适用于开发阶段，能够方便地共享宿主机与容器之间的文件。下面我们看一下如何使用 `Bind Mounts`。

##### 示例：使用 Bind Mounts

首先，我们创建一个简单的 Go 应用，它会循环写入文件，并输出容器的主机名和计数值。我们会在容器中挂载一个目录，并将输出文件写入该目录。

1. 创建 Dockerfile

```Dockerfile
FROM scratch
COPY webapp /webapp
CMD ["/webapp", "/logs/myapp"]
```

2. 创建 `Bind Mounts` 目录

```bash
mkdir -p /var/demo/logs
```

3. 使用 `docker run` 启动容器并挂载 `Bind Mount`：

```bash
docker run -v /var/demo/logs:/logs scratch_volume
```

此时，容器内的 `/logs` 目录挂载到宿主机的 `/var/demo/logs` 目录，容器会将数据写入该文件夹中。

#### 2. **Volumes**

相比于 **Bind Mounts**，**Volumes** 提供了更高层次的抽象，由 Docker 管理宿主机上的存储。使用 volumes 时，用户无需关心宿主机的文件路径，Docker 会自动管理文件存储。对于跨平台和生产环境而言，**Volumes** 是一种更好的选择。

- **优点**：Docker 管理存储位置，能够更灵活地使用外部存储机制，如 Amazon S3、Google Cloud Storage 等。
- **缺点**：相比于 Bind Mounts，配置稍微复杂，但它为持久化存储提供了更多的安全性和跨平台支持。

##### 示例：使用 Volumes

1. 使用 Docker 命令创建一个 volume：

```bash
docker volume create logs
```

2. 启动容器并挂载 volume：

```bash
docker run -v logs:/logs ubuntu_networking
```

此时，数据会被写入 Docker 管理的 volume 中，而不依赖于宿主机的路径。

3. 通过 `docker volume ls` 查看和管理 volumes：

```bash
docker volume ls
```

#### 3. **tmpfs**

**tmpfs** 是一种临时文件系统，它将文件存储在内存中。与 **Bind Mounts** 和 **Volumes** 不同，tmpfs 存储的数据只在容器运行期间有效，容器停止后，数据会丢失。因此，**tmpfs** 非常适合存储敏感信息，如访问令牌、密码等。

- **优点**：数据存储在内存中，不会写入磁盘，适用于需要快速存储和访问的场景，特别是敏感数据。
- **缺点**：数据不持久，仅在容器运行时有效，容器停止后会丢失。

##### 示例：使用 tmpfs

1. 启动一个使用 tmpfs 存储的容器：

```bash
docker run --mount type=tmpfs,destination=/logs ubuntu_networking
```

2. 容器停止后，内存中的数据会丢失。运行以下命令查看存储数据：

```bash
docker ps -a
```

#### 总结

- **Bind Mounts**：适用于开发环境，可以轻松将宿主机文件夹映射到容器，方便实时更新代码。
- **Volumes**：由 Docker 管理的持久化存储，更适合生产环境和跨平台使用，支持多种外部存储驱动。
- **tmpfs**：临时内存存储，适用于存储敏感数据，只在容器运行时有效。

在实际使用中，**Volumes** 是最推荐的选择，因为它能有效地管理持久数据存储，并且更加灵活。而 **tmpfs** 适用于存储临时和敏感信息，**Bind Mounts** 则适用于开发阶段。
