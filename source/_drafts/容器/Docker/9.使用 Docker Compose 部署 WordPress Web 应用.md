---
abbrlink: '0'
---
# 使用 Docker Compose 部署 WordPress Web 应用

在本节课程中，我们将深入了解如何使用 **Docker Compose** 部署一个 Web 应用。我们将通过一个实际的例子来展示如何配置和管理多容器环境。与之前的课程相比，本节课程更注重实践操作，我们将主要通过命令行来操作并修改 **Compose 文件**。

## 1. 介绍 WordPress Web 应用

**WordPress** 是一个流行的内容管理系统（CMS），用于创建网站和博客。WordPress 是用 **PHP** 编写的，并且使用 **MySQL** 作为数据库。Docker 提供了官方的 **WordPress** 和 **MySQL** 镜像，这些镜像在 **Docker Hub** 上拥有超过 1000 万次拉取次数。

在本节课程中，我们将使用 Docker Compose 来部署一个包含 WordPress 和 MySQL 服务的多容器应用。我们将通过配置 Compose 文件和命令行来创建、管理和部署这两个服务。

## 2. WordPress 的 Docker Compose 配置文件

在 **docker-compose.yml** 文件中，我们定义了两个服务：**db**（MySQL 数据库）和 **wordpress**（WordPress 应用）。以下是我们使用的 Compose 文件内容：

```yaml
version: "3.0"

services:
  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: example
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
    volumes:
      - db_data:/var/lib/mysql
    restart: always

  wordpress:
    image: wordpress:latest
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_NAME: wordpress
      WORDPRESS_DB_USER: wordpress
      WORDPRESS_DB_PASSWORD: wordpress
    ports:
      - "8000:80"
    depends_on:
      - db
    restart: always

volumes:
  db_data:
```

### 配置文件解析：

- **version**: 使用版本 3.0 的 Compose 文件格式。
- **db 服务**: 使用 MySQL 5.7 镜像，设置数据库的环境变量，包括用户名和密码。
- **wordpress 服务**: 使用 WordPress 镜像，并配置与 MySQL 数据库的连接。
- **volumes**: 为 MySQL 配置了一个命名卷 `db_data`，用于持久化数据库数据。
- **depends_on**: 确保 WordPress 服务在 MySQL 服务启动后再启动。
- **ports**: 将 WordPress 服务的端口映射到宿主机的 8000 端口。

## 3. 启动应用

### 启动命令

在命令行中，我们可以使用以下命令启动应用：

```bash
docker-compose -f wordpress.yml up -d
```

这条命令会：

1. 拉取 MySQL 和 WordPress 镜像。
2. 启动 **db** 和 **wordpress** 服务。
3. 在后台模式运行容器（`-d` 参数）。

### 验证应用是否运行

启动容器后，我们可以通过访问浏览器中的 `http://localhost:8000` 来验证 WordPress 是否成功部署。如果是第一次使用 WordPress，系统会要求进行一些基本配置，如语言选择、站点标题和管理员信息。配置完成后，您将能够看到 WordPress 的管理界面。

## 4. Docker Compose 的变更检测

Docker Compose 会自动检测配置文件的变化。如果我们修改了 **wordpress.yml** 文件，比如更新了 WordPress 镜像的版本标签（`latest`），我们可以执行以下命令来更新服务：

```bash
docker-compose up -d
```

Compose 会检测到配置的变化，只重新创建有变化的容器。例如，WordPress 容器会被重新创建，而 MySQL 容器则不会重新启动。

### 强制重建容器

如果需要强制重建所有容器（即使它们的配置没有变化），可以使用 `--force-recreate` 参数：

```bash
docker-compose up -d --force-recreate
```

### 停止并删除容器

要停止并删除所有服务的容器和网络，可以使用 `down` 命令：

```bash
docker-compose down
```

默认情况下，`down` 命令只会删除容器和网络，但会保留卷和镜像。我们可以使用 `--rmi all` 参数删除所有镜像，使用 `--volumes` 删除卷，使用 `--remove-orphans` 删除未定义的容器：

```bash
docker-compose down --rmi all --volumes --remove-orphans
```

## 5. 总结

通过 Docker Compose 部署 WordPress 应用非常简单，我们只需要编写一个 `docker-compose.yml` 配置文件，并通过 `docker-compose up` 命令启动容器。在本节课程中，我们完成了以下任务：

- 配置 WordPress 和 MySQL 容器。
- 使用 Docker Compose 启动和管理应用。
- 通过 `docker-compose` 命令验证应用是否正常运行。
- 学习了如何修改配置文件并使用变更检测自动更新容器。

在下一节课中，我们将讨论如何使用 Dockerfile 构建自定义镜像，并进一步优化我们的开发和生产环境。
