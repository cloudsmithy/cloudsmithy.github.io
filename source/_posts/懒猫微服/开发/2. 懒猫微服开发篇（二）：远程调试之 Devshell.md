---
title: æ‡’çŒ«å¾®æœå¼€å‘ç¯‡ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹è°ƒè¯•ä¹‹ Devshell
tags: å¼€å‘
toc: true
categories: æ‡’çŒ«å¾®æœ
date: 2025-07-03 00:00:00
---

æˆ‘ä»¬ä¸Šä¸€ç¯‡è®²è¿°äº†å¦‚ä½•æ‰“åŒ…ä¸Šæ¶ APPï¼Œè¿™æœŸæˆ‘ä»¬å°±æ¥çœ‹å¦‚ä½•è¿œç¨‹è°ƒè¯•å³å°†ä¸Šæ¶çš„ APPã€‚

ç®€å•æ¥è®²ï¼Œè¿™ä¸ª devshell å…¶å®å°±æ˜¯åœ¨å¾®æœä¸Šæ‰“å¼€äº†ä¸€ä¸ªè™šæ‹Ÿæœºç¯å¢ƒï¼Œç„¶åæˆ‘ä»¬å¯ä»¥è¿›å»é‡Œé¢æµ‹è¯•æˆ‘ä»¬çš„å‘½ä»¤ã€‚éè¦è¯´æŠ€æœ¯å®ç°ï¼Œé‚£å°±æ˜¯ docker exec äº†ã€‚åªä¸è¿‡æ˜¯åšæˆäº†æœ¬åœ°å’Œå¾®æœä¹‹é—´åŒæ­¥çš„æ ·å­ã€‚

è¾“å…¥å¾®æœçš„åå­—/v2/\_catalogï¼Œå¯ä»¥çœ‹åˆ°å¾®æœé‡Œé¢ Docker ä»“åº“å­˜æ”¾çš„é•œåƒï¼Œdebug.bridge å¼€å¤´çš„å°±æ˜¯ devshell çš„ imageã€‚

```json
{
  "repositories": [
    "debug.bridge/231ee20d4e4d8edbd2004e7609fd9c15",
    "debug.bridge/ddc6dbf609125b7bd2c0efb0ed4254d1",
    "helloworld"
  ]
}
```

åœ¨ lzc-build.yml é‡Œå®šä¹‰äº† devshell çš„é…ç½®ï¼Œè¿™ä¸ªçš„æ„æ€æ˜¯å°±æ˜¯å®‰è£… node å’Œ python çš„ç¯å¢ƒï¼Œè®¾ç½®å›½å†…æºï¼Œç„¶åè®²æ ¹ç›®å½•è½¬å‘åˆ° 5173ï¼Œè¿™ä¸ªæ˜¯ vue çš„ç«¯å£ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ª Vue+python çš„å…¨æ ˆé¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼€ä¸¤ä¸ªç»ˆç«¯æ¥è¿›å…¥ devshellï¼Œåˆ†åˆ«è°ƒè¯•å‰åç«¯ã€‚

<!-- more -->

```yml
devshell:
  routes:
    - /=http://127.0.0.1:5173
  dependencies:
    - nodejs
    - npm
    - python3
    - py3-pip
  setupscript: |
    export npm_config_registry=https://registry.npmmirror.com
    export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
```

ä½¿ç”¨ lzc-cli project devshell -f è¿›å…¥ devshellï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªä½¿ç”¨äº† registry.lazycat.cloud/lzc-cli/devshell ä½œä¸º base imageï¼Œç„¶åæ¢æºå®‰è£…ä¾èµ–ã€‚æœ€åè®¾ç½® setupscript é‡Œé¢çš„ ENVã€‚è€Œ CMD ["sleep", "infinity"]`ä¼šè®©å®¹å™¨å¯åŠ¨åæ‰§è¡Œ`sleep infinity` å‘½ä»¤ï¼Œå³æ— é™ä¼‘çœ ã€‚ç›®çš„æ˜¯é˜²æ­¢å®¹å™¨å› æ²¡æœ‰å‰å°è¿›ç¨‹è€Œè‡ªåŠ¨é€€å‡ºï¼ˆä¿æŒå®¹å™¨å¤„äºâ€œè¿è¡Œâ€çŠ¶æ€ï¼‰ã€‚

è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ åœ¨ lzc-manifest.yml é‡ŒæŒ‡å®šäº† routes ä¹ŸåŒæ ·ä¼šç”Ÿæ•ˆã€‚å¦‚æœä½ è¦è·‘ä¸€äº›åˆå§‹åŒ–è„šæœ¬ï¼Œå¯ä»¥åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªåŠæ³•

1.  åœ¨ lzc-manifest.yml æ–‡ä»¶ä¸­ä½¿ç”¨/api/=exec://3000,./lzcapp/pkg/content/backend/run.sh
2.  lzc-build.yml ä¸­æ³¨å…¥è„šæœ¬ setupscriptã€‚

å¦‚æœä½ å·æ‡’åœ¨ lzc-build.yml é‡Œ routes çš„æ‰§è¡Œ/api/=exec://3000,./lzcapp/pkg/cache/backend/run.shï¼Œä¼¼ä¹ä¹Ÿåªèƒ½è½¬å‘ç«¯å£ï¼Œä¸èƒ½è¿è¡Œè„šæœ¬ã€‚

ä»æ—¥å¿—çœ‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜æ˜¯å®‰è£…äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸Šå»ï¼Œåªä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»ä¼¼ ssh remote çš„æ–¹å¼æ¥åŠ¨æ€è°ƒè¯•ã€‚å¦‚æœ APP ä¸Šæ¶ä¹‹åï¼Œèƒ½åšçš„ææ€•åªæœ‰ lzc-docker exec äº†ã€‚

```
è·³è¿‡æ‰§è¡Œ buildscript
è·³è¿‡æ‹·è´ contentdir å†…å®¹

Dockerfile
STEP 1/4: FROM registry.lazycat.cloud/lzc-cli/devshell:v0.0.5
STEP 2/4: RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories
--> Using cache 2302149ded79afb639f9935a07e7ea0d63b5644b10e9890d49ad06786e7b31db
--> 2302149ded79
STEP 3/4: RUN apk add --no-cache bash nodejs npm py3-pip python3   && echo "root:root" | chpasswd
--> Using cache 9bb679fa2c9d10ab1a2433be4c59c852affb2a6844c62ecd9eb8d727505821fb
--> 9bb679fa2c9d
STEP 4/4: CMD ["sleep", "infinity"]
--> Using cache 5ed701af0e0f7040c3dc5409f547b271b4f4e792fd4fcbfc4af8a3abecf8d363
COMMIT debug.bridge/ddc6dbf609125b7bd2c0efb0ed4254d1:latest
--> 5ed701af0e0f
Successfully tagged debug.bridge/ddc6dbf609125b7bd2c0efb0ed4254d1:latest
5ed701af0e0f7040c3dc5409f547b271b4f4e792fd4fcbfc4af8a3abecf8d363
Getting image source signatures
Copying blob sha256:c164879b06ca56693b742ec917059cce495320d4d8f6140bde7e875f53377ea1
Copying blob sha256:69bc8c25bce956e4c34fdfee091c531ffa8660454526ea9f76c956f9b930c57b
Copying blob sha256:98e60e58e2d093fd95b5d5d61ae6dac25bff89ba1b46d42395d480dfb75bddab
Copying blob sha256:d4fc045c9e3a848011de66f34b81f052d4f2c15a17bb196d637e526349601820
Copying blob sha256:b244bd08b327b00bfbbbbf4f424ade914ee891a52d9192a573dbe484e22d86ab
Copying config sha256:5ed701af0e0f7040c3dc5409f547b271b4f4e792fd4fcbfc4af8a3abecf8d363
Writing manifest to image destination
è¾“å‡ºlpkåŒ… /Users/xu/Desktop/todolist-py-lzcapp-demo/cloud.lazycat.app.todolistpy-v0.0.1.lpk
å¼€å§‹éƒ¨ç½²åº”ç”¨
å¼€å§‹å®‰è£…åº”ç”¨


å®‰è£…æˆåŠŸï¼
ğŸ‘‰ è¯·åœ¨æµè§ˆå™¨ä¸­è®¿é—® https://todolistpy.dev.heiyu.space
ğŸ‘‰ å¹¶ä½¿ç”¨å¾®æœçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•

+ export 'npm_config_registry=https://registry.npmmirror.com'
+ export 'PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple'
+ set -e
+ mkdir -p /lzcapp/cache/devshell

+ cd /lzcapp/cache/devshell
+ exec /bin/sh
/lzcapp/cache/devshell #
/lzcapp/cache/devshell # ls
README.md         backend           build.sh          lzc-build.yml     lzc-icon.png      lzc-manifest.yml  ui

```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤¹çš„å†…å®¹å·²ç»è¢«åŒæ­¥è¿‡æ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥å®æ—¶åŒæ­¥å¼€å‘æœºæ–‡ä»¶çš„åˆ›å»ºå’Œä¿®æ”¹ã€‚ä¸è¿‡ç›®å‰å’Œç§»åŠ¨ï¼Œé‡å‘½åç›¸å…³çš„åŒæ­¥æœ‰ç‚¹å°é—®é¢˜ï¼Œå…·ä½“è¡¨ç°ä¸º

1. æœ¬åœ°åˆ é™¤æ—§çš„æ–‡ä»¶ï¼Œä½†æ˜¯ devshell é‡Œä¸ä¼šåŒæ­¥åˆ é™¤
2. åˆ é™¤æ–‡ä»¶ aï¼Œä½†æ˜¯æŠŠ b é‡åä¸º aï¼Œdevshell ä¸ä¼šåŒæ­¥æ›´æ”¹ï¼ˆä½†æ˜¯åˆ é™¤ a é‡å»ºå¯ä»¥ï¼‰

ç›¸ä¿¡è¿™ä¸¤ä¸ªå°é—®é¢˜ä¿®å¥½ä¹Ÿåªæ˜¯æ—¶é—´é—®é¢˜ï¼Œå½“ç„¶ä¹Ÿæœ‰ workaroundã€‚

ä»/data/app/cache/åŒ…åè¿™ä¸ªç›®å½•åˆ é™¤ devshell æ–‡ä»¶å¤¹ä¹‹åï¼Œç„¶åé‡æ–°æ‰§è¡Œ lzc-cli project devshell -f ï¼Œè¿™æ ·å·¥ä½œåŒºå°±è¢«æ¸…ç†å¹²å‡€äº†ã€‚

```bash
(base) lzcbox-029c588e /data/app/cache/cloud.lazycat.app.todolistpy # ls
devshell
(base) lzcbox-029c588e /data/app/cache/cloud.lazycat.app.todolistpy # cd devshell/
(base) lzcbox-029c588e /data/app/cache/cloud.lazycat.app.todolistpy/devshell # ls
1  1312  README.md  backend  build.sh  lzc-build.yml  lzc-icon.png  lzc-manifest.yml  ui
```

å¦å¤–ï¼Œæˆ‘ä»¬å†é€šè¿‡ ssh è¿›å…¥/data/app è¿™ä¸ªç›®å½•ï¼Œæœ‰ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ï¼Œä¸€ä¸ªå«åš cacheï¼Œä¸€ä¸ªå«åš varã€‚ cache å°±æ˜¯æˆ‘ä»¬è¿™ä¸ª devshell çš„å·¥ä½œåŒºã€‚var å°±æ˜¯æ•°æ®æŒä¹…åŒ–çš„ç›®å½•ã€‚å¦‚æœåœ¨è¿™é‡Œæ–°å»ºä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ç½‘ç›˜é‡Œå®æ—¶çœ‹åˆ°ã€‚

```bash
 /data/app/var/xu.deploy.lazycat-nav # touch test
```

![image-20250702063901802](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20250702063901802.png)

ä»¥ä¸Šå°±æ˜¯ devshell çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœä½ éœ€è¦å€ŸåŠ©å¾®æœçš„ä¸€äº›ç‰¹æ€§è¿˜è¿›è¡Œå¼€å‘ï¼Œæ¯”å¦‚è·å–ç¯å¢ƒå˜é‡ï¼ŒOIDC ä»€ä¹ˆçš„ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥è½»æ¾è°ƒè¯•ã€‚
