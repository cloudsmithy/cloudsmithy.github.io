---
title: æ‡’çŒ«å¾®æœè¿›é˜¶å¿ƒå¾—ï¼ˆå››ï¼‰ï¼šæ¯æ¬¡é‡å¯éƒ½ä¸¢é…ç½®ï¼Ÿç”¨ systemctl --user è‡ªåŠ¨è£…å›ç¯å¢ƒï¼
tags: Linux
toc: true
categories: æ‡’çŒ«å¾®æœ
date: 2025-07-02 00:00:00
---

åœ¨æ‡’çŒ«å¾®æœä¸­ï¼Œä¸ºäº†é˜²æ­¢ç”¨æˆ·è¯¯æ“ä½œç ´åç³»ç»Ÿï¼Œé»˜è®¤å¯ç”¨äº†â€œ**é‡å¯è¿˜åŸæœºåˆ¶**â€â€”â€”æ¯æ¬¡é‡å¯éƒ½ä¼šè¿˜åŸå¤§éƒ¨åˆ†ç³»ç»Ÿæ”¹åŠ¨ã€‚ä¸è¿‡ï¼Œ**ç”¨æˆ·ä¸»ç›®å½•çš„æ•°æ®æ˜¯ä¿ç•™çš„**ï¼ˆä¾‹å¦‚ `/root/`ï¼‰ï¼Œè¿™å°±ç»™æˆ‘ä»¬ç•™ä¸‹äº†ä¸€æ¡ç”Ÿè·¯ã€‚

ä»¥å¾€æ¯æ¬¡é‡å¯åï¼Œæˆ‘éƒ½è¦æ‰‹åŠ¨é‡æ–°å®‰è£… `htop`ã€`sudo`ã€`httpie` ç­‰å·¥å…·ï¼Œé‡å¤æ“ä½œå®åœ¨éº»çƒ¦ã€‚ä¹‹å‰åœ¨ VIP ç¾¤é‡Œæ²Ÿé€šè¿‡èƒ½å¦å…è®¸ä½¿ç”¨ `systemctl` è‡ªå¯è„šæœ¬ï¼Œç°åœ¨ç»ˆäºæ”¯æŒäº† `systemctl --user` çš„å¼€æœºå¯åŠ¨åŠŸèƒ½ï¼Œç¬¬ä¸€æ—¶é—´æ¥ä½“éªŒä¸€ä¸‹ï¼

---

## ğŸ’» å®‰è£…è„šæœ¬ init.sh

æˆ‘ä»¬æŠŠéœ€è¦å®‰è£…çš„è½¯ä»¶ç»Ÿä¸€å†™è¿›ä¸€ä¸ªè„šæœ¬ï¼Œåªå®‰è£…æœªå®‰è£…çš„éƒ¨åˆ†ï¼Œé¿å…é‡å¤æµªè´¹æ—¶é—´ã€‚åŒæ—¶ä¹Ÿæ”¯æŒè¿œç¨‹å®‰è£…ä¸€äº›å·¥å…·ï¼Œä¾‹å¦‚ `superfile`ã€‚

<!-- more -->

```bash
#!/usr/bin/env bash
set -e  # ä»»æ„æ­¥éª¤å¤±è´¥ç«‹å³ç»ˆæ­¢

PACKAGES=(
  sudo
  htop
  wget
  build-essential
  httpie
  exa
  duf
  bat
  # å¯ä»¥ç»§ç»­æ·»åŠ ï¼šdocker.io nodejs ...
)

need_install=()

for pkg in "${PACKAGES[@]}"; do
  if ! dpkg -s "$pkg" &>/dev/null; then
    need_install+=("$pkg")
  fi
done

if (( ${#need_install[@]} )); then
  echo "==> Installing: ${need_install[*]}"
  apt-get update
  DEBIAN_FRONTEND=noninteractive apt-get install -y "${need_install[@]}"
else
  echo "==> All packages already installed."
fi

# å®‰è£… Superfile å·¥å…·
if command -v curl &>/dev/null; then
  echo "==> Installing Superfile (from https://superfile.netlify.app)"
  bash -c "$(curl -sLo- https://superfile.netlify.app/install.sh)"
else
  echo "âŒ curl not found, skipping Superfile install"
fi
```

ä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬ä¿å­˜ä¸º `/root/init.sh`ï¼ˆæ‡’çŒ«å¾®æœä¼šä¿ç•™è¿™ä¸ªè·¯å¾„ï¼‰ï¼Œå¹¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼š

```bash
chmod +x /root/init.sh
```

---

## âš™ systemd ç”¨æˆ·æœåŠ¡é…ç½®

ç”±äºæ‡’çŒ«å¾®æœç°åœ¨æ”¯æŒ `systemctl --user`ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç”¨æˆ·çº§ systemd æœåŠ¡åœ¨ç™»å½•åè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ã€‚

åœ¨ `~/.config/systemd/user/` ç›®å½•ä¸‹åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
mkdir -p ~/.config/systemd/user
vim ~/.config/systemd/user/bootstrap-packages.service
```

å†…å®¹å¦‚ä¸‹ï¼š

```ini
[Unit]
Description=Bootstrap Required Packages

[Service]
Type=oneshot                  # å…³é”®ä¿®æ”¹ï¼è¡¨ç¤ºä¸€æ¬¡æ€§ä»»åŠ¡
ExecStart=/root/init.sh
RemainAfterExit=yes           # ä»»åŠ¡å®Œæˆåä»æ ‡è®°ä¸º "active"ï¼ˆå¯é€‰ï¼‰
# Restart=no                 # é»˜è®¤å°±æ˜¯ noï¼Œå¯çœç•¥

[Install]
WantedBy=default.target
```

æ³¨æ„äº‹é¡¹ï¼š

- `ExecStart` ä½¿ç”¨ `/root/init.sh` æ˜¯å› ä¸ºæ‡’çŒ«å¾®æœé‡å¯ä¸ä¼šæ¸…ç©º root ç›®å½•ï¼›
- è¿™æ˜¯ä¸€ä¸ª **oneshotï¼ˆä¸€æ¬¡æ€§ä»»åŠ¡ï¼‰**ï¼Œè¿è¡Œå®Œå°±é€€å‡ºï¼›
- `default.target` æ˜¯ç”¨æˆ·çº§åˆ«çš„â€œç™»å½•åå¯åŠ¨â€ç›®æ ‡ã€‚

---

## ğŸ§ª å¯ç”¨å’Œè°ƒè¯•æœåŠ¡

é…ç½®å¥½ä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å¹¶è®¾ç½®è‡ªåŠ¨è¿è¡Œï¼š

```bash
systemctl --user daemon-reload                       # é‡æ–°åŠ è½½ç”¨æˆ·æœåŠ¡é…ç½®
systemctl --user start bootstrap-packages.service    # æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ï¼ˆæµ‹è¯•ç”¨ï¼‰
systemctl --user status bootstrap-packages.service   # æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—
systemctl --user enable bootstrap-packages.service   # è®¾ç½®ç™»å½•åè‡ªåŠ¨è¿è¡Œ
```

### ç¤ºä¾‹è¿è¡Œç»“æœï¼š

```bash
systemctl --user start bootstrap-packages.service
systemctl --user status bootstrap-packages.service
```

è¾“å‡ºå¦‚ä¸‹ï¼š

```
â—‹ bootstrap-packages.service - Bootstrap Required Packages
     Loaded: loaded (/root/.config/systemd/user/bootstrap-packages.service; enabled; preset: enabled)
     Active: inactive (dead) since Thu 2025-05-29 20:13:58 CST; 941ms ago
   Duration: 6.438s
    Process: 142818 ExecStart=/root/init.sh (code=exited, status=0/SUCCESS)
   Main PID: 142818 (code=exited, status=0/SUCCESS)
        CPU: 350ms

May 29 20:13:53 lzcbox-029c588e init.sh[142926]: Downloading superfile v1.3.1 for linux (amd64)...
May 29 20:13:58 lzcbox-029c588e init.sh[142926]: Installing superfile...
May 29 20:13:58 lzcbox-029c588e init.sh[142926]: ğŸ‰ Installation complete!
May 29 20:13:58 lzcbox-029c588e init.sh[142926]: You can type "spf" to start!
```

å›¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­ç»ˆç«¯è‡ªåŠ¨æ‹‰èµ·ï¼‰ï¼š

![image-20250529201226160](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20250529201226160.png)

---

## ğŸš€ å°ç»“

| æ­¥éª¤              | å‘½ä»¤                                                    |
| ----------------- | ------------------------------------------------------- |
| è®¾ç½® systemd æœåŠ¡ | `vim ~/.config/systemd/user/bootstrap-packages.service` |
| æµ‹è¯•è¿è¡Œ          | `systemctl --user start bootstrap-packages.service`     |
| è®¾ç½®ç™»å½•è‡ªå¯      | `systemctl --user enable bootstrap-packages.service`    |
| æŸ¥çœ‹è¿è¡ŒçŠ¶æ€      | `systemctl --user status bootstrap-packages.service`    |

æ­é…æ‡’çŒ«å¾®æœçš„ root æŒä¹…ç­–ç•¥å’Œ systemd ç”¨æˆ·æœåŠ¡åŠŸèƒ½ï¼Œæˆ‘ä»¬ç»ˆäºå®ç°äº†ï¼š**é‡å¯è‡ªåŠ¨æ¢å¤å¼€å‘ç¯å¢ƒï¼Œä¸ç”¨æ¯æ¬¡æ‰‹åŠ¨è£…åŒ…äº†ï¼**

![77dea8a6a38817c503c379dd946fc9e4.png](https://lzc-playground-1301583638.cos.ap-chengdu.myqcloud.com/guidelines/459/e8de34ec-0ad7-4b80-b518-36c786746db5.png "77dea8a6a38817c503c379dd946fc9e4.png")
