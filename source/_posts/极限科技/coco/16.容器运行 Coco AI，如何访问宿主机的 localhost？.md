# 容器运行 Coco AI，如何访问宿主机的 localhost？

使用容器确实方便了很多事情，但在网络访问上可能会引出一些麻烦。
如果你的调试服务只监听在宿主机的 `localhost`，那么在容器里访问时，会找的是**容器自己的 localhost**，所以无法连通。

因为无论是 Coco server 还是 Console 都是服务端发送请求，所以我统一记录下来。

下面介绍几种在不同环境下的解决方案。

## 1. Mac 的 Orbstack

在 **Orbstack** 环境中，可以使用 `host.docker.internal` 代替宿主机的 `localhost`。
例如访问宿主机的 Hexo 服务（`http://localhost:4000/atom.xml`）时，直接这样写：

```bash
http://host.docker.internal:4000/atom.xml
```

<!-- more -->

`host.docker.internal` 会被解析到宿主机 IP，相当于容器内部的 “localhost”。

![访问示意图](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/cf47a2848159ca48875d50f232716fe2.png)

---

## 2. Linux 下单容器运行

在 Linux 环境中，`host.docker.internal` 默认可能不可用，可以用以下方法：

### 方法 1：`--add-host`

运行容器时显式添加：

```bash
docker run --add-host=host.docker.internal:host-gateway ...
```

容器里访问：

```bash
curl http://host.docker.internal:4000/atom.xml
```

### 方法 2：`--network host`

在本地调试时让容器和宿主机共用网络命名空间：

```bash
docker run --network host ...
```

这样容器里的 `localhost:4000` 就等于宿主机的 `localhost:4000`。
⚠️ 缺点：端口可能冲突，不建议在生产环境使用。

---

## 3. Docker Compose 下多容器访问宿主机

在 **Linux + docker-compose** 场景下，容器访问宿主机的 `localhost` 同样需要绕过。可以使用以下几种方式（推荐优先使用前两种）：

### 方案 1：`host.docker.internal`

```yaml
version: "3.8"
services:
  myservice:
    image: your-image
    extra_hosts:
      - "host.docker.internal:host-gateway"
```

容器里访问：

```bash
curl http://host.docker.internal:4000/atom.xml
```

### 方案 2：Docker 网桥网关 IP

Linux 默认 `docker0` 网桥的宿主机 IP 通常是 `172.17.0.1`，可用以下命令确认：

```bash
ip addr show docker0
```

容器里直接访问：

```bash
curl http://172.17.0.1:4000/atom.xml
```

⚠️ 缺点：如果 Docker 网络结构改动，IP 可能变化。

### 方案 3：`network_mode: host`

```yaml
services:
  myservice:
    image: your-image
    network_mode: host
```

容器内的 `localhost:4000` 直接访问宿主机服务。
⚠️ 缺点同上，失去网络隔离，端口冲突风险高。

### 方案 4：绑定 Hexo 到 `0.0.0.0` 并用局域网 IP

容器里访问：

```bash
curl http://192.168.x.x:4000/atom.xml
```

其中 `192.168.x.x` 为宿主机的局域网 IP。

💡 **建议**：如果 Compose 版本 ≥ 3.4，优先使用 **方案 1**。写死 `host.docker.internal` 后，即使宿主机 IP 变化，也能稳定访问。

通过上面的几种方式，无论是在 **Orbstack**、**Linux 单容器** 还是 **Docker Compose** 场景下，都能找到合适的方法让容器访问宿主机的 `localhost` 服务。
日常调试时，推荐优先使用 `host.docker.internal`（配合 `--add-host` 或 Compose 的 `extra_hosts`），既稳定又无需记 IP；
在容器之间互访，则直接使用 **服务名/容器名**，让 Docker 自带的 DNS 帮你解析。

掌握这些技巧，既能让 Coco AI 的调试环境跑得顺畅，也能为后续复杂的容器网络架构打好基础。
