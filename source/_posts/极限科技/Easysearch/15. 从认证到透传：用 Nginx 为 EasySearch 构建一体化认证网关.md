---
title: ä»Žè®¤è¯åˆ°é€ä¼ ï¼šç”¨ Nginx ä¸º Easysearch æž„å»ºä¸€ä½“åŒ–è®¤è¯ç½‘å…³
tags: æœç´¢å¼•æ“Žï¼ˆESï¼‰
toc: true
categories: æžé™ç§‘æŠ€
date: 2025-07-02 00:00:00
---

åœ¨æž„å»ºæœ¬åœ°æˆ–äº‘ç«¯æœç´¢å¼•æ“Žç³»ç»Ÿæ—¶ï¼ŒEasySearch å‡­å€Ÿå…¶è½»é‡ã€é«˜æ€§èƒ½ã€æ˜“éƒ¨ç½²ç­‰ä¼˜åŠ¿ï¼Œé€æ¸æˆä¸ºä¼—å¤šå¼€å‘è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…çš„é¦–é€‰ã€‚ä½†åœ¨å®žé™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å€ŸåŠ© Nginx ä¸º EasySearch æä¾›é«˜æ•ˆã€ç¨³å®šä¸”å®‰å…¨çš„è®¿é—®å…¥å£ï¼Œå°¤å…¶æ˜¯åœ¨èº«ä»½è®¤è¯æ–¹é¢ï¼Œä»ç„¶æ˜¯ä¸€ä¸ªå…³é”®æŠ€æœ¯çŽ¯èŠ‚ã€‚

æœ¬æ•™ç¨‹å°†å›´ç»• Basic Auth è®¤è¯æœºåˆ¶å±•å¼€ï¼Œç³»ç»Ÿè®²è§£å¦‚ä½•é€šè¿‡ Nginx å®žçŽ°å®‰å…¨é˜²æŠ¤ã€è®¤è¯ä¿¡æ¯é€ä¼ ç­‰å¸¸è§é…ç½®åœºæ™¯ï¼Œå¸®åŠ©ä½ åœ¨å¤šç§å®žé™…éƒ¨ç½²çŽ¯å¢ƒä¸­å¿«é€Ÿæ­å»ºå¯é çš„è®¿é—®æŽ§åˆ¶æœºåˆ¶ã€‚

æ— è®ºä½ æ˜¯åœ¨æ­å»ºå®¶åº­ NAS æœåŠ¡ï¼Œè¿˜æ˜¯åœ¨ä¼ä¸šçŽ¯å¢ƒä¸­é›†æˆæœç´¢å¼•æ“Žç³»ç»Ÿï¼Œæœ¬æ•™ç¨‹éƒ½èƒ½ä¸ºä½ æä¾›ä¸€å¥—å¯è½åœ°ã€å¯å¤ç”¨çš„ Nginx å®‰å…¨è®¤è¯è§£å†³æ–¹æ¡ˆã€‚ã€‚

ä¸‹é¢æ˜¯æˆ‘çš„ Nginx é…ç½®æ–‡ä»¶ç¤ºä¾‹ã€‚æˆ‘ä»¬é€šè¿‡ Docker å¯åŠ¨ Nginx å®¹å™¨ï¼Œå¹¶å°†æœ¬åœ°ç¼–å†™å¥½çš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä»Žè€Œå®žçŽ°è‡ªå®šä¹‰çš„åå‘ä»£ç†å’Œè®¤è¯é€»è¾‘ï¼š

```bash
docker run -d \
  --name my-nginx \
  -p 80:80 \
  -v $(pwd)/default.conf:/etc/nginx/conf.d/default.conf \
  nginx
```

**default.conf**é…ç½®å¦‚ä¸‹:

```bash
server {
    listen 80;
    server_name localhost;

    # æ ¹è·¯å¾„å¯é€‰é…ç½®ï¼Œå¦‚æžœä½ è¦ä¸€ä¸ªæ¬¢è¿Žé¡µ
    location / {
        return 200 'Nginx is running.\n';
        add_header Content-Type text/plain;
    }

    # åå‘ä»£ç† EasySearch
    location /es/ {
        proxy_pass https://backend:9200/;

        # ä¿®æ­£è¯·æ±‚å¤´
        proxy_http_version 1.1;
        # proxy_pass_request_headers on; Ã·
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # å¦‚æžœéœ€è¦ä¿æ´»è¿žæŽ¥
        proxy_set_header Connection "";

        # å¯é€‰ï¼šå…è®¸è·¨åŸŸè®¿é—®ï¼ˆç”¨äºŽå‰ç«¯ AJAX è°ƒè¯•ï¼‰
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'Authorization,Content-Type';

        # proxy_set_header Authorization "Basic YWRtaW46MTIzNDU2";


        # æ¸…ç†è·¯å¾„å‰ç¼€ `/es/`
        rewrite ^/es/(.*)$ /$1 break;
    }

    # å¯é€‰ï¼šé™æ€èµ„æºæ”¯æŒ
    # location /static/ {
    #     root /usr/share/nginx/html;
    # }
}
```

---

## ðŸŒ é…ç½®æ•´ä½“ç»“æž„

```nginx
server {
    listen 80;
    server_name localhost;
```

- **ç›‘å¬ç«¯å£**ï¼šç›‘å¬æœ¬åœ° `80` ç«¯å£ï¼ˆHTTP é»˜è®¤ç«¯å£ï¼‰
- **æœåŠ¡åç§°**ï¼šç”¨äºŽåŒ¹é…è¯·æ±‚çš„ `Host`ï¼Œè¿™é‡Œæ˜¯ `localhost`

---

## ðŸŽ‰ æ¬¢è¿Žé¡µï¼ˆæ ¹è·¯å¾„ `/`ï¼‰

```nginx
location / {
    return 200 'Nginx is running.\n';
    add_header Content-Type text/plain;
}
```

- è¯·æ±‚ `/` ä¼šè¿”å›žçº¯æ–‡æœ¬å“åº” `"Nginx is running."`ï¼Œå¯ç”¨äºŽéªŒè¯ Nginx æ˜¯å¦å¯åŠ¨æ­£å¸¸ã€‚
- `add_header Content-Type text/plain`ï¼šæŒ‡å®šå“åº”å†…å®¹ä¸ºçº¯æ–‡æœ¬ã€‚

---

## ðŸ” `/es/` ä»£ç† EasySearch åŽç«¯æœåŠ¡

---

### ðŸšš è¯·æ±‚å¤´å¤„ç†

```nginx
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Connection "";
```

- `proxy_http_version 1.1`ï¼šç¡®ä¿ä»£ç†ä½¿ç”¨ HTTP/1.1ï¼Œæ”¯æŒé•¿è¿žæŽ¥ã€‚
- `Host`ï¼šä¿ç•™åŽŸå§‹è¯·æ±‚çš„ä¸»æœºåã€‚
- `X-Real-IP` / `X-Forwarded-For`ï¼šä¼ é€’å®¢æˆ·ç«¯çœŸå®ž IPã€‚
- `X-Forwarded-Proto`ï¼šä¼ é€’åŽŸå§‹åè®®ï¼ˆhttp / httpsï¼‰ã€‚
- `Connection ""`ï¼šç”¨äºŽé¿å…é»˜è®¤çš„ `keep-alive` è®¾ç½®å¼•èµ·é”™è¯¯ï¼ˆæŽ¨èä¿ç•™ï¼‰ã€‚

---

### ðŸ” å¯é€‰çš„è®¤è¯å¤´ï¼ˆæ³¨é‡Šä¸­ï¼‰

```nginx
# proxy_set_header Authorization "Basic YWRtaW46MTIzNDU2";
```

- å¯é€‰å¼€å¯ï¼Œç”¨äºŽå°†è®¤è¯ä¿¡æ¯è½¬å‘åˆ°åŽç«¯ã€‚
- ä¸Šé¢çš„å­—ç¬¦ä¸²æ˜¯ `admin:123456` çš„ base64 ç¼–ç ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¼€å¯ã€‚

---

### ðŸŒ CORS è®¾ç½®ï¼ˆè·¨åŸŸï¼‰

```nginx
add_header Access-Control-Allow-Origin *;
add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
add_header Access-Control-Allow-Headers 'Authorization,Content-Type';
```

- å…è®¸ä»»æ„æºè®¿é—®ï¼ˆå‰ç«¯é¡µé¢å¯ä»¥è·¨åŸŸè¯·æ±‚ `/es/`ï¼‰ã€‚
- æ”¯æŒçš„æ–¹æ³•ï¼šGETã€POSTã€OPTIONSã€‚
- å…è®¸ä¼ é€’çš„è¯·æ±‚å¤´ï¼šAuthorization å’Œ Content-Typeã€‚
- âœ… é€‚ç”¨äºŽ AJAX è°ƒè¯•ã€å‰åŽç«¯åˆ†ç¦»ç­‰åœºæ™¯ã€‚

---

### ðŸ”§ URL é‡å†™

```nginx
rewrite ^/es/(.*)$ /$1 break;
```

- ç§»é™¤ `/es/` å‰ç¼€ï¼Œè½¬å‘ç»™åŽç«¯ã€‚ä¾‹å¦‚ï¼š
  ç”¨æˆ·è¯·æ±‚ `/es/_cat/indices` å®žé™…è½¬å‘åˆ° `/cat/indices`ã€‚
- `break` è¡¨ç¤ºåœ¨å½“å‰ location ä¸­ä¸­æ­¢åŽç»­é‡å†™æ£€æŸ¥ã€‚

---

## ðŸ“¦ å¯é€‰é™æ€èµ„æºï¼ˆè¢«æ³¨é‡ŠæŽ‰ï¼‰

```nginx
# location /static/ {
#     root /usr/share/nginx/html;
# }
```

- è‹¥å¼€å¯ï¼Œå¯ä»¥ç›´æŽ¥é€šè¿‡ `/static/xxx.js` è®¿é—® Nginx æœ¬åœ° `/usr/share/nginx/html/static/xxx.js` æ–‡ä»¶ã€‚

### ðŸ” å¦‚æžœä½ æƒ³ä¿ç•™ `/es/` å‰ç¼€ï¼Œåˆ™åˆ é™¤ `rewrite` è¡Œã€‚

---

åœ¨å¯åŠ¨æœåŠ¡åŽï¼Œå½“æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è®¿é—® Nginx æ—¶ï¼Œé¡µé¢ä¼šå¼¹å‡ºèº«ä»½éªŒè¯çª—å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è®¤è¯æç¤ºå®žé™…ä¸Šæ¥è‡ªåŽç«¯çš„ EasySearch æœåŠ¡ï¼Œè€Œéž Nginx æœ¬èº«ï¼Œè¯´æ˜Žè¯·æ±‚ä¸­çš„è®¤è¯ä¿¡æ¯æœªåœ¨ Nginx å±‚è¢«å¤„ç†æˆ–é€ä¼ ï¼Œå› æ­¤ç”± EasySearch å‘èµ·äº†å†æ¬¡è®¤è¯çš„è¦æ±‚ã€‚

![image-20250424165739653](https://i-blog.csdnimg.cn/img_convert/5177a3d4368af894e60810ed053b2f3a.png)

åœ¨è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç åŽï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Nginx æˆåŠŸä»£ç†è¯·æ±‚ï¼Œå¹¶è¿”å›žäº†æ¥è‡ª EasySearch çš„ API å“åº”ï¼Œè¯´æ˜Žè®¤è¯æµç¨‹å·²é¡ºåˆ©é€šè¿‡ï¼ŒåŽç«¯æœåŠ¡æ­£å¸¸å¯ç”¨ã€‚

![image-20250424165019942](https://i-blog.csdnimg.cn/img_convert/8ed491ae507eb9abd877d5750e8ee6d1.png)

å¦‚æžœå¸Œæœ›ç”± Nginx ä»£ä¸ºå®Œæˆ EasySearch çš„èº«ä»½éªŒè¯ï¼Œä¹Ÿå°±æ˜¯å®žçŽ°è‡ªåŠ¨ç™»å½•çš„æ•ˆæžœï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤ï¼Œå°†è®¤è¯ä¿¡æ¯é€šè¿‡ HTTP å¤´éƒ¨ä¼ é€’ç»™åŽç«¯ï¼š

```
proxy_set_header Authorization "Basic YWRtaW46YWRtaW4=";
```

å…¶ä¸­ï¼Œ`YWRtaW46YWRtaW4xMjM=` æ˜¯ä½¿ç”¨ Base64 ç¼–ç åŽçš„ `ç”¨æˆ·å:å¯†ç ` å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ `admin:admin`ï¼‰ã€‚Nginx åœ¨è½¬å‘è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨æºå¸¦è¯¥ Headerï¼Œä»Žè€Œå®žçŽ°å¯¹ EasySearch çš„è‡ªåŠ¨è®¤è¯ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNginx çš„é…ç½®æ–‡ä»¶ä¿®æ”¹åŽä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚ä¸ºäº†ç¡®ä¿é…ç½®è¢«æ­£ç¡®åŠ è½½ï¼Œéœ€åœ¨æ¯æ¬¡æ›´æ”¹é…ç½®æ–‡ä»¶åŽé‡å¯å¯¹åº”çš„å®¹å™¨æœåŠ¡ã€‚è¿™æ˜¯å®¹å™¨åŒ–éƒ¨ç½²ä¸­å¸¸è§çš„æ“ä½œæµç¨‹ï¼Œç¡®ä¿æ–°é…ç½®è¢«æ­£ç¡®åº”ç”¨ã€‚

![image-20250424165420050](https://i-blog.csdnimg.cn/img_convert/2142ca41f23c0da3a1fd4739ccde906c.png)

ä¸ºäº†æ›´ç›´è§‚åœ°è§‚å¯Ÿè¯·æ±‚è¡Œä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Postman è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥å‘çŽ°ï¼Œå³ä½¿åœ¨ Postman ä¸­æœªæ˜¾å¼æ·»åŠ ä»»ä½•è®¤è¯ä¿¡æ¯ï¼Œä¾ç„¶èƒ½å¤ŸæˆåŠŸè®¿é—® EasySearch é›†ç¾¤ã€‚è¿™è¯´æ˜Žå‰ç«¯æœªè¾“å…¥è®¤è¯ä¿¡æ¯ï¼Œä½†ç”±äºŽ Nginx æ›¾ç»ç¼“å­˜äº†è®¤è¯çŠ¶æ€ï¼Œæˆ–é…ç½®äº†è‡ªåŠ¨é€ä¼ ï¼Œå¯¼è‡´åŽç«¯ä¾æ—§æŽ¥æ”¶åˆ°äº†æœ‰æ•ˆçš„è®¤è¯å¤´ï¼Œä»Žè€Œå…è®¸äº†è®¿é—®ã€‚

è¿™ç§çŽ°è±¡è™½ç„¶åœ¨æµ‹è¯•ä¸­æå‡äº†è®¿é—®ä¾¿åˆ©æ€§ï¼Œä½†åœ¨å®žé™…éƒ¨ç½²ä¸­å¯èƒ½å¸¦æ¥å®‰å…¨é£Žé™©ï¼Œå› æ­¤åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­å»ºè®®å¯¹è®¤è¯æµç¨‹è¿›è¡Œä¸¥æ ¼æŽ§åˆ¶ï¼Œç¡®ä¿åŽç«¯æœåŠ¡ä¸ä¼šå› ä¸ºå‰ç«¯è®¤è¯æœºåˆ¶çš„ç–æ¼è€Œè¢«ç»•è¿‡ã€‚

![image-20250424165032915](https://i-blog.csdnimg.cn/img_convert/207855c26022e0832d615ad792c46410.png)

åœ¨ä¸€äº›æ•™ç¨‹ä¸­ï¼Œå¸¸ä¼šæåˆ°ä¸€ä¸ªåä¸º **`.htpasswd`** çš„æ–‡ä»¶ï¼Œå®ƒç”¨äºŽåœ¨ Nginx å±‚å®žçŽ°åŸºæœ¬è®¤è¯ã€‚å½“å¯ç”¨è¯¥æœºåˆ¶åŽï¼ŒNginx ä¼šå¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ã€‚

æ­¤æ—¶ï¼Œæ˜¯å¦å°†è®¤è¯ä¿¡æ¯é€ä¼ ç»™åŽç«¯æœåŠ¡ï¼Œåˆ™ç”± `proxy_pass_request_headers` å‚æ•°å†³å®šã€‚è¯¥å‚æ•°é»˜è®¤å€¼ä¸º `on`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è®¤è¯é€šè¿‡åŽï¼Œå®¢æˆ·ç«¯å‘é€çš„ Authorization å¤´éƒ¨ä¿¡æ¯ä¼šè¢« Nginx ä¸€å¹¶è½¬å‘ç»™åŽç«¯æœåŠ¡ã€‚

ä¸ºäº†éªŒè¯è¿™ä¸€è¡Œä¸ºï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„ Flask ç¨‹åºä½œä¸ºåŽç«¯ï¼Œç”¨äºŽè§‚å¯Ÿè¯·æ±‚ä¸­çš„ Header å†…å®¹ã€‚åœ¨çœŸæ­£å°†è¯·æ±‚ä»£ç†è‡³ EasySearch ä¹‹å‰ï¼Œæˆ‘å…ˆè®© Nginx å°†è¯·æ±‚åå‘ä»£ç†åˆ°è¿™ä¸ª Flask åº”ç”¨ï¼Œä»Žè€Œå¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ Authorization å¤´è¢«é€ä¼ çš„æƒ…å†µã€‚

```python
from flask import Flask, request,abort
import base64
app = Flask(__name__)

@app.route('/')
def hello_world():
    print("ðŸ“¥ Headers received from Nginx:")
    print("Host:", request.headers.get('Host'))
    print("X-Real-IP:", request.headers.get('X-Real-IP'))
    print("X-Forwarded-For:", request.headers.get('X-Forwarded-For'))
    print("X-Forwarded-Proto:", request.headers.get('X-Forwarded-Proto'))

    print(request.headers)
    auth_header = request.headers.get('Authorization')
    print("Authorization:", auth_header)

    if not auth_header or not auth_header.startswith('Basic '):
        abort(401, description="Missing or invalid Authorization header")

    # è§£ç  base64
    encoded = auth_header.split(' ')[1]
    decoded = base64.b64decode(encoded).decode('utf-8')  # e.g. admin:123456

    username, password = decoded.split(':', 1)
    print(username, password)

    return 'Hello World!'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8000,debug=True)

```

è¿™ä¸ªæ˜¯ flask çš„æ‰“å°çš„ç»“æžœ.

```bash
Host: secure-nginx.orb.local
X-Real-IP: 192.168.215.1
X-Forwarded-For: 192.168.215.1
X-Forwarded-Proto: http
Host: secure-nginx.orb.local
X-Real-Ip: 192.168.215.1
X-Forwarded-For: 192.168.215.1
X-Forwarded-Proto: http
Authorization: Basic YWRtaW46YWRtaW4=
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh-TW;q=0.9,zh;q=0.8
Cookie: perf_dv6Tr4n=1


Authorization: Basic YWRtaW46YWRtaW4=
admin admin
192.168.X.X - - [24/Apr/2025 15:55:59] "GET / HTTP/1.1" 200 -
```

ä¸ºäº†è§£å†³åŒé‡è®¤è¯çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ç”¨äº†è®¤è¯ä¿¡æ¯é€ä¼ çš„é…ç½®(é»˜è®¤çš„ roxy_pass_request_headers on;)ã€‚å¯ç”¨è¯¥é…ç½®åŽï¼Œç”¨æˆ·åªéœ€åœ¨è®¿é—® Nginx æ—¶è¿›è¡Œä¸€æ¬¡æ‰‹åŠ¨èº«ä»½éªŒè¯ã€‚Nginx ä¼šå°†ç”¨æˆ·æä¾›çš„å‡­è¯é€šè¿‡ HTTP Header é€ä¼ è‡³åŽç«¯çš„ EasySearch æœåŠ¡ï¼Œä»Žè€Œé¿å…äºŒæ¬¡è®¤è¯ã€‚å½“ç”¨æˆ·ç›´æŽ¥è®¿é—® EasySearch æ—¶ï¼Œä¾ç„¶éœ€è¦å•ç‹¬è¾“å…¥å‡­è¯è¿›è¡Œè®¤è¯ï¼›ä½†é€šè¿‡ Nginx è®¿é—®æ—¶ï¼Œåªéœ€åœ¨å‰ç«¯è®¤è¯ä¸€æ¬¡å³å¯å®Œæˆæ•´ä¸ªè¯·æ±‚æµç¨‹ã€‚

```bash
curl -k https://easysearch:9200

{"error":{"root_cause":[{"type":"security_exception","reason":"Missing authentication information for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"Security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"Missing authentication information for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"Security\" charset=\"UTF-8\""}},"status":401}âŽ
-------

 curl -v -u "admin:admin" http://nginxhost/es/

*   Trying 192.168.5.171:9201...
* Connected to 192.168.5.171 (192.168.5.171) port 9201
* ALPN: curl offers h2,http/1.1
* (304) (OUT), TLS handshake, Client hello (1):
*  CAfile: /etc/ssl/cert.pem
*  CApath: none
* (304) (IN), TLS handshake, Server hello (2):
* (304) (IN), TLS handshake, Unknown (8):
* (304) (IN), TLS handshake, Request CERT (13):
* (304) (IN), TLS handshake, Certificate (11):
* SSL certificate problem: self signed certificate
* Closing connection
curl: (60) SSL certificate problem: self signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
* Host localhost:80 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
*   Trying [::1]:80...
* Connected to localhost (::1) port 80
* Server auth using Basic with user 'admin'
> GET /es/ HTTP/1.1
> Host: localhost
> Authorization: Basic YWRtaW46YWRtaW4=
> User-Agent: curl/8.7.1
> Accept: */*
>
* Request completely sent off
< HTTP/1.1 200 OK
< Server: nginx/1.27.4
< Date: Thu, 24 Apr 2025 07:45:10 GMT
< Content-Type: application/json; charset=UTF-8
< Content-Length: 552
< Connection: keep-alive
< Access-Control-Allow-Origin: *
< Access-Control-Allow-Methods: GET, POST, OPTIONS
< Access-Control-Allow-Headers: Authorization,Content-Type
<
{
  "name" : "easysearch-node1",
  "cluster_name" : "infinilabs",
  "cluster_uuid" : "VcMD__DwSYSUqear8wp-XA",
  "version" : {
    "distribution" : "easysearch",
    "number" : "1.11.1",
    "distributor" : "INFINI Labs",
    "build_hash" : "4d0be0343919fb1a605e3c8284326b7e069eb9bf",
    "build_date" : "2025-03-14T09:33:12.182925Z",
    "build_snapshot" : false,
    "lucene_version" : "8.11.4",
    "minimum_wire_lucene_version" : "7.7.0",
    "minimum_lucene_index_compatibility_version" : "7.7.0"
  },
  "tagline" : "You Know, For Easy Search!"
}
* Connection #0 to host localhost left intact

```

æœ¬æ¬¡å°† Nginx çš„è®¿é—®è®¤è¯å¯†ç ä¿®æ”¹ä¸º `admin123` åŽï¼Œå‘çŽ°åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºçŽ°äº†ä¸¤æ¬¡èº«ä»½éªŒè¯çš„æç¤ºã€‚å…·ä½“è¡¨çŽ°ä¸ºï¼šå½“ç”¨æˆ·è¾“å…¥é”™è¯¯çš„å¯†ç æ—¶ï¼ŒNginx ä¼šé¦–å…ˆè¿”å›žä¸€æ¬¡ 401 Unauthorizedã€‚ç”±äºŽ Nginx ä¸Ž EasySearch ä½¿ç”¨äº†ä¸åŒçš„è®¤è¯ä¿¡æ¯ï¼ŒNginx åœ¨å°†è¯·æ±‚å¤´ï¼ˆåŒ…æ‹¬ Authorization å­—æ®µï¼‰è½¬å‘è‡³ EasySearch æ—¶ï¼ŒEasySearch æ£€æµ‹åˆ°å‡­æ®ä¸åŒ¹é…ï¼Œä¹Ÿä¼šè¿”å›žä¸€æ¬¡ 401ã€‚ç”±æ­¤å¯¼è‡´äº†åŒé‡èº«ä»½è®¤è¯å¤±è´¥çš„çŽ°è±¡ï¼Œå½±å“äº†æ­£å¸¸è®¿é—®æµç¨‹ã€‚

```bash
curl -v -u "admin:admin" http://localhost/es/

*   Trying 192.168.5.171:9201...
* Connected to 192.168.5.171 (192.168.5.171) port 9201
* ALPN: curl offers h2,http/1.1
* (304) (OUT), TLS handshake, Client hello (1):
*  CAfile: /etc/ssl/cert.pem
*  CApath: none
* (304) (IN), TLS handshake, Server hello (2):
* (304) (IN), TLS handshake, Unknown (8):
* (304) (IN), TLS handshake, Request CERT (13):
* (304) (IN), TLS handshake, Certificate (11):
* SSL certificate problem: self signed certificate
* Closing connection
curl: (60) SSL certificate problem: self signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
* Host localhost:80 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
*   Trying [::1]:80...
* Connected to localhost (::1) port 80
* Server auth using Basic with user 'admin'
> GET /es/ HTTP/1.1
> Host: localhost
> Authorization: Basic YWRtaW46YWRtaW4=
> User-Agent: curl/8.7.1
> Accept: */*
>
* Request completely sent off
< HTTP/1.1 401 Unauthorized
< Server: nginx/1.27.4
< Date: Thu, 24 Apr 2025 09:21:09 GMT
< Content-Type: text/html
< Content-Length: 179
< Connection: keep-alive
* Authentication problem. Ignoring this.
< WWW-Authenticate: Basic realm="Restricted Area"
<
<html>
<head><title>401 Authorization Required</title></head>
<body>
<center><h1>401 Authorization Required</h1></center>
<hr><center>nginx/1.27.4</center>
</body>
</html>
* Connection #0 to host localhost left intact
â°xuâ™~/OrbStack/docker/containers/secure-nginx/etc/nginxâ±âœ”â‰» curl -v https://192.168.5.171:9201/         (base) 17:21:09
                                                           curl -v -u "admin:admin123" http://localhost/es/

*   Trying 192.168.5.171:9201...
* Connected to 192.168.5.171 (192.168.5.171) port 9201
* ALPN: curl offers h2,http/1.1
* (304) (OUT), TLS handshake, Client hello (1):
*  CAfile: /etc/ssl/cert.pem
*  CApath: none
* (304) (IN), TLS handshake, Server hello (2):
* (304) (IN), TLS handshake, Unknown (8):
* (304) (IN), TLS handshake, Request CERT (13):
* (304) (IN), TLS handshake, Certificate (11):
* SSL certificate problem: self signed certificate
* Closing connection
curl: (60) SSL certificate problem: self signed certificate
More details here: https://curl.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
* Host localhost:80 was resolved.
* IPv6: ::1
* IPv4: 127.0.0.1
*   Trying [::1]:80...
* Connected to localhost (::1) port 80
* Server auth using Basic with user 'admin'
> GET /es/ HTTP/1.1
> Host: localhost
> Authorization: Basic YWRtaW46YWRtaW4xMjM=
> User-Agent: curl/8.7.1
> Accept: */*
>
* Request completely sent off
< HTTP/1.1 401 Unauthorized
< Server: nginx/1.27.4
< Date: Thu, 24 Apr 2025 09:21:16 GMT
< Content-Type: application/json; charset=UTF-8
< Content-Length: 381
< Connection: keep-alive
* Authentication problem. Ignoring this.
< WWW-Authenticate: Basic realm="Security" charset="UTF-8"
<
* Connection #0 to host localhost left intact
{"error":{"root_cause":[{"type":"security_exception","reason":"Missing authentication information for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"Security\" charset=\"UTF-8\""}}],"type":"security_exception","reason":"Missing authentication information for REST request [/]","header":{"WWW-Authenticate":"Basic realm=\"Security\" charset=\"UTF-8\""}},"status":401}âŽ
```

| åœºæ™¯ç¼–å· | Nginx æ˜¯å¦å¼€å¯è®¤è¯ | EasySearch æ˜¯å¦å¼€å¯è®¤è¯ | å®žé™…è®¤è¯æ¬¡æ•°                                | è¯´æ˜Ž                                                                                                          |
| -------- | ------------------ | ----------------------- | ------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| â‘         | å¦                 | å¦                      | 0 æ¬¡                                        | å®Œå…¨å¼€æ”¾ï¼Œä»»ä½•è¯·æ±‚æ— éœ€éªŒè¯ã€‚                                                                                  |
| â‘¡        | å¦                 | âœ… æ˜¯                   | 1 æ¬¡                                        | è®¿é—®æ—¶ç›´æŽ¥å¼¹å‡º EasySearch çš„è®¤è¯çª—å£ï¼Œç”¨æˆ·éœ€è¾“å…¥å‡­è¯ã€‚                                                        |
| â‘¢        | âœ… æ˜¯              | å¦                      | 1 æ¬¡                                        | ä»…åœ¨ Nginx å±‚éªŒè¯ï¼ŒéªŒè¯é€šè¿‡åŽç›´æŽ¥è®¿é—®åŽç«¯ã€‚                                                                   |
| â‘£        | âœ… æ˜¯              | âœ… æ˜¯                   | 2 æ¬¡ï¼ˆé»˜è®¤ï¼‰                                | Nginx å’Œ EasySearch å„è‡ªè®¤è¯ï¼Œç”¨æˆ·éœ€è¿žç»­è¾“å…¥ä¸¤æ¬¡å¯†ç ã€‚                                                        |
| â‘¤        | âœ… æ˜¯              | âœ… æ˜¯                   | 1 æ¬¡ï¼ˆé€ä¼ ,proxy_pass_request_headers on;ï¼‰ | Nginx å¼€å¯è®¤è¯ï¼Œå¹¶é€šè¿‡ `proxy_set_header Authorization` é€ä¼ ç»™ EasySearchï¼Œç”¨æˆ·ä»…éœ€è¾“å…¥ä¸€æ¬¡å¯†ç å³å¯å®Œæˆè®¤è¯ã€‚ |
