---
title: Easysearch æœåŠ¡æ˜¨å¤©è¿˜å¥½å¥½çš„ï¼Œä¸ºä»€ä¹ˆä»Šå¤©çªç„¶è®¿é—®ä¸äº†äº†ï¼Ÿ
tags: æœç´¢å¼•æ“ï¼ˆESï¼‰
toc: true
categories: æé™ç§‘æŠ€
abbrlink: 8d9611a5
date: 2025-04-23 00:00:00
---

åœ¨ä½¿ç”¨ Easyearch æ­å»ºæœ¬åœ°æˆ–äº‘ç«¯æœç´¢æœåŠ¡æ—¶ï¼Œéš¾å…ä¼šé‡åˆ°æœåŠ¡å¶å‘æ€§æˆ–æŒç»­æ€§æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚æœ¬æ–‡å°†ä»æœåŠ¡çŠ¶æ€ã€ç«¯å£ç›‘å¬ã€ç½‘ç»œé…ç½®ã€å®‰å…¨ç»„ç­‰äº”ä¸ªç»´åº¦ï¼Œç³»ç»Ÿæ¢³ç†æ’æŸ¥æ€è·¯ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå®šä½å¹¶è§£å†³è®¿é—®å¤±è´¥çš„åŸå› ã€‚

---

## ğŸš¢ ä¸€ã€Docker éƒ¨ç½²åœºæ™¯ä¸‹çš„æ’æŸ¥æ–¹æ³•

å¦‚æœä½ æ˜¯é€šè¿‡å®˜æ–¹çš„ Docker Compose éƒ¨ç½² EasySearchï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°å¤ªå¤§é—®é¢˜ã€‚ä½†å¦‚æœä½ åƒæˆ‘ä¸€æ ·åœ¨ç¾¤æ™–æˆ– NAS ä¸Šåšè¿‡è‡ªå®šä¹‰é…ç½®ï¼Œä»¥ä¸‹é€šç”¨æ’æŸ¥æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜ï¼š

<!-- more -->

### ç¤ºä¾‹ Docker Compose é…ç½®

```yml
version: "3"
services:
  easysearch-node1:
    user: "602:602"
    image: infinilabs/easysearch:1.11.1-2000
    container_name: easysearch-node1
    hostname: easysearch-node1
    environment:
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - $PWD/ezs1/config:/app/easysearch/config
      - $PWD/ezs1/data:/app/easysearch/data
      - $PWD/ezs1/logs:/app/easysearch/logs
    ports:
      - 9201:9200
      - 9301:9300
    networks:
      - esnet

  easysearch-node2:
    user: "602:602"
    image: infinilabs/easysearch:1.11.1-2000
    container_name: easysearch-node2
    hostname: easysearch-node2
    environment:
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - $PWD/ezs2/config:/app/easysearch/config
      - $PWD/ezs2/data:/app/easysearch/data
      - $PWD/ezs2/logs:/app/easysearch/logs
    ports:
      - 9202:9200
      - 9302:9300
    networks:
      - esnet

  console:
    image: infinilabs/console:1.29.1-2000
    container_name: console
    hostname: console
    volumes:
      - $PWD/console/data:/data
      - $PWD/console/log:/log
    networks:
      - esnet
    ports:
      - 9000:9000
    links:
      - easysearch-node1:es1
      - easysearch-node2:es2
    environment:
      - TZ=Asia/Shanghai

networks:
  esnet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.24.0.0/16
```

---

### 1ï¸âƒ£ å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ

```bash
docker ps -a | grep easysearch
```

è‹¥å®¹å™¨çŠ¶æ€ä¸º `Exited`ï¼Œè¯´æ˜å¯åŠ¨å¤±è´¥ã€‚è¯·æŸ¥çœ‹å®¹å™¨æ—¥å¿—è¿›ä¸€æ­¥æ’æŸ¥ï¼š

```bash
docker logs <å®¹å™¨å>
```

å¦‚æœä½ çœ‹åˆ°äº†å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œè€Œä½ ä½¿ç”¨çš„æ˜¯è‡ªç­¾è¯ä¹¦ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥ï¼š

```
javax.net.ssl.SSLHandshakeException: Empty client certificate chain
javax.net.ssl.SSLHandshakeException: Received fatal alert: certificate_unknown
```

---

### 2ï¸âƒ£ å®¹å™¨æ˜¯å¦ç›‘å¬ç«¯å£ï¼Ÿ

è¿›å…¥å®¹å™¨å†…éƒ¨æŸ¥çœ‹ï¼š

```bash
docker exec -it <å®¹å™¨å> bash
netstat -tlnp
```

æœŸæœ›çœ‹åˆ°ç›‘å¬åœ°å€ä¸º `0.0.0.0:9200` å’Œ `0.0.0.0:9300`ï¼Œè¯´æ˜æœåŠ¡å¯¹å¤–æš´éœ²æˆåŠŸã€‚ä¾‹å¦‚ï¼š

```
tcp   0   0 0.0.0.0:9200   0.0.0.0:*   LISTEN   7/java
tcp   0   0 0.0.0.0:9300   0.0.0.0:*   LISTEN   7/java
```

---

### 3ï¸âƒ£ Docker ç«¯å£æ˜ å°„æ˜¯å¦é…ç½®æ­£ç¡®ï¼Ÿ

æ£€æŸ¥ `docker-compose.yml` ä¸­ `ports` æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®é™…æ˜ å°„æƒ…å†µï¼š

```bash
docker ps
```

ç¡®è®¤æ˜¯å¦å·²å°†å®¹å™¨å†…éƒ¨ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºã€‚

å®¿ä¸»æœºä¸Šä¹Ÿå¯ä»¥é€šè¿‡ `netstat` æˆ– `ss` å‘½ä»¤æŸ¥çœ‹ç«¯å£ç›‘å¬ï¼š

```bash
netstat -tlnp | grep 9200
```

ç¡®ä¿ç›‘å¬åœ°å€æ˜¯ `0.0.0.0:9200`ï¼Œè€Œé `127.0.0.1`ã€‚

- `-t`ï¼šæ˜¾ç¤º TCP è¿æ¥
- `-l`ï¼šä»…æ˜¾ç¤ºç›‘å¬çŠ¶æ€ï¼ˆListeningï¼‰çš„ç«¯å£
- `-n`ï¼šä»¥æ•°å­—æ–¹å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£ï¼ˆé¿å… DNS è§£æï¼‰
- `-p`ï¼šæ˜¾ç¤ºç›‘å¬ç«¯å£çš„ç¨‹åº PID å’Œåç§°

---

### 4ï¸âƒ£ ç½‘ç»œé…ç½®æ˜¯å¦è¿é€šï¼Ÿ

ä½¿ç”¨ `curl` æµ‹è¯•ï¼š

```bash
curl http://yourhost:9200
```

å¦‚éœ€è¿œç¨‹è®¿é—®ï¼Œéœ€ç¡®è®¤ï¼š

- å®¹å™¨ç›‘å¬çš„æ˜¯ `0.0.0.0`
- æ˜ å°„ç«¯å£å·²å¼€æ”¾
- ç½‘ç»œæ¡¥æ¥é…ç½®æ­£å¸¸

---

## ğŸ§© äºŒã€é Docker éƒ¨ç½²åœºæ™¯çš„æ’æŸ¥æ–¹æ³•

### 1ï¸âƒ£ æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Ÿ

```bash
ps aux | grep easysearch
```

ä¹Ÿå¯æŸ¥çœ‹ `nohup.out` æˆ– logs ç›®å½•ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ç¯å¢ƒå˜é‡ã€è·¯å¾„é”™è¯¯ã€æƒé™ä¸è¶³ç­‰é—®é¢˜ã€‚

---

### 2ï¸âƒ£ æ˜¯å¦ç›‘å¬äº†æ­£ç¡®çš„åœ°å€ï¼Ÿ

```bash
netstat -tulnp | grep java
```

EasySearch é»˜è®¤åªç›‘å¬æœ¬åœ°ï¼Œå»ºè®®ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```yml
# config/easysearch.yml
network.host: 0.0.0.0
http.port: 9200
```

---

### 3ï¸âƒ£ é˜²ç«å¢™æ˜¯å¦æ”¾è¡Œï¼Ÿ

ç¡®è®¤ Linux ä¸»æœºçš„é˜²ç«å¢™è®¾ç½®ï¼š

```bash
sudo ufw status
sudo iptables -L -n
```

ç¡®ä¿ç›®æ ‡ç«¯å£ï¼ˆå¦‚ 9200ã€9300ï¼‰å·²å…è®¸å¤–éƒ¨è®¿é—®ã€‚

---

## ğŸŒ ä¸‰ã€é€šç”¨æ’æŸ¥é¡¹ï¼ˆé€‚ç”¨äºæ‰€æœ‰éƒ¨ç½²æ–¹å¼ï¼‰

### âœ… äº‘æœåŠ¡å™¨ï¼šæ£€æŸ¥å®‰å…¨ç»„

äº‘æœåŠ¡å•†ï¼ˆå¦‚ AWSã€é˜¿é‡Œäº‘ï¼‰é€šå¸¸è¿˜éœ€é…ç½®å®‰å…¨ç»„æˆ–é˜²ç«å¢™è§„åˆ™ï¼Œç¡®ä¿ç›®æ ‡ç«¯å£å¯¹å¤–å¼€æ”¾ã€‚

### âœ… DNS è®¾ç½®æ˜¯å¦æ­£ç¡®

ä½¿ç”¨ `dig` å’Œ `ping` æµ‹è¯•åŸŸåè§£æä¸è¿é€šæ€§ï¼š

```bash
dig +short yourdomain.com
ping yourdomain.com
```

å¯ç”¨ `traceroute` è¿›ä¸€æ­¥åˆ†æè·¯å¾„ï¼š(æˆ‘åœ¨ MacOS ä¸‹æµ‹è¯•çš„)

```bash
sudo traceroute -P TCP -p 9200 192.168.X.X



traceroute to 192.168.X.X (192.168.X.X), 64 hops max, 40 byte packets
 1  192.168.X.X (192.168.X.X)  3.756 ms  3.208 ms  3.142 ms
```

## âœ… æ€»ç»“ï¼šæ’æŸ¥ EasySearch çš„å››æ­¥æ³•

```markdown
1. æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Ÿ
2. ç«¯å£æ˜¯å¦ç›‘å¬ï¼Ÿ
3. ç½‘ç»œæ˜¯å¦æ‰“é€šï¼Ÿ
4. å®‰å…¨ç»„æ˜¯å¦æ”¾è¡Œï¼Ÿ
```

æ— è®ºæ˜¯æœ¬åœ°éƒ¨ç½²è¿˜æ˜¯äº‘ç«¯éƒ¨ç½²ï¼ŒæŒæ¡ä¸Šè¿°æ’æŸ¥æ–¹æ³•ï¼Œä½ å°±èƒ½è¿…é€Ÿå®šä½å¹¶è§£å†³ EasySearch æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚
å¦‚æœä½ è§‰å¾—æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ å°†æœ¬æ–‡åŠ å…¥æ”¶è—å¤¹ï¼Œæˆ–è½¬å‘ç»™å…¶ä»–ä½¿ç”¨ EasySearch çš„å°ä¼™ä¼´ ğŸ‘‡
