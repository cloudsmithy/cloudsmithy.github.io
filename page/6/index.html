<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>é•œæ¹–</title><link rel="manifest" href="../../manifest.json"><meta name="application-name" content="é•œæ¹–"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="é•œæ¹–"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="é•œæ¹–"><meta property="og:url" content="https://xu-hardy.github.io/"><meta property="og:site_name" content="é•œæ¹–"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xu-hardy.github.io/img/og_image.png"><meta property="article:author" content="Xu"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://xu-hardy.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xu-hardy.github.io"},"headline":"é•œæ¹–","image":["https://xu-hardy.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Xu"},"publisher":{"@type":"Organization","name":"é•œæ¹–","logo":{"@type":"ImageObject","url":"https://xu-hardy.github.io/img/favicon.svg"}},"description":""}</script><link rel="icon" href="../../img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="../../css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="atom.xml" title="é•œæ¹–" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="../../index.html"><img src="../../img/favicon.svg" alt="é•œæ¹–" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="../../index.html">é•œæ¹–</a><a class="navbar-item" href="../../archives">æ—¶å…‰çº¿</a><a class="navbar-item" href="../../tags">æ ‡ç­¾</a><a class="navbar-item" href="../../categories">åˆ†ç±»</a><a class="navbar-item" href="../../quotes">è¯­å½•</a><a class="navbar-item" href="../../vue_blog">CS Core</a><a class="navbar-item" href="../../aws">AWS</a><a class="navbar-item" href="../../note">å¤‡æ³¨</a><a class="navbar-item" href="../../about">å…³äºæˆ‘</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cloudsmithy/cloudsmithy.github.io"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.641Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">4 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦630ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../docker-compose%E9%83%A8%E7%BD%B2-easysearch-%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">Docker-Composeéƒ¨ç½² EasySearch å¼‚å¸¸é—®é¢˜æ’æŸ¥</a></p><div class="content"><p>è¿‘æœŸå°†åŸæœ¬è¿è¡Œåœ¨ macOS ä¸Šçš„ EasySearchã€Console å’Œ Coco-server ç­‰æœåŠ¡è¿ç§»è‡³ç¾¤æ™– NAS å¹³å°ã€‚åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°äº† EasySearch å®¹å™¨æ— æ³•æ­£å¸¸å¯åŠ¨æˆ–è¿è¡Œä¸­æ„å¤–ç»ˆæ­¢çš„é—®é¢˜ã€‚æœ¬æ–‡è®°å½•äº†è¿™äº›é—®é¢˜çš„å…·ä½“è¡¨ç°åŠè§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ä¸ºåç»­ç±»ä¼¼éƒ¨ç½²æä¾›å‚è€ƒã€‚</p>
<h2 id="åŸºç¡€éƒ¨ç½²é…ç½®"><a href="#åŸºç¡€éƒ¨ç½²é…ç½®" class="headerlink" title="åŸºç¡€éƒ¨ç½²é…ç½®"></a>åŸºç¡€éƒ¨ç½²é…ç½®</h2><p>ä»¥ä¸‹æ˜¯å®˜æ–¹æ¨èçš„ docker-compose é…ç½®æ–‡ä»¶ï¼š<br>åœ°å€å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://docs.infinilabs.com/easysearch/main/docs/getting-started/install/docker-compose/">https://docs.infinilabs.com/easysearch/main/docs/getting-started/install/docker-compose/</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">easysearch-node1:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&quot;602:602&quot;</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">infinilabs/easysearch:1.11.1-2000</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">easysearch-node1</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">easysearch-node1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">nofile:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">65536</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">65536</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs1/config:/app/easysearch/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs1/data:/app/easysearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs1/logs:/app/easysearch/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9201</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9301</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">esnet</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">easysearch-node2:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&quot;602:602&quot;</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">infinilabs/easysearch:1.11.1-2000</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">easysearch-node2</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">easysearch-node2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">nofile:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">65536</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">65536</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs2/config:/app/easysearch/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs2/data:/app/easysearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/ezs2/logs:/app/easysearch/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9202</span><span class="string">:9200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9302</span><span class="string">:9300</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">esnet</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">console:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">infinilabs/console:1.29.1-2000</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">console</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">console</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/console/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/console/log:/log</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">esnet</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">easysearch-node1:es1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">easysearch-node2:es2</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">esnet:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">ipam:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="number">172.24</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="é—®é¢˜-1ï¼švm-max-map-count-å‚æ•°ä¸è¶³"><a href="#é—®é¢˜-1ï¼švm-max-map-count-å‚æ•°ä¸è¶³" class="headerlink" title="é—®é¢˜ 1ï¼švm.max_map_count å‚æ•°ä¸è¶³"></a>é—®é¢˜ 1ï¼švm.max_map_count å‚æ•°ä¸è¶³</h3><p>é”™è¯¯æç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>Lucene æœç´¢å¼•æ“åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ›å»ºå¤§é‡å†…å­˜æ˜ å°„æ–‡ä»¶(mmap)ï¼Œè€Œ Linux ç³»ç»Ÿé»˜è®¤çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸæ•°é‡é™åˆ¶(65530)æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p><strong>ä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯å¤±æ•ˆï¼‰</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>

<p><strong>æ°¸ä¹…ç”Ÿæ•ˆé…ç½®</strong>ï¼š</p>
<ol>
<li>ç¼–è¾‘ <code>/etc/sysctl.conf</code> æ–‡ä»¶</li>
<li>æ·»åŠ é…ç½®é¡¹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=262144</span><br></pre></td></tr></table></figure></li>
<li>åº”ç”¨é…ç½®ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> sysctl -p</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="é—®é¢˜-2ï¼šJava-å †å†…å­˜æº¢å‡º"><a href="#é—®é¢˜-2ï¼šJava-å †å†…å­˜æº¢å‡º" class="headerlink" title="é—®é¢˜ 2ï¼šJava å †å†…å­˜æº¢å‡º"></a>é—®é¢˜ 2ï¼šJava å †å†…å­˜æº¢å‡º</h3><p>é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜åˆ†æ-1"><a href="#é—®é¢˜åˆ†æ-1" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>å®¹å™¨åŒ–ç¯å¢ƒä¸­ï¼ŒJVM é»˜è®¤çš„å†…å­˜åˆ†é…ç­–ç•¥å¾€å¾€æ— æ³•æ­£ç¡®è¯†åˆ«å¯ç”¨çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ï¼š</p>
<ol>
<li>å †å†…å­˜åˆ†é…ä¸è¶³ï¼ˆé»˜è®¤é€šå¸¸ä»… 512MB-1GBï¼‰</li>
<li>å†…å­˜ä½¿ç”¨è¶…å‡ºå®¹å™¨é™åˆ¶åè¢«ç³»ç»Ÿå¼ºåˆ¶ç»ˆæ­¢</li>
</ol>
<h4 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>ä¿®æ”¹ docker-compose é…ç½®ï¼Œæ˜ç¡®æŒ‡å®š JVM å †å†…å­˜ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ES_JAVA_OPTS=-Xms2g</span> <span class="string">-Xmx2g</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å»ºè®®ï¼š</p>
<ol>
<li>å †å†…å­˜è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„ 50%ä»¥å†…</li>
<li>æœ€å¤§å †å†…å­˜ä¸è¶…è¿‡ 32GBï¼ˆé¿å…æŒ‡é’ˆå‹ç¼©å¤±æ•ˆï¼‰</li>
<li>åˆå§‹å †(-Xms)å’Œæœ€å¤§å †(-Xmx)è®¾ä¸ºç›¸åŒå€¼ï¼Œé¿å…è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´</li>
</ol>
<p>è¿™æ¬¡æ˜¯éƒ¨ç½²è¿‡ç¨‹ä¸­è¸©çš„ä¸¤ä¸ªå‘ï¼Œå†™å‡ºæ¥è®©å¤§å®¶é¿é¿é›·ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.641Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">9 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1413ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../easysearch-%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4%E6%89%AB%E7%9B%B2%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E-http-%E5%88%B0-https%E3%80%81%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE%E5%85%A8%E8%A7%A3%E6%9E%90/">Easysearch åŸºç¡€è¿ç»´æ‰«ç›²æŒ‡å—ï¼šä» HTTP åˆ° HTTPSã€è®¤è¯ä¸å®‰å…¨è®¿é—®å…¨è§£æ</a></p><div class="content"><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒåŸç”Ÿ Elasticsearch é»˜è®¤å¼€å¯çš„æ˜¯ <strong>HTTP æ˜æ–‡æ¥å£</strong>ï¼Œå¹¶ä¸”ä¸å¼€å¯ä»»ä½•èº«ä»½è®¤è¯æˆ–ä¼ è¾“åŠ å¯†ã€‚è‹¥æƒ³å¯ç”¨ TLS&#x2F;SSL åŠ å¯†åŠè´¦å·å¯†ç éªŒè¯ï¼Œé€šå¸¸éœ€è¦é…ç½®ç¹ççš„å®‰å…¨æ¨¡å—ã€‚</p>
<p>è€Œ Easysearch åœ¨æ­¤åŸºç¡€ä¸Šåšäº†æå¤§çš„ç®€åŒ–ï¼Œé€šè¿‡å®˜æ–¹æä¾›çš„ <code>initialize.sh</code> è„šæœ¬ï¼Œä¸€é”®å®Œæˆåˆå§‹åŒ–å³å¯è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ã€é…ç½® HTTPSï¼Œå¹¶å¯ç”¨å¯†ç è®¤è¯ã€‚</p>
<p>å½“ç„¶ï¼Œå¯¹äºæœ¬åœ°å¼€å‘æˆ–ä¸´æ—¶æµ‹è¯•åœºæ™¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½å¸Œæœ›å…³é—­ HTTPS ä¸è®¤è¯ï¼Œç›´æ¥é€šè¿‡ HTTP è°ƒè¯•æœåŠ¡ã€‚æœ¬æ–‡å°†ä»é…ç½®æ–‡ä»¶å‡ºå‘ï¼Œé€æ­¥è®²è§£å¦‚ä½•æ ¹æ®ä¸åŒéœ€æ±‚é…ç½® Easysearch çš„å®‰å…¨ç­–ç•¥ã€é€šä¿¡åè®®ä¸å¤–ç½‘è®¿é—®æƒé™ã€‚</p>
<hr>
<h2 id="ğŸ› -ä¸€ã€åˆå§‹åŒ–è¾“å‡ºä¸é»˜è®¤è´¦å·å¯†ç "><a href="#ğŸ› -ä¸€ã€åˆå§‹åŒ–è¾“å‡ºä¸é»˜è®¤è´¦å·å¯†ç " class="headerlink" title="ğŸ›  ä¸€ã€åˆå§‹åŒ–è¾“å‡ºä¸é»˜è®¤è´¦å·å¯†ç "></a>ğŸ›  ä¸€ã€åˆå§‹åŒ–è¾“å‡ºä¸é»˜è®¤è´¦å·å¯†ç </h2><p>æ‰§è¡Œä»¥ä¸‹åˆå§‹åŒ–å‘½ä»¤åï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/initialize.sh</span><br></pre></td></tr></table></figure>

<p>ç»ˆç«¯åŠ <code>initialize.log</code> æ–‡ä»¶ä¸­å°†è¾“å‡ºåˆå§‹çš„è®¿é—®æ–¹å¼å’Œç®¡ç†å‘˜è´¦å·å¯†ç ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -ku admin:160824cab0b02193226e https://localhost:9200</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEasysearch å¯ç”¨äº† HTTPS é€šä¿¡åŠå¯†ç è®¤è¯ã€‚</p>
<hr>
<h2 id="âš™-äºŒã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šeasysearch-yml"><a href="#âš™-äºŒã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šeasysearch-yml" class="headerlink" title="âš™ äºŒã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šeasysearch.yml"></a>âš™ äºŒã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>easysearch.yml</code></h2><p>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config/easysearch.yml</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä¿®æ”¹é›†ç¾¤åç§°ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-application</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å‰è®¿é—®è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;cluster_name&quot;</span>: <span class="string">&quot;easysearch&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;cluster_name&quot;</span>: <span class="string">&quot;my-application&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸŒ-ä¸‰ã€å¼€æ”¾å¤–ç½‘è®¿é—®ï¼ˆå•èŠ‚ç‚¹éƒ¨ç½²ï¼‰"><a href="#ğŸŒ-ä¸‰ã€å¼€æ”¾å¤–ç½‘è®¿é—®ï¼ˆå•èŠ‚ç‚¹éƒ¨ç½²ï¼‰" class="headerlink" title="ğŸŒ ä¸‰ã€å¼€æ”¾å¤–ç½‘è®¿é—®ï¼ˆå•èŠ‚ç‚¹éƒ¨ç½²ï¼‰"></a>ğŸŒ ä¸‰ã€å¼€æ”¾å¤–ç½‘è®¿é—®ï¼ˆå•èŠ‚ç‚¹éƒ¨ç½²ï¼‰</h2><p>è‹¥å¸Œæœ›åœ¨å±€åŸŸç½‘æˆ–å…¬ç½‘è®¿é—® Easysearchï¼Œå¯ä»¥åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">discovery.type:</span> <span class="string">single-node</span></span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œä¸ºå¢å¼ºå¯¹åŸç”Ÿ Elasticsearch å®¢æˆ·ç«¯çš„å…¼å®¹æ€§ï¼Œå»ºè®®æ·»åŠ ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">elasticsearch.api_compatibility:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-å››ã€æ§åˆ¶-HTTPS-ä¸è®¤è¯åŠŸèƒ½å¼€å…³"><a href="#ğŸ”-å››ã€æ§åˆ¶-HTTPS-ä¸è®¤è¯åŠŸèƒ½å¼€å…³" class="headerlink" title="ğŸ” å››ã€æ§åˆ¶ HTTPS ä¸è®¤è¯åŠŸèƒ½å¼€å…³"></a>ğŸ” å››ã€æ§åˆ¶ HTTPS ä¸è®¤è¯åŠŸèƒ½å¼€å…³</h2><p>Easysearch æä¾›ä¸¤ä¸ªæ ¸å¿ƒå‚æ•°æ§åˆ¶å®‰å…¨è¡Œä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>security.enabled</code></td>
<td>æ§åˆ¶æ˜¯å¦å¯ç”¨èº«ä»½è®¤è¯å’Œå®‰å…¨æ¨¡å—</td>
</tr>
<tr>
<td><code>security.ssl.http.enabled</code></td>
<td>æ§åˆ¶æ˜¯å¦å¯ç”¨ HTTPSï¼ˆSSL&#x2F;TLSï¼‰</td>
</tr>
</tbody></table>
<p>ä½ å¯ä»¥æ ¹æ®ç¯å¢ƒé€‰æ‹©é…ç½®ç»„åˆï¼š</p>
<table>
<thead>
<tr>
<th><code>security.enabled</code></th>
<th><code>security.ssl.http.enabled</code></th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td>true</td>
<td>true</td>
<td>é»˜è®¤é…ç½®ï¼Œå¯ç”¨ HTTPS å’Œè®¤è¯ï¼ˆæ¨èï¼‰</td>
</tr>
<tr>
<td>true</td>
<td>false</td>
<td>æ˜æ–‡ HTTP + å¯ç”¨è®¤è¯</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
<td>å¯ç”¨åŠ å¯†ä½†æ— èº«ä»½è®¤è¯ï¼ˆä¸å¸¸è§ï¼‰</td>
</tr>
<tr>
<td>false</td>
<td>false</td>
<td>å®Œå…¨å¼€æ”¾ï¼Œæ— è®¤è¯ + HTTPï¼ˆâš ï¸ ä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ï¼‰</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“¸-äº”ã€ç¤ºä¾‹ï¼šå¯ç”¨-HTTP-å¹¶ä¿ç•™è®¤è¯"><a href="#ğŸ“¸-äº”ã€ç¤ºä¾‹ï¼šå¯ç”¨-HTTP-å¹¶ä¿ç•™è®¤è¯" class="headerlink" title="ğŸ“¸ äº”ã€ç¤ºä¾‹ï¼šå¯ç”¨ HTTP å¹¶ä¿ç•™è®¤è¯"></a>ğŸ“¸ äº”ã€ç¤ºä¾‹ï¼šå¯ç”¨ HTTP å¹¶ä¿ç•™è®¤è¯</h2><p>å¦‚æœä½ å¸Œæœ›ä½¿ç”¨ HTTP è€Œä¸å¯ç”¨ HTTPSï¼Œå¯ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">security.ssl.http.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>è®¿é—®æ—¶ä¾ç„¶éœ€è¦æä¾›è´¦å·å¯†ç ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/64574ba1495c4560638d9446f7a098d5.png" alt="image-20250425120123219"></p>
<hr>
<h2 id="ğŸ”§-å…­ã€ç”¨æˆ·è®¤è¯ä¸å¯†ç ç®¡ç†"><a href="#ğŸ”§-å…­ã€ç”¨æˆ·è®¤è¯ä¸å¯†ç ç®¡ç†" class="headerlink" title="ğŸ”§ å…­ã€ç”¨æˆ·è®¤è¯ä¸å¯†ç ç®¡ç†"></a>ğŸ”§ å…­ã€ç”¨æˆ·è®¤è¯ä¸å¯†ç ç®¡ç†</h2><p>åˆå§‹åŒ–å®Œæˆåï¼ŒEasysearch é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ· <code>admin</code>ï¼Œå…¶ä¿¡æ¯å­˜å‚¨åœ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config/security/user.yml</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">admin:</span></span><br><span class="line">  <span class="attr">hash:</span> <span class="string">&quot;$2y$12$rmNDJxpQdRDb3F1dqk.uweSZqH3VAqeEpkP298vJ6QS99K80kbRoO&quot;</span></span><br><span class="line">  <span class="attr">reserved:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">external_roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">&quot;Admin user&quot;</span></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ä½¿ç”¨ Postman æˆ– Python è„šæœ¬éªŒè¯è®¿é—®ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:9200&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Basic YWRtaW46MTYwODI0Y2FiMGIwMjE5MzIyNmU=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ‘¤-ä¸ƒã€æ–°å»ºç”¨æˆ·ä¸ç®¡ç†æ¥å£"><a href="#ğŸ‘¤-ä¸ƒã€æ–°å»ºç”¨æˆ·ä¸ç®¡ç†æ¥å£" class="headerlink" title="ğŸ‘¤ ä¸ƒã€æ–°å»ºç”¨æˆ·ä¸ç®¡ç†æ¥å£"></a>ğŸ‘¤ ä¸ƒã€æ–°å»ºç”¨æˆ·ä¸ç®¡ç†æ¥å£</h2><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£æŸ¥è¯¢å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_security/account</span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/direct/e14fbb45263c444283c1c4164a72d5f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¹Ÿå¯ä»¥è®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_security/user</span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/direct/97b5fd272c2c4385b4f38b3aa216f639.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç”¨äºåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·ã€‚</p>
<p>è™½ç„¶ <code>user.yml</code> æ–‡ä»¶é»˜è®¤åªåŒ…å« <code>admin</code> ç”¨æˆ·ï¼Œä½†é€šè¿‡ API æ·»åŠ çš„æ–°ç”¨æˆ·åŒæ ·ç”Ÿæ•ˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡ Postman åˆ›å»ºçš„æ–°ç”¨æˆ·å·²æˆåŠŸç”Ÿæ•ˆï¼š</p>
<ul>
<li><p>æ–°ç”¨æˆ·åˆ›å»ºç•Œé¢ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/228aa37c447c7b5ad2ffcdab0c3dfc23.png" alt="æ–°å»ºç”¨æˆ·"></p>
</li>
<li><p>ä½¿ç”¨æ–°ç”¨æˆ·è®¿é—®éªŒè¯æˆåŠŸï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/62096597764fad4ad7c6f14dbd9fb3f8.png" alt="æ–°ç”¨æˆ·è®¿é—®"></p>
</li>
</ul>
<hr>
<h2 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èé…ç½®</th>
</tr>
</thead>
<tbody><tr>
<td>æœ¬åœ°æµ‹è¯•ï¼ˆæ— åŠ å¯†ã€æ— è®¤è¯ï¼‰</td>
<td><code>security.enabled: false</code> + <code>security.ssl.http.enabled: false</code></td>
</tr>
<tr>
<td>æœ¬åœ°è°ƒè¯•ï¼ˆåŠ è®¤è¯ã€æ— åŠ å¯†ï¼‰</td>
<td><code>security.enabled: true</code> + <code>security.ssl.http.enabled: false</code></td>
</tr>
<tr>
<td>ç”Ÿäº§ç¯å¢ƒï¼ˆå®‰å…¨é€šä¿¡ï¼‰</td>
<td><code>security.enabled: true</code> + <code>security.ssl.http.enabled: true</code></td>
</tr>
<tr>
<td>ç‰¹æ®Šç”¨é€”ï¼ˆåŠ å¯†ä½†æ— è®¤è¯ï¼‰</td>
<td><code>security.enabled: false</code> + <code>security.ssl.http.enabled: true</code></td>
</tr>
</tbody></table>
<p>EasySearch æä¾›äº†éå¸¸çµæ´»çš„é…ç½®æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚ï¼Œè‡ªç”±åˆ‡æ¢ HTTP&#x2F;HTTPSã€å¼€å¯æˆ–å…³é—­è®¤è¯æ¨¡å—ã€‚ç†è§£å¹¶æŒæ¡è¿™ä¸¤ä¸ªæ ¸å¿ƒå®‰å…¨å‚æ•°ï¼Œå°†å¤§å¤§æå‡ä½ å¯¹ EasySearch çš„è¿ç»´æŒæ§åŠ›ã€‚</p>
<h2 id="ğŸ”-é™„å½•ï¼šå…³äº-Basic-Auth-çš„åŸç†ä¸ä½¿ç”¨æ–¹å¼"><a href="#ğŸ”-é™„å½•ï¼šå…³äº-Basic-Auth-çš„åŸç†ä¸ä½¿ç”¨æ–¹å¼" class="headerlink" title="ğŸ” é™„å½•ï¼šå…³äº Basic Auth çš„åŸç†ä¸ä½¿ç”¨æ–¹å¼"></a>ğŸ” é™„å½•ï¼šå…³äº Basic Auth çš„åŸç†ä¸ä½¿ç”¨æ–¹å¼</h2><p>åœ¨ Easysearch é»˜è®¤å¼€å¯è®¤è¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è¯·æ±‚ä¸­ç»å¸¸ä¼šçœ‹åˆ°å¦‚ä¸‹çš„ <code>Authorization</code> å¤´ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Basic YWRtaW46MTYwODI0Y2FiMGIwMjE5MzIyNmU=</span><br></pre></td></tr></table></figure>

<p>è¿™å…¶å®å°±æ˜¯æ ‡å‡†çš„ <strong>HTTP Basic è®¤è¯</strong>ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic &lt;Base64 ç¼–ç åçš„ ç”¨æˆ·å:å¯†ç &gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ğŸ§ -ä¸¾ä¸ªä¾‹å­ï¼š"><a href="#ğŸ§ -ä¸¾ä¸ªä¾‹å­ï¼š" class="headerlink" title="ğŸ§  ä¸¾ä¸ªä¾‹å­ï¼š"></a>ğŸ§  ä¸¾ä¸ªä¾‹å­ï¼š</h3><p>Base64 ç¼–ç å‰æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin:160824cab0b02193226e</span><br></pre></td></tr></table></figure>

<p>ç¼–ç åå˜æˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW46MTYwODI0Y2FiMGIwMjE5MzIyNmU=</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¸‹è¯·æ±‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Basic YWRtaW46MTYwODI0Y2FiMGIwMjE5MzIyNmU=&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u admin:160824cab0b02193226e http://localhost:9200</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="âš ï¸-å®‰å…¨æç¤ºï¼š"><a href="#âš ï¸-å®‰å…¨æç¤ºï¼š" class="headerlink" title="âš ï¸ å®‰å…¨æç¤ºï¼š"></a>âš ï¸ å®‰å…¨æç¤ºï¼š</h3><blockquote>
<p>Base64 åªæ˜¯ç¼–ç  <strong>ä¸æ˜¯åŠ å¯†</strong>ï¼Œè´¦å·å¯†ç ä¾ç„¶æ˜¯æ˜æ–‡å½¢å¼ï¼Œå› æ­¤ <strong>å¿…é¡»é…åˆ HTTPS ä½¿ç”¨</strong>ï¼Œå¦åˆ™å®¹æ˜“è¢«ä¸­é—´äººç›‘å¬ã€‚</p>
</blockquote>
<hr>
<h2 id="ğŸŒ-ä½¿ç”¨-URL-æºå¸¦ç”¨æˆ·åå¯†ç ï¼ˆä¸æ¨èä½†æœ‰æ—¶æ–¹ä¾¿ï¼‰"><a href="#ğŸŒ-ä½¿ç”¨-URL-æºå¸¦ç”¨æˆ·åå¯†ç ï¼ˆä¸æ¨èä½†æœ‰æ—¶æ–¹ä¾¿ï¼‰" class="headerlink" title="ğŸŒ ä½¿ç”¨ URL æºå¸¦ç”¨æˆ·åå¯†ç ï¼ˆä¸æ¨èä½†æœ‰æ—¶æ–¹ä¾¿ï¼‰"></a>ğŸŒ ä½¿ç”¨ URL æºå¸¦ç”¨æˆ·åå¯†ç ï¼ˆä¸æ¨èä½†æœ‰æ—¶æ–¹ä¾¿ï¼‰</h2><p>é™¤äº† Header æˆ– <code>curl -u</code> çš„æ–¹å¼ï¼ŒHTTP åè®®è¿˜å…è®¸é€šè¿‡ URL æºå¸¦è´¦å·å¯†ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://admin:160824cab0b02193226e@localhost:9200</span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ä¸­ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://admin:160824cab0b02193226e@localhost:9200</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.641Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">22 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦3316ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../%E4%BB%8E%E8%AE%A4%E8%AF%81%E5%88%B0%E9%80%8F%E4%BC%A0%EF%BC%9A%E7%94%A8-nginx-%E4%B8%BA-easysearch-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%BD%93%E5%8C%96%E8%AE%A4%E8%AF%81%E7%BD%91%E5%85%B3/">ä»è®¤è¯åˆ°é€ä¼ ï¼šç”¨ Nginx ä¸º Easysearch æ„å»ºä¸€ä½“åŒ–è®¤è¯ç½‘å…³</a></p><div class="content"><p>åœ¨æ„å»ºæœ¬åœ°æˆ–äº‘ç«¯æœç´¢å¼•æ“ç³»ç»Ÿæ—¶ï¼ŒEasySearch å‡­å€Ÿå…¶è½»é‡ã€é«˜æ€§èƒ½ã€æ˜“éƒ¨ç½²ç­‰ä¼˜åŠ¿ï¼Œé€æ¸æˆä¸ºä¼—å¤šå¼€å‘è€…å’ŒæŠ€æœ¯çˆ±å¥½è€…çš„é¦–é€‰ã€‚ä½†åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å€ŸåŠ© Nginx ä¸º EasySearch æä¾›é«˜æ•ˆã€ç¨³å®šä¸”å®‰å…¨çš„è®¿é—®å…¥å£ï¼Œå°¤å…¶æ˜¯åœ¨èº«ä»½è®¤è¯æ–¹é¢ï¼Œä»ç„¶æ˜¯ä¸€ä¸ªå…³é”®æŠ€æœ¯ç¯èŠ‚ã€‚</p>
<p>æœ¬æ•™ç¨‹å°†å›´ç»• Basic Auth è®¤è¯æœºåˆ¶å±•å¼€ï¼Œç³»ç»Ÿè®²è§£å¦‚ä½•é€šè¿‡ Nginx å®ç°å®‰å…¨é˜²æŠ¤ã€è®¤è¯ä¿¡æ¯é€ä¼ ç­‰å¸¸è§é…ç½®åœºæ™¯ï¼Œå¸®åŠ©ä½ åœ¨å¤šç§å®é™…éƒ¨ç½²ç¯å¢ƒä¸­å¿«é€Ÿæ­å»ºå¯é çš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚</p>
<p>æ— è®ºä½ æ˜¯åœ¨æ­å»ºå®¶åº­ NAS æœåŠ¡ï¼Œè¿˜æ˜¯åœ¨ä¼ä¸šç¯å¢ƒä¸­é›†æˆæœç´¢å¼•æ“ç³»ç»Ÿï¼Œæœ¬æ•™ç¨‹éƒ½èƒ½ä¸ºä½ æä¾›ä¸€å¥—å¯è½åœ°ã€å¯å¤ç”¨çš„ Nginx å®‰å…¨è®¤è¯è§£å†³æ–¹æ¡ˆã€‚ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ Nginx é…ç½®æ–‡ä»¶ç¤ºä¾‹ã€‚æˆ‘ä»¬é€šè¿‡ Docker å¯åŠ¨ Nginx å®¹å™¨ï¼Œå¹¶å°†æœ¬åœ°ç¼–å†™å¥½çš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„åå‘ä»£ç†å’Œè®¤è¯é€»è¾‘ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  -p 80:80 \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>)/default.conf:/etc/nginx/conf.d/default.conf \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p><strong>default.conf</strong>é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ¹è·¯å¾„å¯é€‰é…ç½®ï¼Œå¦‚æœä½ è¦ä¸€ä¸ªæ¬¢è¿é¡µ</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        <span class="built_in">return</span> 200 <span class="string">&#x27;Nginx is running.\n&#x27;</span>;</span><br><span class="line">        add_header Content-Type text/plain;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åå‘ä»£ç† EasySearch</span></span><br><span class="line">    location /es/ &#123;</span><br><span class="line">        proxy_pass https://backend:9200/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¿®æ­£è¯·æ±‚å¤´</span></span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        <span class="comment"># proxy_pass_request_headers on; Ã·</span></span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœéœ€è¦ä¿æ´»è¿æ¥</span></span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯é€‰ï¼šå…è®¸è·¨åŸŸè®¿é—®ï¼ˆç”¨äºå‰ç«¯ AJAX è°ƒè¯•ï¼‰</span></span><br><span class="line">        add_header Access-Control-Allow-Origin *;</span><br><span class="line">        add_header Access-Control-Allow-Methods <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">        add_header Access-Control-Allow-Headers <span class="string">&#x27;Authorization,Content-Type&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy_set_header Authorization &quot;Basic YWRtaW46MTIzNDU2&quot;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¸…ç†è·¯å¾„å‰ç¼€ `/es/`</span></span><br><span class="line">        rewrite ^/es/(.*)$ /<span class="variable">$1</span> <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯é€‰ï¼šé™æ€èµ„æºæ”¯æŒ</span></span><br><span class="line">    <span class="comment"># location /static/ &#123;</span></span><br><span class="line">    <span class="comment">#     root /usr/share/nginx/html;</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸŒ-é…ç½®æ•´ä½“ç»“æ„"><a href="#ğŸŒ-é…ç½®æ•´ä½“ç»“æ„" class="headerlink" title="ğŸŒ é…ç½®æ•´ä½“ç»“æ„"></a>ğŸŒ é…ç½®æ•´ä½“ç»“æ„</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ç›‘å¬ç«¯å£</strong>ï¼šç›‘å¬æœ¬åœ° <code>80</code> ç«¯å£ï¼ˆHTTP é»˜è®¤ç«¯å£ï¼‰</li>
<li><strong>æœåŠ¡åç§°</strong>ï¼šç”¨äºåŒ¹é…è¯·æ±‚çš„ <code>Host</code>ï¼Œè¿™é‡Œæ˜¯ <code>localhost</code></li>
</ul>
<hr>
<h2 id="ğŸ‰-æ¬¢è¿é¡µï¼ˆæ ¹è·¯å¾„-ï¼‰"><a href="#ğŸ‰-æ¬¢è¿é¡µï¼ˆæ ¹è·¯å¾„-ï¼‰" class="headerlink" title="ğŸ‰ æ¬¢è¿é¡µï¼ˆæ ¹è·¯å¾„ /ï¼‰"></a>ğŸ‰ æ¬¢è¿é¡µï¼ˆæ ¹è·¯å¾„ <code>/</code>ï¼‰</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">200</span> <span class="string">&#x27;Nginx is running.\n&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Content-Type text/plain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¯·æ±‚ <code>/</code> ä¼šè¿”å›çº¯æ–‡æœ¬å“åº” <code>&quot;Nginx is running.&quot;</code>ï¼Œå¯ç”¨äºéªŒè¯ Nginx æ˜¯å¦å¯åŠ¨æ­£å¸¸ã€‚</li>
<li><code>add_header Content-Type text/plain</code>ï¼šæŒ‡å®šå“åº”å†…å®¹ä¸ºçº¯æ–‡æœ¬ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ”-es-ä»£ç†-EasySearch-åç«¯æœåŠ¡"><a href="#ğŸ”-es-ä»£ç†-EasySearch-åç«¯æœåŠ¡" class="headerlink" title="ğŸ” /es/ ä»£ç† EasySearch åç«¯æœåŠ¡"></a>ğŸ” <code>/es/</code> ä»£ç† EasySearch åç«¯æœåŠ¡</h2><hr>
<h3 id="ğŸšš-è¯·æ±‚å¤´å¤„ç†"><a href="#ğŸšš-è¯·æ±‚å¤´å¤„ç†" class="headerlink" title="ğŸšš è¯·æ±‚å¤´å¤„ç†"></a>ğŸšš è¯·æ±‚å¤´å¤„ç†</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>proxy_http_version 1.1</code>ï¼šç¡®ä¿ä»£ç†ä½¿ç”¨ HTTP&#x2F;1.1ï¼Œæ”¯æŒé•¿è¿æ¥ã€‚</li>
<li><code>Host</code>ï¼šä¿ç•™åŸå§‹è¯·æ±‚çš„ä¸»æœºåã€‚</li>
<li><code>X-Real-IP</code> &#x2F; <code>X-Forwarded-For</code>ï¼šä¼ é€’å®¢æˆ·ç«¯çœŸå® IPã€‚</li>
<li><code>X-Forwarded-Proto</code>ï¼šä¼ é€’åŸå§‹åè®®ï¼ˆhttp &#x2F; httpsï¼‰ã€‚</li>
<li><code>Connection &quot;&quot;</code>ï¼šç”¨äºé¿å…é»˜è®¤çš„ <code>keep-alive</code> è®¾ç½®å¼•èµ·é”™è¯¯ï¼ˆæ¨èä¿ç•™ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="ğŸ”-å¯é€‰çš„è®¤è¯å¤´ï¼ˆæ³¨é‡Šä¸­ï¼‰"><a href="#ğŸ”-å¯é€‰çš„è®¤è¯å¤´ï¼ˆæ³¨é‡Šä¸­ï¼‰" class="headerlink" title="ğŸ” å¯é€‰çš„è®¤è¯å¤´ï¼ˆæ³¨é‡Šä¸­ï¼‰"></a>ğŸ” å¯é€‰çš„è®¤è¯å¤´ï¼ˆæ³¨é‡Šä¸­ï¼‰</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># proxy_set_header Authorization &quot;Basic YWRtaW46MTIzNDU2&quot;;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¯é€‰å¼€å¯ï¼Œç”¨äºå°†è®¤è¯ä¿¡æ¯è½¬å‘åˆ°åç«¯ã€‚</li>
<li>ä¸Šé¢çš„å­—ç¬¦ä¸²æ˜¯ <code>admin:123456</code> çš„ base64 ç¼–ç ã€‚å¯ä»¥æ ¹æ®éœ€è¦å¼€å¯ã€‚</li>
</ul>
<hr>
<h3 id="ğŸŒ-CORS-è®¾ç½®ï¼ˆè·¨åŸŸï¼‰"><a href="#ğŸŒ-CORS-è®¾ç½®ï¼ˆè·¨åŸŸï¼‰" class="headerlink" title="ğŸŒ CORS è®¾ç½®ï¼ˆè·¨åŸŸï¼‰"></a>ğŸŒ CORS è®¾ç½®ï¼ˆè·¨åŸŸï¼‰</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line"><span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="string">&#x27;Authorization,Content-Type&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>å…è®¸ä»»æ„æºè®¿é—®ï¼ˆå‰ç«¯é¡µé¢å¯ä»¥è·¨åŸŸè¯·æ±‚ <code>/es/</code>ï¼‰ã€‚</li>
<li>æ”¯æŒçš„æ–¹æ³•ï¼šGETã€POSTã€OPTIONSã€‚</li>
<li>å…è®¸ä¼ é€’çš„è¯·æ±‚å¤´ï¼šAuthorization å’Œ Content-Typeã€‚</li>
<li>âœ… é€‚ç”¨äº AJAX è°ƒè¯•ã€å‰åç«¯åˆ†ç¦»ç­‰åœºæ™¯ã€‚</li>
</ul>
<hr>
<h3 id="ğŸ”§-URL-é‡å†™"><a href="#ğŸ”§-URL-é‡å†™" class="headerlink" title="ğŸ”§ URL é‡å†™"></a>ğŸ”§ URL é‡å†™</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/es/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç§»é™¤ <code>/es/</code> å‰ç¼€ï¼Œè½¬å‘ç»™åç«¯ã€‚ä¾‹å¦‚ï¼š<br>ç”¨æˆ·è¯·æ±‚ <code>/es/_cat/indices</code> å®é™…è½¬å‘åˆ° <code>/cat/indices</code>ã€‚</li>
<li><code>break</code> è¡¨ç¤ºåœ¨å½“å‰ location ä¸­ä¸­æ­¢åç»­é‡å†™æ£€æŸ¥ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ“¦-å¯é€‰é™æ€èµ„æºï¼ˆè¢«æ³¨é‡Šæ‰ï¼‰"><a href="#ğŸ“¦-å¯é€‰é™æ€èµ„æºï¼ˆè¢«æ³¨é‡Šæ‰ï¼‰" class="headerlink" title="ğŸ“¦ å¯é€‰é™æ€èµ„æºï¼ˆè¢«æ³¨é‡Šæ‰ï¼‰"></a>ğŸ“¦ å¯é€‰é™æ€èµ„æºï¼ˆè¢«æ³¨é‡Šæ‰ï¼‰</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># location /static/ &#123;</span></span><br><span class="line"><span class="comment">#     root /usr/share/nginx/html;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>è‹¥å¼€å¯ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>/static/xxx.js</code> è®¿é—® Nginx æœ¬åœ° <code>/usr/share/nginx/html/static/xxx.js</code> æ–‡ä»¶ã€‚</li>
</ul>
<h3 id="ğŸ”-å¦‚æœä½ æƒ³ä¿ç•™-es-å‰ç¼€ï¼Œåˆ™åˆ é™¤-rewrite-è¡Œã€‚"><a href="#ğŸ”-å¦‚æœä½ æƒ³ä¿ç•™-es-å‰ç¼€ï¼Œåˆ™åˆ é™¤-rewrite-è¡Œã€‚" class="headerlink" title="ğŸ” å¦‚æœä½ æƒ³ä¿ç•™ /es/ å‰ç¼€ï¼Œåˆ™åˆ é™¤ rewrite è¡Œã€‚"></a>ğŸ” å¦‚æœä½ æƒ³ä¿ç•™ <code>/es/</code> å‰ç¼€ï¼Œåˆ™åˆ é™¤ <code>rewrite</code> è¡Œã€‚</h3><hr>
<p>åœ¨å¯åŠ¨æœåŠ¡åï¼Œå½“æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è®¿é—® Nginx æ—¶ï¼Œé¡µé¢ä¼šå¼¹å‡ºèº«ä»½éªŒè¯çª—å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„è®¤è¯æç¤ºå®é™…ä¸Šæ¥è‡ªåç«¯çš„ EasySearch æœåŠ¡ï¼Œè€Œé Nginx æœ¬èº«ï¼Œè¯´æ˜è¯·æ±‚ä¸­çš„è®¤è¯ä¿¡æ¯æœªåœ¨ Nginx å±‚è¢«å¤„ç†æˆ–é€ä¼ ï¼Œå› æ­¤ç”± EasySearch å‘èµ·äº†å†æ¬¡è®¤è¯çš„è¦æ±‚ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/5177a3d4368af894e60810ed053b2f3a.png" alt="image-20250424165739653"></p>
<p>åœ¨è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Nginx æˆåŠŸä»£ç†è¯·æ±‚ï¼Œå¹¶è¿”å›äº†æ¥è‡ª EasySearch çš„ API å“åº”ï¼Œè¯´æ˜è®¤è¯æµç¨‹å·²é¡ºåˆ©é€šè¿‡ï¼Œåç«¯æœåŠ¡æ­£å¸¸å¯ç”¨ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/8ed491ae507eb9abd877d5750e8ee6d1.png" alt="image-20250424165019942"></p>
<p>å¦‚æœå¸Œæœ›ç”± Nginx ä»£ä¸ºå®Œæˆ EasySearch çš„èº«ä»½éªŒè¯ï¼Œä¹Ÿå°±æ˜¯å®ç°è‡ªåŠ¨ç™»å½•çš„æ•ˆæœï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æŒ‡ä»¤ï¼Œå°†è®¤è¯ä¿¡æ¯é€šè¿‡ HTTP å¤´éƒ¨ä¼ é€’ç»™åç«¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Authorization &quot;Basic YWRtaW46YWRtaW4=&quot;;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>YWRtaW46YWRtaW4xMjM=</code> æ˜¯ä½¿ç”¨ Base64 ç¼–ç åçš„ <code>ç”¨æˆ·å:å¯†ç </code> å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ <code>admin:admin</code>ï¼‰ã€‚Nginx åœ¨è½¬å‘è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨æºå¸¦è¯¥ Headerï¼Œä»è€Œå®ç°å¯¹ EasySearch çš„è‡ªåŠ¨è®¤è¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNginx çš„é…ç½®æ–‡ä»¶ä¿®æ”¹åä¸ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚ä¸ºäº†ç¡®ä¿é…ç½®è¢«æ­£ç¡®åŠ è½½ï¼Œéœ€åœ¨æ¯æ¬¡æ›´æ”¹é…ç½®æ–‡ä»¶åé‡å¯å¯¹åº”çš„å®¹å™¨æœåŠ¡ã€‚è¿™æ˜¯å®¹å™¨åŒ–éƒ¨ç½²ä¸­å¸¸è§çš„æ“ä½œæµç¨‹ï¼Œç¡®ä¿æ–°é…ç½®è¢«æ­£ç¡®åº”ç”¨ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/2142ca41f23c0da3a1fd4739ccde906c.png" alt="image-20250424165420050"></p>
<p>ä¸ºäº†æ›´ç›´è§‚åœ°è§‚å¯Ÿè¯·æ±‚è¡Œä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Postman è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥å‘ç°ï¼Œå³ä½¿åœ¨ Postman ä¸­æœªæ˜¾å¼æ·»åŠ ä»»ä½•è®¤è¯ä¿¡æ¯ï¼Œä¾ç„¶èƒ½å¤ŸæˆåŠŸè®¿é—® EasySearch é›†ç¾¤ã€‚è¿™è¯´æ˜å‰ç«¯æœªè¾“å…¥è®¤è¯ä¿¡æ¯ï¼Œä½†ç”±äº Nginx æ›¾ç»ç¼“å­˜äº†è®¤è¯çŠ¶æ€ï¼Œæˆ–é…ç½®äº†è‡ªåŠ¨é€ä¼ ï¼Œå¯¼è‡´åç«¯ä¾æ—§æ¥æ”¶åˆ°äº†æœ‰æ•ˆçš„è®¤è¯å¤´ï¼Œä»è€Œå…è®¸äº†è®¿é—®ã€‚</p>
<p>è¿™ç§ç°è±¡è™½ç„¶åœ¨æµ‹è¯•ä¸­æå‡äº†è®¿é—®ä¾¿åˆ©æ€§ï¼Œä½†åœ¨å®é™…éƒ¨ç½²ä¸­å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®å¯¹è®¤è¯æµç¨‹è¿›è¡Œä¸¥æ ¼æ§åˆ¶ï¼Œç¡®ä¿åç«¯æœåŠ¡ä¸ä¼šå› ä¸ºå‰ç«¯è®¤è¯æœºåˆ¶çš„ç–æ¼è€Œè¢«ç»•è¿‡ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/207855c26022e0832d615ad792c46410.png" alt="image-20250424165032915"></p>
<p>åœ¨ä¸€äº›æ•™ç¨‹ä¸­ï¼Œå¸¸ä¼šæåˆ°ä¸€ä¸ªåä¸º <strong><code>.htpasswd</code></strong> çš„æ–‡ä»¶ï¼Œå®ƒç”¨äºåœ¨ Nginx å±‚å®ç°åŸºæœ¬è®¤è¯ã€‚å½“å¯ç”¨è¯¥æœºåˆ¶åï¼ŒNginx ä¼šå¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ã€‚</p>
<p>æ­¤æ—¶ï¼Œæ˜¯å¦å°†è®¤è¯ä¿¡æ¯é€ä¼ ç»™åç«¯æœåŠ¡ï¼Œåˆ™ç”± <code>proxy_pass_request_headers</code> å‚æ•°å†³å®šã€‚è¯¥å‚æ•°é»˜è®¤å€¼ä¸º <code>on</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è®¤è¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯å‘é€çš„ Authorization å¤´éƒ¨ä¿¡æ¯ä¼šè¢« Nginx ä¸€å¹¶è½¬å‘ç»™åç«¯æœåŠ¡ã€‚</p>
<p>ä¸ºäº†éªŒè¯è¿™ä¸€è¡Œä¸ºï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„ Flask ç¨‹åºä½œä¸ºåç«¯ï¼Œç”¨äºè§‚å¯Ÿè¯·æ±‚ä¸­çš„ Header å†…å®¹ã€‚åœ¨çœŸæ­£å°†è¯·æ±‚ä»£ç†è‡³ EasySearch ä¹‹å‰ï¼Œæˆ‘å…ˆè®© Nginx å°†è¯·æ±‚åå‘ä»£ç†åˆ°è¿™ä¸ª Flask åº”ç”¨ï¼Œä»è€Œå¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ Authorization å¤´è¢«é€ä¼ çš„æƒ…å†µã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request,abort</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ğŸ“¥ Headers received from Nginx:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Host:&quot;</span>, request.headers.get(<span class="string">&#x27;Host&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;X-Real-IP:&quot;</span>, request.headers.get(<span class="string">&#x27;X-Real-IP&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;X-Forwarded-For:&quot;</span>, request.headers.get(<span class="string">&#x27;X-Forwarded-For&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;X-Forwarded-Proto:&quot;</span>, request.headers.get(<span class="string">&#x27;X-Forwarded-Proto&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(request.headers)</span><br><span class="line">    auth_header = request.headers.get(<span class="string">&#x27;Authorization&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Authorization:&quot;</span>, auth_header)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> auth_header <span class="keyword">or</span> <span class="keyword">not</span> auth_header.startswith(<span class="string">&#x27;Basic &#x27;</span>):</span><br><span class="line">        abort(<span class="number">401</span>, description=<span class="string">&quot;Missing or invalid Authorization header&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£ç  base64</span></span><br><span class="line">    encoded = auth_header.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    decoded = base64.b64decode(encoded).decode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># e.g. admin:123456</span></span><br><span class="line"></span><br><span class="line">    username, password = decoded.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(username, password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>,debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ˜¯ flask çš„æ‰“å°çš„ç»“æœ.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Host: secure-nginx.orb.local</span><br><span class="line">X-Real-IP: 192.168.215.1</span><br><span class="line">X-Forwarded-For: 192.168.215.1</span><br><span class="line">X-Forwarded-Proto: http</span><br><span class="line">Host: secure-nginx.orb.local</span><br><span class="line">X-Real-Ip: 192.168.215.1</span><br><span class="line">X-Forwarded-For: 192.168.215.1</span><br><span class="line">X-Forwarded-Proto: http</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh-TW;q=0.9,zh;q=0.8</span><br><span class="line">Cookie: perf_dv6Tr4n=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">admin admin</span><br><span class="line">192.168.X.X - - [24/Apr/2025 15:55:59] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è§£å†³åŒé‡è®¤è¯çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ç”¨äº†è®¤è¯ä¿¡æ¯é€ä¼ çš„é…ç½®(é»˜è®¤çš„ roxy_pass_request_headers on;)ã€‚å¯ç”¨è¯¥é…ç½®åï¼Œç”¨æˆ·åªéœ€åœ¨è®¿é—® Nginx æ—¶è¿›è¡Œä¸€æ¬¡æ‰‹åŠ¨èº«ä»½éªŒè¯ã€‚Nginx ä¼šå°†ç”¨æˆ·æä¾›çš„å‡­è¯é€šè¿‡ HTTP Header é€ä¼ è‡³åç«¯çš„ EasySearch æœåŠ¡ï¼Œä»è€Œé¿å…äºŒæ¬¡è®¤è¯ã€‚å½“ç”¨æˆ·ç›´æ¥è®¿é—® EasySearch æ—¶ï¼Œä¾ç„¶éœ€è¦å•ç‹¬è¾“å…¥å‡­è¯è¿›è¡Œè®¤è¯ï¼›ä½†é€šè¿‡ Nginx è®¿é—®æ—¶ï¼Œåªéœ€åœ¨å‰ç«¯è®¤è¯ä¸€æ¬¡å³å¯å®Œæˆæ•´ä¸ªè¯·æ±‚æµç¨‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">curl -k https://easysearch:9200</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;Missing authentication information for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;Security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;Missing authentication information for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;Security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;,<span class="string">&quot;status&quot;</span>:401&#125;â</span><br><span class="line">-------</span><br><span class="line"></span><br><span class="line"> curl -v -u <span class="string">&quot;admin:admin&quot;</span> http://nginxhost/es/</span><br><span class="line"></span><br><span class="line">*   Trying 192.168.5.171:9201...</span><br><span class="line">* Connected to 192.168.5.171 (192.168.5.171) port 9201</span><br><span class="line">* ALPN: curl offers h2,http/1.1</span><br><span class="line">* (304) (OUT), TLS handshake, Client hello (1):</span><br><span class="line">*  CAfile: /etc/ssl/cert.pem</span><br><span class="line">*  CApath: none</span><br><span class="line">* (304) (IN), TLS handshake, Server hello (2):</span><br><span class="line">* (304) (IN), TLS handshake, Unknown (8):</span><br><span class="line">* (304) (IN), TLS handshake, Request CERT (13):</span><br><span class="line">* (304) (IN), TLS handshake, Certificate (11):</span><br><span class="line">* SSL certificate problem: self signed certificate</span><br><span class="line">* Closing connection</span><br><span class="line">curl: (60) SSL certificate problem: self signed certificate</span><br><span class="line">More details here: https://curl.se/docs/sslcerts.html</span><br><span class="line"></span><br><span class="line">curl failed to verify the legitimacy of the server and therefore could not</span><br><span class="line">establish a secure connection to it. To learn more about this situation and</span><br><span class="line">how to fix it, please visit the web page mentioned above.</span><br><span class="line">* Host localhost:80 was resolved.</span><br><span class="line">* IPv6: ::1</span><br><span class="line">* IPv4: 127.0.0.1</span><br><span class="line">*   Trying [::1]:80...</span><br><span class="line">* Connected to localhost (::1) port 80</span><br><span class="line">* Server auth using Basic with user <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&gt; GET /es/ HTTP/1.1</span><br><span class="line">&gt; Host: localhost</span><br><span class="line">&gt; Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">&gt; User-Agent: curl/8.7.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Request completely sent off</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: nginx/1.27.4</span><br><span class="line">&lt; Date: Thu, 24 Apr 2025 07:45:10 GMT</span><br><span class="line">&lt; Content-Type: application/json; charset=UTF-8</span><br><span class="line">&lt; Content-Length: 552</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; Access-Control-Allow-Origin: *</span><br><span class="line">&lt; Access-Control-Allow-Methods: GET, POST, OPTIONS</span><br><span class="line">&lt; Access-Control-Allow-Headers: Authorization,Content-Type</span><br><span class="line">&lt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;easysearch-node1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;infinilabs&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;VcMD__DwSYSUqear8wp-XA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;distribution&quot;</span> : <span class="string">&quot;easysearch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;1.11.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;distributor&quot;</span> : <span class="string">&quot;INFINI Labs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;4d0be0343919fb1a605e3c8284326b7e069eb9bf&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2025-03-14T09:33:12.182925Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.11.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_lucene_version&quot;</span> : <span class="string">&quot;7.7.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_lucene_index_compatibility_version&quot;</span> : <span class="string">&quot;7.7.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, For Easy Search!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">* Connection <span class="comment">#0 to host localhost left intact</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ¬æ¬¡å°† Nginx çš„è®¿é—®è®¤è¯å¯†ç ä¿®æ”¹ä¸º <code>admin123</code> åï¼Œå‘ç°åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸¤æ¬¡èº«ä»½éªŒè¯çš„æç¤ºã€‚å…·ä½“è¡¨ç°ä¸ºï¼šå½“ç”¨æˆ·è¾“å…¥é”™è¯¯çš„å¯†ç æ—¶ï¼ŒNginx ä¼šé¦–å…ˆè¿”å›ä¸€æ¬¡ 401 Unauthorizedã€‚ç”±äº Nginx ä¸ EasySearch ä½¿ç”¨äº†ä¸åŒçš„è®¤è¯ä¿¡æ¯ï¼ŒNginx åœ¨å°†è¯·æ±‚å¤´ï¼ˆåŒ…æ‹¬ Authorization å­—æ®µï¼‰è½¬å‘è‡³ EasySearch æ—¶ï¼ŒEasySearch æ£€æµ‹åˆ°å‡­æ®ä¸åŒ¹é…ï¼Œä¹Ÿä¼šè¿”å›ä¸€æ¬¡ 401ã€‚ç”±æ­¤å¯¼è‡´äº†åŒé‡èº«ä»½è®¤è¯å¤±è´¥çš„ç°è±¡ï¼Œå½±å“äº†æ­£å¸¸è®¿é—®æµç¨‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">curl -v -u <span class="string">&quot;admin:admin&quot;</span> http://localhost/es/</span><br><span class="line"></span><br><span class="line">*   Trying 192.168.5.171:9201...</span><br><span class="line">* Connected to 192.168.5.171 (192.168.5.171) port 9201</span><br><span class="line">* ALPN: curl offers h2,http/1.1</span><br><span class="line">* (304) (OUT), TLS handshake, Client hello (1):</span><br><span class="line">*  CAfile: /etc/ssl/cert.pem</span><br><span class="line">*  CApath: none</span><br><span class="line">* (304) (IN), TLS handshake, Server hello (2):</span><br><span class="line">* (304) (IN), TLS handshake, Unknown (8):</span><br><span class="line">* (304) (IN), TLS handshake, Request CERT (13):</span><br><span class="line">* (304) (IN), TLS handshake, Certificate (11):</span><br><span class="line">* SSL certificate problem: self signed certificate</span><br><span class="line">* Closing connection</span><br><span class="line">curl: (60) SSL certificate problem: self signed certificate</span><br><span class="line">More details here: https://curl.se/docs/sslcerts.html</span><br><span class="line"></span><br><span class="line">curl failed to verify the legitimacy of the server and therefore could not</span><br><span class="line">establish a secure connection to it. To learn more about this situation and</span><br><span class="line">how to fix it, please visit the web page mentioned above.</span><br><span class="line">* Host localhost:80 was resolved.</span><br><span class="line">* IPv6: ::1</span><br><span class="line">* IPv4: 127.0.0.1</span><br><span class="line">*   Trying [::1]:80...</span><br><span class="line">* Connected to localhost (::1) port 80</span><br><span class="line">* Server auth using Basic with user <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&gt; GET /es/ HTTP/1.1</span><br><span class="line">&gt; Host: localhost</span><br><span class="line">&gt; Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">&gt; User-Agent: curl/8.7.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Request completely sent off</span><br><span class="line">&lt; HTTP/1.1 401 Unauthorized</span><br><span class="line">&lt; Server: nginx/1.27.4</span><br><span class="line">&lt; Date: Thu, 24 Apr 2025 09:21:09 GMT</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; Content-Length: 179</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">* Authentication problem. Ignoring this.</span><br><span class="line">&lt; WWW-Authenticate: Basic realm=<span class="string">&quot;Restricted Area&quot;</span></span><br><span class="line">&lt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.27.4&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">* Connection <span class="comment">#0 to host localhost left intact</span></span><br><span class="line">â°xuâ™~/OrbStack/docker/containers/secure-nginx/etc/nginxâ±âœ”â‰» curl -v https://192.168.5.171:9201/         (base) 17:21:09</span><br><span class="line">                                                           curl -v -u <span class="string">&quot;admin:admin123&quot;</span> http://localhost/es/</span><br><span class="line"></span><br><span class="line">*   Trying 192.168.5.171:9201...</span><br><span class="line">* Connected to 192.168.5.171 (192.168.5.171) port 9201</span><br><span class="line">* ALPN: curl offers h2,http/1.1</span><br><span class="line">* (304) (OUT), TLS handshake, Client hello (1):</span><br><span class="line">*  CAfile: /etc/ssl/cert.pem</span><br><span class="line">*  CApath: none</span><br><span class="line">* (304) (IN), TLS handshake, Server hello (2):</span><br><span class="line">* (304) (IN), TLS handshake, Unknown (8):</span><br><span class="line">* (304) (IN), TLS handshake, Request CERT (13):</span><br><span class="line">* (304) (IN), TLS handshake, Certificate (11):</span><br><span class="line">* SSL certificate problem: self signed certificate</span><br><span class="line">* Closing connection</span><br><span class="line">curl: (60) SSL certificate problem: self signed certificate</span><br><span class="line">More details here: https://curl.se/docs/sslcerts.html</span><br><span class="line"></span><br><span class="line">curl failed to verify the legitimacy of the server and therefore could not</span><br><span class="line">establish a secure connection to it. To learn more about this situation and</span><br><span class="line">how to fix it, please visit the web page mentioned above.</span><br><span class="line">* Host localhost:80 was resolved.</span><br><span class="line">* IPv6: ::1</span><br><span class="line">* IPv4: 127.0.0.1</span><br><span class="line">*   Trying [::1]:80...</span><br><span class="line">* Connected to localhost (::1) port 80</span><br><span class="line">* Server auth using Basic with user <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">&gt; GET /es/ HTTP/1.1</span><br><span class="line">&gt; Host: localhost</span><br><span class="line">&gt; Authorization: Basic YWRtaW46YWRtaW4xMjM=</span><br><span class="line">&gt; User-Agent: curl/8.7.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Request completely sent off</span><br><span class="line">&lt; HTTP/1.1 401 Unauthorized</span><br><span class="line">&lt; Server: nginx/1.27.4</span><br><span class="line">&lt; Date: Thu, 24 Apr 2025 09:21:16 GMT</span><br><span class="line">&lt; Content-Type: application/json; charset=UTF-8</span><br><span class="line">&lt; Content-Length: 381</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">* Authentication problem. Ignoring this.</span><br><span class="line">&lt; WWW-Authenticate: Basic realm=<span class="string">&quot;Security&quot;</span> charset=<span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">&lt;</span><br><span class="line">* Connection <span class="comment">#0 to host localhost left intact</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;Missing authentication information for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;Security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;Missing authentication information for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;Security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;,<span class="string">&quot;status&quot;</span>:401&#125;â</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>åœºæ™¯ç¼–å·</th>
<th>Nginx æ˜¯å¦å¼€å¯è®¤è¯</th>
<th>EasySearch æ˜¯å¦å¼€å¯è®¤è¯</th>
<th>å®é™…è®¤è¯æ¬¡æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>â‘ </td>
<td>å¦</td>
<td>å¦</td>
<td>0 æ¬¡</td>
<td>å®Œå…¨å¼€æ”¾ï¼Œä»»ä½•è¯·æ±‚æ— éœ€éªŒè¯ã€‚</td>
</tr>
<tr>
<td>â‘¡</td>
<td>å¦</td>
<td>âœ… æ˜¯</td>
<td>1 æ¬¡</td>
<td>è®¿é—®æ—¶ç›´æ¥å¼¹å‡º EasySearch çš„è®¤è¯çª—å£ï¼Œç”¨æˆ·éœ€è¾“å…¥å‡­è¯ã€‚</td>
</tr>
<tr>
<td>â‘¢</td>
<td>âœ… æ˜¯</td>
<td>å¦</td>
<td>1 æ¬¡</td>
<td>ä»…åœ¨ Nginx å±‚éªŒè¯ï¼ŒéªŒè¯é€šè¿‡åç›´æ¥è®¿é—®åç«¯ã€‚</td>
</tr>
<tr>
<td>â‘£</td>
<td>âœ… æ˜¯</td>
<td>âœ… æ˜¯</td>
<td>2 æ¬¡ï¼ˆé»˜è®¤ï¼‰</td>
<td>Nginx å’Œ EasySearch å„è‡ªè®¤è¯ï¼Œç”¨æˆ·éœ€è¿ç»­è¾“å…¥ä¸¤æ¬¡å¯†ç ã€‚</td>
</tr>
<tr>
<td>â‘¤</td>
<td>âœ… æ˜¯</td>
<td>âœ… æ˜¯</td>
<td>1 æ¬¡ï¼ˆé€ä¼ ,proxy_pass_request_headers on;ï¼‰</td>
<td>Nginx å¼€å¯è®¤è¯ï¼Œå¹¶é€šè¿‡ <code>proxy_set_header Authorization</code> é€ä¼ ç»™ EasySearchï¼Œç”¨æˆ·ä»…éœ€è¾“å…¥ä¸€æ¬¡å¯†ç å³å¯å®Œæˆè®¤è¯ã€‚</td>
</tr>
</tbody></table>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.641Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">9 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1376ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../mysql%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%97%B6%E6%8E%A5%E5%85%A5easysearch%EF%BC%8C%E9%9B%B6%E4%BB%A3%E7%A0%81%E8%BF%81%E7%A7%BB%E5%85%A8%E6%B5%81%E7%A8%8B/">MySQLæ•°æ®å®æ—¶æ¥å…¥Easysearchï¼Œé›¶ä»£ç è¿ç§»å…¨æµç¨‹</a></p><div class="content"><p>éšç€ä¸šåŠ¡å¯¹æ•°æ®æœç´¢ä¸åˆ†æèƒ½åŠ›çš„è¦æ±‚ä¸æ–­æé«˜ï¼Œè¶Šæ¥è¶Šå¤šçš„å›¢é˜Ÿå¼€å§‹å°†å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®è¿ç§»è‡³æœç´¢å¼•æ“ä¸­ã€‚<br>æœ¬ç¯‡æ–‡ç« å°†åˆ†äº«å¦‚ä½•é€šè¿‡<strong>AWS DMS</strong>ï¼Œå®ç° MySQL æ•°æ®æ— ç¼è¿ç§»åˆ°<strong>EasySearch</strong>ï¼Œå¹¶æ‰“é€šå®æ—¶åŒæ­¥é“¾è·¯çš„å…¨è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šAWS DMS åŸç”Ÿä»…æ”¯æŒæ‰˜ç®¡çš„ OpenSearch å’Œ Elasticsearchï¼Œä¸ç›´æ¥æ”¯æŒ EasySearchã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§ï¼Œä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
<hr>
<h2 id="ä¸€ã€å‡†å¤‡-MySQL-æºæ•°æ®åº“"><a href="#ä¸€ã€å‡†å¤‡-MySQL-æºæ•°æ®åº“" class="headerlink" title="ä¸€ã€å‡†å¤‡ MySQL æºæ•°æ®åº“"></a>ä¸€ã€å‡†å¤‡ MySQL æºæ•°æ®åº“</h2><h3 id="1-åˆ›å»ºæ•°æ®åº“ä¸æ•°æ®è¡¨"><a href="#1-åˆ›å»ºæ•°æ®åº“ä¸æ•°æ®è¡¨" class="headerlink" title="1. åˆ›å»ºæ•°æ®åº“ä¸æ•°æ®è¡¨"></a>1. åˆ›å»ºæ•°æ®åº“ä¸æ•°æ®è¡¨</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½å¾…è¿ç§»çš„ MySQL æ•°æ®åº“ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>DBeaver</strong>å·¥å…·ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ›´ä¸“ä¸šçš„ MySQL Workbench æˆ– DataGripã€‚</p>
<p>æ–°å»ºæ•°æ®åº“æ—¶ï¼Œé€‰æ‹©<code>utf8mb4</code>ç¼–ç ï¼Œåº“åå‘½åä¸º<code>source</code>ï¼ˆåç»­ DMS è¿ç§»ä»»åŠ¡ä¸­ä¼šç”¨åˆ°ï¼‰ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/651324794a377a2f3dc9b0a6f95cb852.png" alt="æ–°å»ºæ•°æ®åº“"></p>
<p>æ¥ä¸‹æ¥åˆ›å»ºæ•°æ®è¡¨å¹¶å®šä¹‰å­—æ®µã€‚å›¾å½¢åŒ–å·¥å…·å¯ä»¥é¿å…æ‰‹å†™ DDLï¼Œå¯¹é DBA ç”¨æˆ·éå¸¸å‹å¥½ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/bbd6173a5e00063914aa7603f5b6bce2.png" alt="æ–°å»ºè¡¨"></p>
<h3 id="2-æ’å…¥æµ‹è¯•æ•°æ®"><a href="#2-æ’å…¥æµ‹è¯•æ•°æ®" class="headerlink" title="2. æ’å…¥æµ‹è¯•æ•°æ®"></a>2. æ’å…¥æµ‹è¯•æ•°æ®</h3><p>ä¸ºäº†éªŒè¯è¿ç§»æ•ˆæœï¼Œæˆ‘ä»¬å…ˆå†™å‡ æ¡å‡æ•°æ®ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/811cb54cdfa7cbae3995aaa5915e6ccf.png" alt="å¡«å……æ•°æ®"></p>
<p>ç¡®è®¤æ•°æ®å·²æˆåŠŸå†™å…¥å¹¶æäº¤ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/230505f6100f91989676fc771ae57e76.png" alt="ç¡®è®¤æ•°æ®"></p>
<hr>
<h2 id="äºŒã€é…ç½®-AWS-DMS-è¿ç§»"><a href="#äºŒã€é…ç½®-AWS-DMS-è¿ç§»" class="headerlink" title="äºŒã€é…ç½® AWS DMS è¿ç§»"></a>äºŒã€é…ç½® AWS DMS è¿ç§»</h2><h3 id="1-åˆ›å»ºæºç«¯ç‚¹ï¼ˆMySQLï¼‰"><a href="#1-åˆ›å»ºæºç«¯ç‚¹ï¼ˆMySQLï¼‰" class="headerlink" title="1. åˆ›å»ºæºç«¯ç‚¹ï¼ˆMySQLï¼‰"></a>1. åˆ›å»ºæºç«¯ç‚¹ï¼ˆMySQLï¼‰</h3><p>åœ¨ AWS DMS ä¸­ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰<strong>æºç«¯ç‚¹</strong>ã€‚MySQL ä½œä¸ºæ•°æ®æºï¼ŒEasySearch ä½œä¸ºç›®æ ‡ç«¯ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/39995ab5314ef9a720f5d6bee7129c1c.png" alt="åˆ›å»ºæºç«¯ç‚¹"></p>
<h3 id="2-åˆ›å»ºç›®æ ‡ç«¯ç‚¹ï¼ˆEasySearchï¼‰"><a href="#2-åˆ›å»ºç›®æ ‡ç«¯ç‚¹ï¼ˆEasySearchï¼‰" class="headerlink" title="2. åˆ›å»ºç›®æ ‡ç«¯ç‚¹ï¼ˆEasySearchï¼‰"></a>2. åˆ›å»ºç›®æ ‡ç«¯ç‚¹ï¼ˆEasySearchï¼‰</h3><p>æˆ‘çš„ EasySearch éƒ¨ç½²åœ¨å…¬ç½‘çš„ Linux æœåŠ¡å™¨ä¸Šã€‚é…ç½®ç›®æ ‡ç«¯ç‚¹æ—¶ï¼Œæœ‰ä¸¤ä¸ªé‡ç‚¹ï¼š</p>
<ul>
<li>å…³é—­è®¤è¯ä¸ TLSï¼Œå°†ä¼ è¾“åè®®æ”¹ä¸º HTTP</li>
<li>ä¼ªè£…ä¸ºå¼€æº Elasticsearchï¼Œç»•è¿‡ DMS çš„åŸç”Ÿè®¤è¯è¦æ±‚</li>
</ul>
<p><img src="https://i-blog.csdnimg.cn/img_convert/c09a6ac0e944c01f6bbfe33f167a67ed.png" alt="é…ç½®Easysearchç«¯ç‚¹"></p>
<p>åªéœ€è¦è°ƒæ•´è¿™ä¸¤ä¸ªå…³é”®å‚æ•°ï¼Œå³å¯å®Œæˆå…¼å®¹ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/41848a18b4341576d8277f2da8153847.png" alt="Easysearchç«¯å…³é”®å‚æ•°"></p>
<h3 id="3-åˆ›å»ºå¤åˆ¶å®ä¾‹"><a href="#3-åˆ›å»ºå¤åˆ¶å®ä¾‹" class="headerlink" title="3. åˆ›å»ºå¤åˆ¶å®ä¾‹"></a>3. åˆ›å»ºå¤åˆ¶å®ä¾‹</h3><p>è¿ç§»ä»»åŠ¡éœ€è¦ä¸€ä¸ª<strong>å¤åˆ¶å®ä¾‹</strong>ï¼Œå³ DMS åå°è‡ªåŠ¨å¯åŠ¨çš„è¿ç§»ä»£ç†æœåŠ¡å™¨ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/492766cd92cbe05a54c06c79a30d59c7.png" alt="å¤åˆ¶å®ä¾‹"></p>
<h3 id="4-æµ‹è¯•è¿æ¥"><a href="#4-æµ‹è¯•è¿æ¥" class="headerlink" title="4. æµ‹è¯•è¿æ¥"></a>4. æµ‹è¯•è¿æ¥</h3><p>å®ä¾‹å¯åŠ¨åï¼Œè®°å¾—æµ‹è¯•æºç«¯ï¼ˆMySQLï¼‰å’Œç›®æ ‡ç«¯ï¼ˆEasySearchï¼‰çš„è¿é€šæ€§ï¼Œç¡®ä¿ç½‘ç»œæ­£å¸¸ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/c46fff38da46b609f827d294c7c8c6c1.png" alt="æµ‹è¯•MySQLè¿é€š"></p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/df9bfa3e151db2d868f1fdc519a7bc30.png" alt="æµ‹è¯•Easysearchè¿é€š"></p>
<hr>
<h2 id="ä¸‰ã€åˆ›å»ºè¿ç§»ä»»åŠ¡å¹¶å¯åŠ¨"><a href="#ä¸‰ã€åˆ›å»ºè¿ç§»ä»»åŠ¡å¹¶å¯åŠ¨" class="headerlink" title="ä¸‰ã€åˆ›å»ºè¿ç§»ä»»åŠ¡å¹¶å¯åŠ¨"></a>ä¸‰ã€åˆ›å»ºè¿ç§»ä»»åŠ¡å¹¶å¯åŠ¨</h2><p>åœ¨æ§åˆ¶å°æ–°å»ºè¿ç§»ä»»åŠ¡</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/c6fa271d4b36963241bce7cb857989b4.png" alt="æ–°å»ºè¿ç§»ä»»åŠ¡"></p>
<h3 id="1-é¢„æ£€æŸ¥ï¼šå¼€å¯-MySQL-Binlog"><a href="#1-é¢„æ£€æŸ¥ï¼šå¼€å¯-MySQL-Binlog" class="headerlink" title="1. é¢„æ£€æŸ¥ï¼šå¼€å¯ MySQL Binlog"></a>1. é¢„æ£€æŸ¥ï¼šå¼€å¯ MySQL Binlog</h3><p>ä¸ºäº†æ”¯æŒ CDCï¼ˆæŒç»­å¤åˆ¶ï¼‰ï¼Œéœ€è¦æå‰åœ¨ MySQL å¼€å¯ binlogï¼Œå¹¶è°ƒæ•´æ ¼å¼ä¸º<code>ROW</code>ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/e59c53931b83c24efc3a26db4b9acc6e.png" alt="å¼€å¯binlog"></p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/9b00b6ad96fa1d28f9cae3fdec14ec78.png" alt="ä¿®æ”¹binlogæ ¼å¼"></p>
<h3 id="2-åˆ›å»ºè¿ç§»ä»»åŠ¡"><a href="#2-åˆ›å»ºè¿ç§»ä»»åŠ¡" class="headerlink" title="2. åˆ›å»ºè¿ç§»ä»»åŠ¡"></a>2. åˆ›å»ºè¿ç§»ä»»åŠ¡</h3><p>åœ¨ DMS ä¸­åˆ›å»ºä»»åŠ¡ï¼Œé€‰æ‹©<strong>æŒç»­å¤åˆ¶</strong>æ¨¡å¼ï¼Œæºåº“å¡«å†™<code>source</code>ï¼ŒEasySearch ä¼šè‡ªåŠ¨å°†æ•°æ®è¡¨è½¬ä¸ºç´¢å¼•ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/dfaff18db6f54b65609bb1f5b1f2e65c.png" alt="è¿ç§»ä»»åŠ¡"></p>
<p>æ³¨æ„ï¼šç›®æ ‡ç«¯ä¸º EasySearch æ—¶<strong>éœ€è¦å…³é—­æ•°æ®éªŒè¯</strong>ï¼Œå¦åˆ™è¿ç§»ä»»åŠ¡ä¼šå› å…¼å®¹æ€§é—®é¢˜å¤±è´¥ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/f4dd30236ac44b6a34af28c29f4cfb87.png" alt="å…³é—­éªŒè¯"></p>
<hr>
<h2 id="å››ã€éªŒè¯è¿ç§»æ•ˆæœ"><a href="#å››ã€éªŒè¯è¿ç§»æ•ˆæœ" class="headerlink" title="å››ã€éªŒè¯è¿ç§»æ•ˆæœ"></a>å››ã€éªŒè¯è¿ç§»æ•ˆæœ</h2><h3 id="1-å¯åŠ¨ä»»åŠ¡å¹¶æŸ¥çœ‹ç´¢å¼•"><a href="#1-å¯åŠ¨ä»»åŠ¡å¹¶æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="1. å¯åŠ¨ä»»åŠ¡å¹¶æŸ¥çœ‹ç´¢å¼•"></a>1. å¯åŠ¨ä»»åŠ¡å¹¶æŸ¥çœ‹ç´¢å¼•</h3><p>EasySearch åˆå§‹åŒ–çŠ¶æ€ä¸‹åªæœ‰é»˜è®¤ç´¢å¼•ã€‚<br>å¯åŠ¨ä»»åŠ¡åï¼ŒDMS è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°ç´¢å¼•<code>newtable</code>ï¼Œæ˜ å°„ MySQL çš„æ•°æ®è¡¨ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/f147c6e4ba1706f869a162ff9498de3a.png" alt="EasySearchåˆå§‹çŠ¶æ€"></p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/b513d1400c4b61228bb8ab44c87df907.png" alt="newtableç´¢å¼•"></p>
<p>æ‰“å¼€ç´¢å¼•ï¼Œå¯ä»¥çœ‹åˆ° MySQL æ•°æ®å·²è½¬æ¢ä¸º EasySearch çš„æ–‡æ¡£æ ¼å¼ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/ba0f7e1720399a10e02c7c5c07517ce5.png" alt="æŸ¥çœ‹æ•°æ®"></p>
<h3 id="2-æ¨¡æ‹Ÿå®æ—¶æ•°æ®åŒæ­¥"><a href="#2-æ¨¡æ‹Ÿå®æ—¶æ•°æ®åŒæ­¥" class="headerlink" title="2. æ¨¡æ‹Ÿå®æ—¶æ•°æ®åŒæ­¥"></a>2. æ¨¡æ‹Ÿå®æ—¶æ•°æ®åŒæ­¥</h3><p>å› ä¸ºæ˜¯ CDC æŒç»­å¤åˆ¶æ¨¡å¼ï¼Œæˆ‘ç»§ç»­å‘ MySQL æ’å…¥æ–°æ•°æ®ï¼Œæ¨¡æ‹Ÿä¸Šæ¸¸ç³»ç»Ÿçš„å®æ—¶å†™å…¥ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/fc30add0cde7c55687b64dcbdb3ad70e.png" alt="ç»§ç»­æ’å…¥æ•°æ®"></p>
<p>EasySearch è¿™è¾¹å‡ ä¹å®æ—¶å°±æ”¶åˆ°äº†æ–°æ•°æ®ï¼ŒéªŒè¯äº†è¿ç§»é“¾è·¯çš„è¿è´¯æ€§ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/734cf8c389d53dd5aae0792d3995ee45.png" alt="æŸ¥è¯¢æ–°æ•°æ®"></p>
<hr>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>æœ¬æ¬¡å®æˆ˜ä¸­ï¼Œå€ŸåŠ© AWS DMSï¼Œæˆ‘ä»¬å®ç°äº†ä» MySQL åˆ° EasySearch çš„å®æ—¶æ•°æ®åŒæ­¥ï¼Œå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>æ— éœ€æ”¹é€ ä¸šåŠ¡ç³»ç»Ÿ</strong>ï¼Œå…¼å®¹ç°æœ‰ MySQL æ•°æ®ç»“æ„</li>
<li><strong>æ”¯æŒ CDC</strong>ï¼Œä¿è¯æ•°æ®çš„å®æ—¶åŒæ­¥ä¸ä¸€è‡´æ€§</li>
<li><strong>EasySearch åŸç”Ÿæ¥å…¥</strong>ï¼Œæ•°æ®å³è¿å³ç”¨</li>
</ul>
<p>è™½ç„¶ AWS DMS é»˜è®¤å¹¶ä¸æ”¯æŒ EasySearchï¼Œä½†é€šè¿‡åˆç†é…ç½®ä¸å…¼å®¹ç­–ç•¥ï¼Œæˆ‘ä»¬ä¾ç„¶å®ç°äº†ä¸¤è€…çš„é«˜æ•ˆæ‰“é€šã€‚</p>
<p>å¦‚æœä½ çš„ä¸šåŠ¡éœ€è¦å°† MySQL æ•°æ®å®æ—¶åŒæ­¥åˆ° EasySearchï¼Œè¿™å¥—æ–¹æ¡ˆå€¼å¾—ä¸€è¯•ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.642Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦937ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../easysearch-%E7%B4%A2%E5%BC%95%E5%85%B3%E9%97%AD%E4%B8%8E%E9%87%8D%E5%BC%80%E5%85%A8%E6%94%BB%E7%95%A5%EF%BC%9Aopen-close-%E6%93%8D%E4%BD%9C%E3%80%81%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86%E5%8F%8A%E9%98%B2%E8%AF%AF%E6%93%8D%E4%BD%9C%E9%85%8D%E7%BD%AE/">Easysearch ç´¢å¼•å…³é—­ä¸é‡å¼€å…¨æ”»ç•¥ï¼šopen close æ“ä½œã€æ‰¹é‡å¤„ç†åŠé˜²è¯¯æ“ä½œé…ç½®</a></p><div class="content"><p>åœ¨ Easysearchï¼ˆå…¼å®¹ Elasticsearch çš„æœç´¢å¼•æ“ï¼‰ä¸­ï¼Œç´¢å¼•æ˜¯å­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸºæœ¬å•å…ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•æ˜¯å¤„äº <code>open</code> çŠ¶æ€çš„ï¼Œå¯ä»¥æ­£å¸¸å†™å…¥å’Œæœç´¢ã€‚å½“ä½ æš‚æ—¶ä¸ä½¿ç”¨æŸäº›ç´¢å¼•ï¼Œä½†åˆä¸æƒ³åˆ é™¤å®ƒä»¬æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>close</code> æ“ä½œæ¥å…³é—­ç´¢å¼•ï¼Œä»è€Œé‡Šæ”¾éƒ¨åˆ†å†…å­˜èµ„æºã€‚</p>
<hr>
<h2 id="ğŸ“Š-æŸ¥çœ‹ç´¢å¼•çŠ¶æ€"><a href="#ğŸ“Š-æŸ¥çœ‹ç´¢å¼•çŠ¶æ€" class="headerlink" title="ğŸ“Š æŸ¥çœ‹ç´¢å¼•çŠ¶æ€"></a>ğŸ“Š æŸ¥çœ‹ç´¢å¼•çŠ¶æ€</h2><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ç´¢å¼•çš„çŠ¶æ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/indices?v</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•å¹¶æ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST abc/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;a&quot;</span>: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ä½ ä¼šçœ‹åˆ°ç´¢å¼• <code>abc</code> å·²åˆ›å»ºï¼Œå¹¶å¤„äº <code>open</code> çŠ¶æ€ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/2aceb6d717390a7c8df6ac76c45b748d.png" alt="ç´¢å¼• open çŠ¶æ€"></p>
<p>é»˜è®¤æ¯ä¸ªç´¢å¼•æœ‰ 1 ä¸ªä¸»åˆ†ç‰‡ã€1 ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œä¸”ä¸ºå¯è¯»å†™çŠ¶æ€ã€‚</p>
<hr>
<h2 id="ğŸ”’-å…³é—­ç´¢å¼•"><a href="#ğŸ”’-å…³é—­ç´¢å¼•" class="headerlink" title="ğŸ”’ å…³é—­ç´¢å¼•"></a>ğŸ”’ å…³é—­ç´¢å¼•</h2><p>å¦‚æœä½ æš‚æ—¶ä¸éœ€è¦æŸä¸ªç´¢å¼•ï¼Œåˆä¸å¸Œæœ›åˆ é™¤å®ƒï¼Œå¯ä»¥å°†å…¶å…³é—­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST abc/_close</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;abc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;closed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸš«-å…³é—­åçš„è¡Œä¸ºé™åˆ¶"><a href="#ğŸš«-å…³é—­åçš„è¡Œä¸ºé™åˆ¶" class="headerlink" title="ğŸš« å…³é—­åçš„è¡Œä¸ºé™åˆ¶"></a>ğŸš« å…³é—­åçš„è¡Œä¸ºé™åˆ¶</h2><p>å…³é—­ç´¢å¼•åï¼Œä¸ä»…ä¸èƒ½å†™å…¥ï¼Œ<strong>è¿æœç´¢éƒ½æ— æ³•è¿›è¡Œ</strong>ã€‚</p>
<h3 id="ğŸ”-æœç´¢å·²å…³é—­ç´¢å¼•ï¼ˆ403-é”™è¯¯ï¼‰"><a href="#ğŸ”-æœç´¢å·²å…³é—­ç´¢å¼•ï¼ˆ403-é”™è¯¯ï¼‰" class="headerlink" title="ğŸ” æœç´¢å·²å…³é—­ç´¢å¼•ï¼ˆ403 é”™è¯¯ï¼‰"></a>ğŸ” æœç´¢å·²å…³é—­ç´¢å¼•ï¼ˆ403 é”™è¯¯ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET abc/_search</span><br></pre></td></tr></table></figure>

<p>è¿”å›ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cluster_block_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index [abc] blocked by: [FORBIDDEN/4/index closed];&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">403</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/f1edce36572eb74cd2a9e0fdb8a04223.png" alt="å…³é—­åæœç´¢æŠ¥é”™"></p>
<hr>
<h3 id="ğŸ“-å†™å…¥å·²å…³é—­ç´¢å¼•ï¼ˆ400-é”™è¯¯ï¼‰"><a href="#ğŸ“-å†™å…¥å·²å…³é—­ç´¢å¼•ï¼ˆ400-é”™è¯¯ï¼‰" class="headerlink" title="ğŸ“ å†™å…¥å·²å…³é—­ç´¢å¼•ï¼ˆ400 é”™è¯¯ï¼‰"></a>ğŸ“ å†™å…¥å·²å…³é—­ç´¢å¼•ï¼ˆ400 é”™è¯¯ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST abc/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;a&quot;</span>: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index_closed_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;closed&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">400</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/bbad6f804fbbdbc5b7849c2f3c34864d.png" alt="å…³é—­åå†™å…¥æŠ¥é”™"></p>
<hr>
<h2 id="âœ³ï¸-æ‰¹é‡å…³é—­ç´¢å¼•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰"><a href="#âœ³ï¸-æ‰¹é‡å…³é—­ç´¢å¼•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰" class="headerlink" title="âœ³ï¸ æ‰¹é‡å…³é—­ç´¢å¼•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰"></a>âœ³ï¸ æ‰¹é‡å…³é—­ç´¢å¼•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST ab*,<span class="built_in">test</span>/_close</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;closed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;abd&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;closed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;abc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;closed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/4448625bea11f429679f4ca32e28c2e0.png" alt="æ‰¹é‡å…³é—­æˆåŠŸ"></p>
<p>ç¡®è®¤ç´¢å¼•çŠ¶æ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/indices?v</span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/8ce15dcd81a81351aab9dce010749dea.png" alt="ç´¢å¼•å·²å…³é—­"></p>
<hr>
<h2 id="ğŸ”“-é‡æ–°æ‰“å¼€ç´¢å¼•"><a href="#ğŸ”“-é‡æ–°æ‰“å¼€ç´¢å¼•" class="headerlink" title="ğŸ”“ é‡æ–°æ‰“å¼€ç´¢å¼•"></a>ğŸ”“ é‡æ–°æ‰“å¼€ç´¢å¼•</h2><p>å½“éœ€è¦é‡æ–°å¯ç”¨è¿™äº›ç´¢å¼•æ—¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST */_open</span><br></pre></td></tr></table></figure>

<p>è¿”å›ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/b9fe797a08c2fb1b6bf183b04633c8a8.png" alt="æ‰“å¼€ç´¢å¼•æˆåŠŸ"></p>
<hr>
<h2 id="âš™ï¸-ç¦æ­¢å…³é—­ç´¢å¼•çš„é›†ç¾¤é…ç½®"><a href="#âš™ï¸-ç¦æ­¢å…³é—­ç´¢å¼•çš„é›†ç¾¤é…ç½®" class="headerlink" title="âš™ï¸ ç¦æ­¢å…³é—­ç´¢å¼•çš„é›†ç¾¤é…ç½®"></a>âš™ï¸ ç¦æ­¢å…³é—­ç´¢å¼•çš„é›†ç¾¤é…ç½®</h2><p>æœ‰äº›åœºæ™¯ä¸­ï¼ˆå¦‚è¿è¥å¹³å°é˜²æ­¢è¯¯æ“ä½œï¼‰ï¼Œç®¡ç†å‘˜å¯èƒ½ä¼š<strong>ç¦æ­¢ç´¢å¼•å…³é—­æ“ä½œ</strong>ã€‚è®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cluster.indices.close.enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœè¡¨ç¤ºè®¾ç½®å·²ç”Ÿæ•ˆï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cluster&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;close&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;transient&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/img_convert/a180ec9eea33c1a3027762d56a92fea8.png" alt="è®¾ç½®ç¦æ­¢å…³é—­ç´¢å¼•"></p>
<hr>
<h2 id="ğŸ§¯-ç¦æ­¢åå…³é—­ç´¢å¼•ä¼šæŠ¥é”™"><a href="#ğŸ§¯-ç¦æ­¢åå…³é—­ç´¢å¼•ä¼šæŠ¥é”™" class="headerlink" title="ğŸ§¯ ç¦æ­¢åå…³é—­ç´¢å¼•ä¼šæŠ¥é”™"></a>ğŸ§¯ ç¦æ­¢åå…³é—­ç´¢å¼•ä¼šæŠ¥é”™</h2><p>å†æ¬¡å°è¯•å…³é—­ç´¢å¼•æ—¶ï¼Œå°†è¿”å›å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_state_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;closing indices is disabled - set [cluster.indices.close.enable: true] to enable it. NOTE: closed indices still consume a significant amount of diskspace&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_state_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;closing indices is disabled - set [cluster.indices.close.enable: true] to enable it. NOTE: closed indices still consume a significant amount of diskspace&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-å¦‚ä½•ç¡®è®¤å…³é—­è¢«ç¦ç”¨ï¼Ÿ"><a href="#ğŸ”-å¦‚ä½•ç¡®è®¤å…³é—­è¢«ç¦ç”¨ï¼Ÿ" class="headerlink" title="ğŸ” å¦‚ä½•ç¡®è®¤å…³é—­è¢«ç¦ç”¨ï¼Ÿ"></a>ğŸ” å¦‚ä½•ç¡®è®¤å…³é—­è¢«ç¦ç”¨ï¼Ÿ</h2><p>æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cluster/settings</span><br></pre></td></tr></table></figure>

<p>ç»“æœä¼šåŒ…å«ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;persistent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cluster&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;indices&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;close&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index_state_management&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;template_migration&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;control&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-1&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rollup&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;search&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;hours_before&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;transient&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h2><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>æ˜¯å¦æ”¯æŒ</th>
<th>æ¡ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td><code>POST /&lt;index&gt;/_close</code></td>
<td>âœ… é»˜è®¤æ”¯æŒ</td>
<td>é™¤éè®¾ç½® <code>cluster.indices.close.enable: false</code></td>
</tr>
<tr>
<td><code>POST /&lt;index&gt;/_open</code></td>
<td>âœ… æ€»æ˜¯æ”¯æŒ</td>
<td>æ— éœ€é¢å¤–å¼€å¯</td>
</tr>
<tr>
<td><code>POST ab*/_close</code></td>
<td>âœ… æ”¯æŒæ‰¹é‡å…³é—­</td>
<td>åŒä¸Š</td>
</tr>
<tr>
<td>æŸ¥çœ‹å…³é—­é™åˆ¶é…ç½®</td>
<td><code>GET _cluster/settings?include_defaults=true</code></td>
<td></td>
</tr>
</tbody></table>
<p>å…³é—­ç´¢å¼•é€‚ç”¨äºèµ„æºæ§åˆ¶ã€è°ƒè¯•æ’æŸ¥ç­‰åœºæ™¯ï¼Œä½†è¦æ³¨æ„ï¼š<strong>å…³é—­ç´¢å¼•ä»ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œä¸ä¼šé‡Šæ”¾å­˜å‚¨</strong>ï¼Œä»…ä»…æ˜¯èŠ‚çœå†…å­˜å’Œ CPU èµ„æºã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.642Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">12 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1732ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../easysearch-%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BF%AE%E6%94%B9%E7%B4%A2%E5%BC%95%E4%B8%BB%E5%88%86%E7%89%87%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%88split-shrink-reindex/">Easysearch å®æˆ˜æŒ‡å—ï¼šä¿®æ”¹ç´¢å¼•ä¸»åˆ†ç‰‡çš„ä¸‰ç§æ–¹å¼ï¼ˆsplit  shrink  reindex</a></p><div class="content"><p>åœ¨ Easysearchï¼ˆå…¼å®¹ Elasticsearchï¼‰çš„æ¶æ„ä¸­ï¼Œç´¢å¼•çš„ä¸»åˆ†ç‰‡æ•°ï¼ˆ<code>index.number_of_shards</code>ï¼‰ä¸€æ—¦åˆ›å»ºå°±æ— æ³•ç›´æ¥ä¿®æ”¹ã€‚è¿™ç»™å®é™…ä½¿ç”¨å¸¦æ¥æŒ‘æˆ˜ï¼š</p>
<ul>
<li>è®¾å¾—å¤ªå°‘ï¼ŒæŸ¥è¯¢&#x2F;å†™å…¥ç“¶é¢ˆå‡ºç°ï¼›</li>
<li>è®¾å¾—å¤ªå¤šï¼Œèµ„æºæµªè´¹ã€é›†ç¾¤ä¸ç¨³ï¼›</li>
<li>æƒ³å˜æ›´ç»“æ„ï¼Œå´å‘ç°é…ç½®æ˜¯â€œå†™æ­»â€çš„ã€‚</li>
</ul>
<p>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£ä¸‰ç§å¸¸è§ä½†æœ¬è´¨ä¸åŒçš„ç´¢å¼•é‡æ„æ–¹å¼ï¼š<code>split</code>ã€<code>shrink</code>ã€<code>reindex</code>ï¼Œæ•™ä½ å¦‚ä½•é€‰æ‹©åˆé€‚æ–¹æ¡ˆã€å®‰å…¨æ“ä½œï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆ<strong>split + shrink æ— æ³•å–ä»£ reindex</strong>ã€‚</p>
<hr>
<h2 id="ğŸ“Œ-ä¸€å¼ å›¾æ¦‚è§ˆä¸‰ç§æ–¹å¼"><a href="#ğŸ“Œ-ä¸€å¼ å›¾æ¦‚è§ˆä¸‰ç§æ–¹å¼" class="headerlink" title="ğŸ“Œ ä¸€å¼ å›¾æ¦‚è§ˆä¸‰ç§æ–¹å¼"></a>ğŸ“Œ ä¸€å¼ å›¾æ¦‚è§ˆä¸‰ç§æ–¹å¼</h2><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ˜¯å¦é‡å»ºç´¢å¼•</th>
<th>å¯å¦åŸåä½¿ç”¨</th>
<th>æ”¹åˆ†ç‰‡æ•°é™åˆ¶</th>
<th>æ˜¯å¦ä¿ç•™æ•°æ®</th>
<th>æ˜¯å¦æ”¹ç»“æ„ï¼ˆmapping&#x2F;settingsï¼‰</th>
<th>å¸¸è§ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>split</code></td>
<td>âœ… æ–°å»ºç´¢å¼•</td>
<td>âŒ ä¸æ”¯æŒ</td>
<td>åªèƒ½ Ã— å€æ•°ï¼ˆå¦‚ 1â†’2â†’4ï¼‰</td>
<td>âœ… æ˜¯</td>
<td>âŒ å¦</td>
<td>æå‡å†™å…¥å¹¶å‘&#x2F;è¯»æ€§èƒ½</td>
</tr>
<tr>
<td><code>shrink</code></td>
<td>âœ… æ–°å»ºç´¢å¼•</td>
<td>âŒ ä¸æ”¯æŒ</td>
<td>åªèƒ½ Ã· å› æ•°ï¼ˆå¦‚ 4â†’2â†’1ï¼‰</td>
<td>âœ… æ˜¯</td>
<td>âŒ å¦</td>
<td>åˆå¹¶å†å²æ•°æ®åˆ†ç‰‡</td>
</tr>
<tr>
<td><code>reindex</code></td>
<td>âœ… æ–°å»ºç´¢å¼•</td>
<td>âœ… æ”¯æŒï¼ˆå…ˆåˆ ï¼‰</td>
<td>ä»»æ„</td>
<td>âœ… æ˜¯</td>
<td>âœ… æ”¯æŒ</td>
<td>è‡ªå®šä¹‰ç»“æ„&#x2F;åˆ†ç‰‡&#x2F;å‡çº§</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ”§-ä¸€ã€splitï¼šå°†åˆ†ç‰‡æ•°é‡å€å¢ï¼ˆå¦‚-1-â†’-2-â†’-4ï¼‰"><a href="#ğŸ”§-ä¸€ã€splitï¼šå°†åˆ†ç‰‡æ•°é‡å€å¢ï¼ˆå¦‚-1-â†’-2-â†’-4ï¼‰" class="headerlink" title="ğŸ”§ ä¸€ã€splitï¼šå°†åˆ†ç‰‡æ•°é‡å€å¢ï¼ˆå¦‚ 1 â†’ 2 â†’ 4ï¼‰"></a>ğŸ”§ ä¸€ã€splitï¼šå°†åˆ†ç‰‡æ•°é‡å€å¢ï¼ˆå¦‚ 1 â†’ 2 â†’ 4ï¼‰</h2><blockquote>
<p><strong>é€‚ç”¨äºï¼š</strong> æå‡å¹¶å‘èƒ½åŠ›ã€å¢åŠ æŸ¥è¯¢&#x2F;å†™å…¥å¹¶è¡Œåº¦ã€‚</p>
</blockquote>
<h3 id="âœ…-æ¡ä»¶è¦æ±‚ï¼š"><a href="#âœ…-æ¡ä»¶è¦æ±‚ï¼š" class="headerlink" title="âœ… æ¡ä»¶è¦æ±‚ï¼š"></a>âœ… æ¡ä»¶è¦æ±‚ï¼š</h3><ul>
<li>åŸå§‹ç´¢å¼•å¿…é¡»è®¾ç½® <code>index.blocks.write: true</code>ï¼ˆåªè¯»ï¼‰ï¼›ä¸»è¦æ˜¯é˜²æ­¢å†™å…¥ç»§ç»­å¢é•¿ã€‚</li>
<li>æ–°åˆ†ç‰‡æ•°å¿…é¡»æ˜¯åŸä¸»åˆ†ç‰‡çš„ <strong>å€æ•°</strong>ï¼›</li>
<li>ä¸èƒ½ä½¿ç”¨åŸåï¼Œç›®æ ‡ç´¢å¼•å¿…é¡»å¦èµ·æ–°åã€‚</li>
</ul>
<h3 id="ğŸ› -æ“ä½œç¤ºä¾‹ï¼š"><a href="#ğŸ› -æ“ä½œç¤ºä¾‹ï¼š" class="headerlink" title="ğŸ›  æ“ä½œç¤ºä¾‹ï¼š"></a>ğŸ›  æ“ä½œç¤ºä¾‹ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®åªè¯»</span></span><br><span class="line">PUT /abc/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index.blocks.write&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸è®¾ç½®ä¸ºåªè¯»çš„è¯ï¼Œå°±æŠ¥é”™ï¼š</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;root_cause&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;illegal_state_exception&quot;</span>,</span><br><span class="line">        <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;index abc must be read-only to resize index. use \&quot;index.blocks.write=true\&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;illegal_state_exception&quot;</span>,</span><br><span class="line">    <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;index abc must be read-only to resize index. use \&quot;index.blocks.write=true\&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: 500</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‹†åˆ†ç´¢å¼•ï¼ˆ1-â†’-4ï¼‰"><a href="#æ‹†åˆ†ç´¢å¼•ï¼ˆ1-â†’-4ï¼‰" class="headerlink" title="æ‹†åˆ†ç´¢å¼•ï¼ˆ1 â†’ 4ï¼‰"></a>æ‹†åˆ†ç´¢å¼•ï¼ˆ1 â†’ 4ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /abc/_split/abc_split_2shards</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.number_of_shards&quot;: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;acknowledged&quot;: true,</span><br><span class="line">  &quot;shards_acknowledged&quot;: true,</span><br><span class="line">  &quot;index&quot;: &quot;abc_split_2shards&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æ˜¯å€æ•°ä¹Ÿä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_argument_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;the number of source shards [13] must be a factor of [25]&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_argument_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;the number of source shards [13] must be a factor of [25]&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">400</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç´¢å¼•çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /abc_split_2shards/_settings?flat_settings=true</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;_settingsï¼šElasticsearch æä¾›çš„ API ç«¯ç‚¹ï¼Œç”¨äºæŸ¥çœ‹ç´¢å¼•è®¾ç½®ã€‚<br>?flat_settings&#x3D;trueï¼šæŸ¥è¯¢å‚æ•°ï¼Œä½¿è¿”å›ç»“æœä»¥æ‰å¹³åŒ–çš„é”®å€¼å¯¹å½¢å¼å±•ç¤ºï¼ˆè€ŒéåµŒå¥—ç»“æ„ï¼‰ã€‚</p>
</blockquote>
<p>å¯ä»¥çœ‹åˆ°ç›®æ ‡çš„ç´¢å¼•ä¹Ÿæ˜¯åªè¯»çš„ï¼Œè¿™åœ¨ Easysearch é‡Œæ˜¯ ElasticSearch ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;abc_split_2shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index.blocks.write&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1750747232004&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;abc_split_2shards&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.resize.source.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;abc&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.resize.source.uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3NY_W5B_TzimoEGdoA74cg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.routing.allocation.initial_recovery._id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.routing_partition_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;e2BQiTRKTlaTS5OE8kmiXw&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.version.created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1130099&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.version.upgraded&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1130099&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨è¿™ä¸ªæ¥è§£é” write blockã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /abc_split_2shards/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.blocks.write&quot;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ ä¸æƒ³è®©ç›®æ ‡ç´¢å¼•å˜æˆåªè¯»ã€‚ä¹Ÿå¯ä»¥åœ¨_split çš„æ—¶å€™åŠ ä¸Š â€œindex.blocks.writeâ€: falseã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /abc_split_2sharxds/_split/qwe</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index.blocks.write&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index.number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">26</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-äºŒã€shrinkï¼šå°†åˆ†ç‰‡æ•°é‡æ•´é™¤å‹ç¼©ï¼ˆå¦‚-8-â†’-4-â†’-1ï¼‰"><a href="#ğŸ”§-äºŒã€shrinkï¼šå°†åˆ†ç‰‡æ•°é‡æ•´é™¤å‹ç¼©ï¼ˆå¦‚-8-â†’-4-â†’-1ï¼‰" class="headerlink" title="ğŸ”§ äºŒã€shrinkï¼šå°†åˆ†ç‰‡æ•°é‡æ•´é™¤å‹ç¼©ï¼ˆå¦‚ 8 â†’ 4 â†’ 1ï¼‰"></a>ğŸ”§ äºŒã€shrinkï¼šå°†åˆ†ç‰‡æ•°é‡æ•´é™¤å‹ç¼©ï¼ˆå¦‚ 8 â†’ 4 â†’ 1ï¼‰</h2><blockquote>
<p><strong>é€‚ç”¨äºï¼š</strong> å†å²å½’æ¡£æ•°æ®å‹ç¼©ã€èŠ‚çœå†…å­˜ã€æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</blockquote>
<h3 id="âœ…-æ¡ä»¶è¦æ±‚ï¼š-1"><a href="#âœ…-æ¡ä»¶è¦æ±‚ï¼š-1" class="headerlink" title="âœ… æ¡ä»¶è¦æ±‚ï¼š"></a>âœ… æ¡ä»¶è¦æ±‚ï¼š</h3><ul>
<li>æ‰€æœ‰ä¸»åˆ†ç‰‡å¿…é¡»é›†ä¸­åœ¨åŒä¸€èŠ‚ç‚¹ï¼›</li>
<li>åŸç´¢å¼•å¿…é¡»åªè¯»ï¼›</li>
<li>æ–°åˆ†ç‰‡æ•°å¿…é¡»æ˜¯æ—§åˆ†ç‰‡æ•°çš„ <strong>å› æ•°</strong>ï¼›</li>
<li>åŒæ ·ä¸èƒ½ä¿ç•™åŸåï¼Œéœ€æ–°å»ºç´¢å¼•åã€‚</li>
</ul>
<h3 id="ğŸ› -æ“ä½œç¤ºä¾‹ï¼š-1"><a href="#ğŸ› -æ“ä½œç¤ºä¾‹ï¼š-1" class="headerlink" title="ğŸ›  æ“ä½œç¤ºä¾‹ï¼š"></a>ğŸ›  æ“ä½œç¤ºä¾‹ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼ºåˆ¶æ‰€æœ‰ä¸»åˆ†ç‰‡è°ƒåº¦åˆ° node-1</span></span><br><span class="line">PUT /source_index/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index.blocks.write&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;index.routing.allocation.require._name&quot;</span>: <span class="string">&quot;node-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;index.number_of_replicas&quot;</span>: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœä¸æ˜¯åªè¯»åŒæ ·æŠ¥é”™ï¼š</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;error&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;root_cause&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;illegal_state_exception&quot;</span>,</span><br><span class="line">        <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;index test1 must be read-only to resize index. use \&quot;index.blocks.write=true\&quot;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;illegal_state_exception&quot;</span>,</span><br><span class="line">    <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;index test1 must be read-only to resize index. use \&quot;index.blocks.write=true\&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: 500</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆå¹¶ä¸ºä¸€ä¸ªåˆ†ç‰‡"><a href="#åˆå¹¶ä¸ºä¸€ä¸ªåˆ†ç‰‡" class="headerlink" title="åˆå¹¶ä¸ºä¸€ä¸ªåˆ†ç‰‡"></a>åˆå¹¶ä¸ºä¸€ä¸ªåˆ†ç‰‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /source_index/_shrink/source_index_1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">      &quot;index.blocks.write&quot;: false,</span><br><span class="line">    &quot;index.number_of_shards&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è§£é”"><a href="#è§£é”" class="headerlink" title="è§£é”"></a>è§£é”</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /source_index_1/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.blocks.write&quot;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-ä¸‰ã€reindexï¼šæ‹·è´æ•°æ®-æ–°å»ºç»“æ„-æ›¿æ¢æ—§ç´¢å¼•"><a href="#ğŸ”§-ä¸‰ã€reindexï¼šæ‹·è´æ•°æ®-æ–°å»ºç»“æ„-æ›¿æ¢æ—§ç´¢å¼•" class="headerlink" title="ğŸ”§ ä¸‰ã€reindexï¼šæ‹·è´æ•°æ® + æ–°å»ºç»“æ„ + æ›¿æ¢æ—§ç´¢å¼•"></a>ğŸ”§ ä¸‰ã€reindexï¼šæ‹·è´æ•°æ® + æ–°å»ºç»“æ„ + æ›¿æ¢æ—§ç´¢å¼•</h2><blockquote>
<p><strong>é€‚ç”¨äºï¼š</strong> ä»»æ„ä¿®æ”¹åˆ†ç‰‡æ•°ã€å­—æ®µç»“æ„ã€settingsï¼Œæˆ–å®ç°â€œçœ‹èµ·æ¥æ”¹äº†åŸç´¢å¼•â€çš„æ•ˆæœã€‚</p>
</blockquote>
<h3 id="âœ…-ä¼˜åŠ¿ï¼š"><a href="#âœ…-ä¼˜åŠ¿ï¼š" class="headerlink" title="âœ… ä¼˜åŠ¿ï¼š"></a>âœ… ä¼˜åŠ¿ï¼š</h3><ul>
<li>å”¯ä¸€æ”¯æŒ<strong>ä»»æ„åˆ†ç‰‡æ•°ä¿®æ”¹</strong>ï¼›</li>
<li>å¯è‡ªç”±é‡æ„ mappingã€settingsï¼›</li>
<li>å¯æ”¯æŒ<strong>ä¿ç•™åŸå</strong>ï¼ˆåˆ é™¤æ—§ç´¢å¼• + é‡æ–°åˆ›å»ºï¼‰ï¼›</li>
<li>å¯å¸¦æ¡ä»¶ã€åˆ†é¡µã€è„šæœ¬æ‹·è´æ•°æ®ï¼›</li>
<li>æ˜¯å”¯ä¸€å¯æ¨¡æ‹Ÿâ€œä¿®æ”¹åŸç´¢å¼•åˆ†ç‰‡â€çš„æ–¹å¼ã€‚</li>
</ul>
<h3 id="ğŸ› -æ“ä½œæ­¥éª¤ï¼ˆä¿ç•™åŸåä½†æ”¹å˜ç»“æ„ï¼‰ï¼š"><a href="#ğŸ› -æ“ä½œæ­¥éª¤ï¼ˆä¿ç•™åŸåä½†æ”¹å˜ç»“æ„ï¼‰ï¼š" class="headerlink" title="ğŸ›  æ“ä½œæ­¥éª¤ï¼ˆä¿ç•™åŸåä½†æ”¹å˜ç»“æ„ï¼‰ï¼š"></a>ğŸ›  æ“ä½œæ­¥éª¤ï¼ˆä¿ç•™åŸåä½†æ”¹å˜ç»“æ„ï¼‰ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆ›å»ºä¸´æ—¶ç´¢å¼•ç»“æ„ï¼ˆä½ æƒ³è¦çš„æ–°ç»“æ„ï¼‰</span></span><br><span class="line">PUT /my_index_v2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index.number_of_shards&quot;</span>: 5,</span><br><span class="line">    <span class="string">&quot;index.number_of_replicas&quot;</span>: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span> &#125;,</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ‹·è´æ•°æ®</span></span><br><span class="line">POST /_reindex</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: &#123; <span class="string">&quot;index&quot;</span>: <span class="string">&quot;my_index&quot;</span> &#125;,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>:   &#123; <span class="string">&quot;index&quot;</span>: <span class="string">&quot;my_index_v2&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ é™¤æ—§ç´¢å¼•ï¼ˆè°¨æ…ï¼‰</span></span><br><span class="line">DELETE /my_index</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åˆ›å»ºåŒåç´¢å¼•ï¼ˆæ–°ç»“æ„ï¼‰</span></span><br><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;index.number_of_shards&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;index.number_of_replicas&quot;</span>: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;user&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span> &#125;,</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å†æ¬¡æ‹·è´æ•°æ®ï¼ˆå›å¡«ï¼‰</span></span><br><span class="line">POST /_reindex</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: &#123; <span class="string">&quot;index&quot;</span>: <span class="string">&quot;my_index_v2&quot;</span> &#125;,</span><br><span class="line">  <span class="string">&quot;dest&quot;</span>:   &#123; <span class="string">&quot;index&quot;</span>: <span class="string">&quot;my_index&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">6.  æŸ¥çœ‹ç´¢å¼•ï¼Œå¹¶ä¸”åˆ é™¤ç›®æ ‡ç´¢å¼•</span><br><span class="line">GET _cat/indices/my_index*?v</span><br><span class="line"></span><br><span class="line">![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/64f99ab7b3ba4b4a8e18d53d4e32fab5.png)</span><br><span class="line">æœ€ååˆ é™¤my_index_v2 å³å¯</span><br><span class="line"></span><br><span class="line">DELETE /my_index_v2</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âš ï¸-ä¸ºä»€ä¹ˆ-shrink-split-ä¸èƒ½æ›¿ä»£-reindexï¼Ÿ"><a href="#âš ï¸-ä¸ºä»€ä¹ˆ-shrink-split-ä¸èƒ½æ›¿ä»£-reindexï¼Ÿ" class="headerlink" title="âš ï¸ ä¸ºä»€ä¹ˆ shrink + split ä¸èƒ½æ›¿ä»£ reindexï¼Ÿ"></a>âš ï¸ ä¸ºä»€ä¹ˆ shrink + split ä¸èƒ½æ›¿ä»£ reindexï¼Ÿ</h2><p>å¾ˆå¤šç”¨æˆ·ä¼šé—®ï¼šèƒ½ä¸èƒ½ <code>shrink â†’ split</code> æˆ– <code>split â†’ shrink</code> æ‹¼æ¥å‡ºä»»æ„åˆ†ç‰‡æ•°ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>æ•°å­¦ä¸Šä¸æˆç«‹ + å®æˆ˜é™åˆ¶å¤ªå¤šã€‚</strong></p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>split åªèƒ½å€å¢</td>
<td>ä¾‹å¦‚ï¼š1 â†’ 2 â†’ 4 â†’ 8 âœ…ï¼Œä½†ä¸èƒ½å˜æˆ 3ã€5ã€6 âŒ</td>
</tr>
<tr>
<td>shrink åªèƒ½æ•´é™¤</td>
<td>ä¾‹å¦‚ï¼š8 â†’ 4 â†’ 2 â†’ 1 âœ…ï¼Œä½†ä¸èƒ½å˜æˆ 3ã€5 âŒ</td>
</tr>
<tr>
<td>äºŒè€…ç»„åˆ</td>
<td>å—é™äºå€æ•° Ã— å› æ•°å…³ç³»ï¼Œ<strong>ä¸æ˜¯ä¸‡èƒ½å˜æ¢</strong>ï¼ˆå¤§å¤šæ•°ç›®æ ‡åˆ†ç‰‡æ•°æ ¹æœ¬åˆ°ä¸äº†ï¼‰</td>
</tr>
</tbody></table>
<h3 id="âœ…-å”¯ä¸€ä¸‡èƒ½æ–¹å¼ï¼šreindex"><a href="#âœ…-å”¯ä¸€ä¸‡èƒ½æ–¹å¼ï¼šreindex" class="headerlink" title="âœ… å”¯ä¸€ä¸‡èƒ½æ–¹å¼ï¼šreindex"></a>âœ… å”¯ä¸€ä¸‡èƒ½æ–¹å¼ï¼š<code>reindex</code></h3><p>å¯ä»¥ä»»æ„ï¼š</p>
<ul>
<li>è°ƒæ•´åˆ†ç‰‡æ•° âœ…</li>
<li>ä¿®æ”¹å­—æ®µç»“æ„ âœ…</li>
<li>æ”¹ settings âœ…</li>
<li>ä¿ç•™ç´¢å¼•å âœ…</li>
</ul>
<hr>
<h2 id="âœ…-æœ€ä½³å®è·µæ€»ç»“"><a href="#âœ…-æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="âœ… æœ€ä½³å®è·µæ€»ç»“"></a>âœ… æœ€ä½³å®è·µæ€»ç»“</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èæ–¹å¼</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody><tr>
<td>å†™å…¥å¹¶å‘ä¸è¶³ï¼ˆ1 â†’ 4ï¼‰</td>
<td>split</td>
<td>å¿«é€Ÿã€ä½é£é™©</td>
</tr>
<tr>
<td>å­˜å‚¨&#x2F;æŸ¥è¯¢ä¼˜åŒ–ï¼ˆ8 â†’ 1ï¼‰</td>
<td>shrink</td>
<td>èŠ‚çœèµ„æºã€é€‚åˆå½’æ¡£</td>
</tr>
<tr>
<td>ä¿®æ”¹ç´¢å¼•ç»“æ„ã€å­—æ®µã€settings</td>
<td>reindex</td>
<td>æœ€çµæ´»ã€å”¯ä¸€æ”¯æŒä»»æ„ç»“æ„</td>
</tr>
<tr>
<td>æƒ³ä¿ç•™åŸåä½†æ”¹åˆ†ç‰‡æ•°</td>
<td>reindexï¼ˆé…åˆ delete&#x2F;recreateï¼‰</td>
<td>åªæœ‰å®ƒèƒ½å®ç°</td>
</tr>
<tr>
<td>ä¸æƒ³ä¸­æ–­æœåŠ¡</td>
<td>reindex + alias åˆ‡æ¢</td>
<td>alias å®ç°æ— ç¼æ›¿æ¢</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸš€-é™„åŠ å»ºè®®"><a href="#ğŸš€-é™„åŠ å»ºè®®" class="headerlink" title="ğŸš€ é™„åŠ å»ºè®®"></a>ğŸš€ é™„åŠ å»ºè®®</h2><p>S* split&#x2F;shrink ä¸€èˆ¬ç”¨äº <strong>çº¿ä¸Šå°èŒƒå›´ç»“æ„è°ƒæ•´</strong>ï¼›</p>
<ul>
<li>reindex ç”¨äº <strong>å‡çº§ã€æ¸…æ´—ã€ç»“æ„ä¼˜åŒ–</strong>ç­‰æ›´å¤§ç²’åº¦çš„æ”¹é€ ï¼›</li>
<li>å¦‚æœä½ ä¸æƒ³ä¸­æ–­æœåŠ¡ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ <strong>alias + reindex</strong> åšå¹³æ»‘åˆ‡æ¢ï¼›</li>
<li>ä¸å»ºè®®ç”¨ shrink + split æ‹¼æ¥æ–¹æ¡ˆï¼Œå®é™…è¿ç»´æ€§å·®ã€æ•°å­¦å…³ç³»è‹›åˆ»ã€‚E</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.642Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦7180ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../%E6%9C%AC%E5%9C%B0-rag-%E5%AE%9E%E6%88%98%EF%BC%9A%E7%94%A8-easysearch-ollama-sdk-%E5%8D%8A%E5%B0%8F%E6%97%B6%E6%90%AD%E5%BB%BA%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/">æœ¬åœ° RAG å®æˆ˜ï¼šç”¨ Easysearch + Ollama SDK åŠå°æ—¶æ­å»ºæ£€ç´¢å¢å¼ºé—®ç­”ç³»ç»Ÿ</a></p><div class="content"><blockquote>
<p>âœ… ç›®æ ‡ï¼šåªç”¨ä¸¤å°æœåŠ¡å™¨ï¼ˆæˆ–åŒä¸€å°ï¼‰å°±è·‘é€š <strong>â€œå‘é‡æ£€ç´¢ + æœ¬åœ°å¤§æ¨¡å‹â€</strong> åŸå‹<br>âœ… ç‰¹ç‚¹ï¼š<strong>å®Œå…¨ç¦»çº¿</strong>ã€ä¾èµ–æå°‘ã€éƒ¨ç½²è„šæœ¬å³æ–‡æ¡£<br>âœ… é€‚åˆï¼šå¿«é€Ÿ PoCã€å†…ç½‘åˆè§„åœºæ™¯ã€æƒ³æ·±æŒ– RAG å·¥ä½œæœºç†çš„å¼€å‘è€…</p>
</blockquote>
<h2 id="0-èƒŒæ™¯ä¸åŠ¨æœº"><a href="#0-èƒŒæ™¯ä¸åŠ¨æœº" class="headerlink" title="0. èƒŒæ™¯ä¸åŠ¨æœº"></a>0. èƒŒæ™¯ä¸åŠ¨æœº</h2><p>ç”Ÿæˆå¼ AI èŠå¤©å›ºç„¶å¼ºå¤§ï¼Œä½†å½“é—®é¢˜ä¾èµ–æœ¬åœ°ç§æœ‰çŸ¥è¯†æ—¶ï¼Œå•é  LLM å‚æ•°å†…çš„â€œä¸–ç•Œè®°å¿†â€å¾€å¾€ç­”éæ‰€é—®ã€‚<strong>RAGï¼ˆRetrieval-Augmented Generationï¼‰</strong> çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li><strong>æŠŠæ–‡æ¡£åˆ‡ç‰‡ â†’ å‘é‡åŒ– â†’ å…¥åº“</strong></li>
<li><strong>ç”¨æˆ·æé—® â†’ åŒæ ·å‘é‡åŒ– â†’ æ£€ç´¢</strong></li>
<li>å°†å¬å›ç‰‡æ®µæ‹¼è¿› promptï¼Œè®©å¤§æ¨¡å‹â€œå¸¦ç€ææ–™â€å†å›ç­”</li>
</ol>
<p>å¤šæ•°æ•™ç¨‹ç›´æ¥ç”¨äº‘ç«¯ Embedding+OpenAI GPT-4oï¼Œä½†<strong>ä¸€äº›å›¢é˜Ÿå› éšç§ã€æˆæœ¬æˆ–ç¦»çº¿ç¯å¢ƒ</strong>æ— æ³•è¿™æ ·åšã€‚<br>æœ¬æ–‡é€‰ç”¨ï¼š</p>
<ul>
<li><strong>EasySearch (&#x3D; OpenSearch + Elastiknn)</strong> åšå‘é‡å­˜å–</li>
<li><strong>Ollama SDK</strong> è¿æ¥æœ¬åœ° LLM</li>
<li><strong>Python + requests + ollama</strong> ä¸‰ä¸ªä¾èµ–å³å¯</li>
</ul>
<h2 id="1-ç³»ç»Ÿæ¶æ„"><a href="#1-ç³»ç»Ÿæ¶æ„" class="headerlink" title="1. ç³»ç»Ÿæ¶æ„"></a>1. ç³»ç»Ÿæ¶æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·é—®é¢˜ â”€â”€â–¶ åµŒå…¥æ¨¡å‹ (Ollama) â”€â”€â–¶ EasySearch å‘é‡æ£€ç´¢ â”€â”€â–¶ Top-k ç‰‡æ®µ</span><br><span class="line">                    â–²                                             â”‚</span><br><span class="line">                    â”‚                                             â”‚</span><br><span class="line">       LLM (Ollama Chat) â—€â”€â”€ æ‹¼ Prompt + ç”Ÿæˆç­”æ¡ˆ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>åµŒå…¥æ¨¡å‹</strong>ï¼š<code>nomic-embed-text</code>ï¼ˆ768 ç»´ï¼Œå¤šè¯­è¨€é€šç”¨ï¼‰</li>
<li><strong>æ£€ç´¢å¼•æ“</strong>ï¼šEasySearch 2.x + Elastiknn <code>knn_dense_float_vector</code></li>
<li><strong>å¯¹è¯æ¨¡å‹</strong>ï¼š<code>deepseek-r1:7b</code>ï¼ˆè½»é‡ï¼Œå¥½éƒ¨ç½²ï¼›å¯æ¢ <code>llama3</code> &#x2F; <code>qwen</code>ï¼‰</li>
</ul>
<h2 id="2-ç¯å¢ƒä¸ä¾èµ–"><a href="#2-ç¯å¢ƒä¸ä¾èµ–" class="headerlink" title="2. ç¯å¢ƒä¸ä¾èµ–"></a>2. ç¯å¢ƒä¸ä¾èµ–</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, json, requests, warnings</span><br><span class="line"><span class="keyword">from</span> ollama <span class="keyword">import</span> Client</span><br><span class="line"><span class="keyword">from</span> requests.packages.urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=InsecureRequestWarning)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python ä¾èµ–</span></span><br><span class="line">pip install ollama requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–æ¨¡å‹</span></span><br><span class="line">ollama pull nomic-embed-text</span><br><span class="line">ollama pull deepseek-r1:7b</span><br></pre></td></tr></table></figure>

<h2 id="3-ä»£ç é€æ®µæ‹†è§£"><a href="#3-ä»£ç é€æ®µæ‹†è§£" class="headerlink" title="3. ä»£ç é€æ®µæ‹†è§£"></a>3. ä»£ç é€æ®µæ‹†è§£</h2><h3 id="3-1-å…¨å±€é…ç½®"><a href="#3-1-å…¨å±€é…ç½®" class="headerlink" title="3.1 å…¨å±€é…ç½®"></a>3.1 å…¨å±€é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é…ç½®åŒº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line">ES_URL   = os.getenv(<span class="string">&quot;ES_URL&quot;</span>, <span class="string">&quot;https://localhost:9200&quot;</span>)</span><br><span class="line">ES_AUTH  = (<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;c59a759f31e901e8d279&quot;</span>)   <span class="comment"># æ— è®¤è¯è®¾ä¸º None</span></span><br><span class="line">INDEX    = <span class="string">&quot;rag_demo&quot;</span></span><br><span class="line"></span><br><span class="line">OLLAMA_HOST  = os.getenv(<span class="string">&quot;OLLAMA_URL&quot;</span>, <span class="string">&quot;http://localhost:11434&quot;</span>)</span><br><span class="line">EMBED_MODEL  = <span class="string">&quot;nomic-embed-text&quot;</span>         <span class="comment"># å‘é‡æ¨¡å‹</span></span><br><span class="line">CHAT_MODEL   = <span class="string">&quot;deepseek-r1:7b&quot;</span>           <span class="comment"># å¯¹è¯æ¨¡å‹</span></span><br><span class="line">TOP_K        = <span class="number">4</span></span><br><span class="line">NUM_CAND     = <span class="number">200</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç åªæ˜¯<strong>ç»™è„šæœ¬æå‰è®¾å®šä¸€äº›â€œè¿æ¥å‚æ•°â€ä¸â€œæ¨¡å‹é€‰æ‹©â€</strong>ï¼Œæ–¹ä¾¿åé¢ç»Ÿä¸€å¼•ç”¨ã€‚é€è¡Œè§£é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES_URL   = <span class="string">&quot;https://&lt;es_host&gt;:9200&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ES_URL</strong>ï¼šEasySearch &#x2F; OpenSearch é›†ç¾¤çš„å®Œæ•´åœ°å€ï¼ˆå«åè®®ä¸ç«¯å£ï¼‰ã€‚</p>
<ul>
<li><code>&lt;es_host&gt;</code> æ˜¯å ä½ç¬¦ï¼Œå®é™…éƒ¨ç½²æ—¶è¦æ›¿æ¢æˆä½ çš„ IP æˆ–åŸŸåã€‚</li>
<li>å¦‚æœä½ çš„é›†ç¾¤æ²¡å¼€ TLSï¼Œå¯å†™æˆ <code>http://10.0.0.8:9200</code>ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES_AUTH  = (<span class="string">&quot;elastic&quot;</span>, <span class="string">&quot;password&quot;</span>)   <span class="comment"># æ— è®¤è¯è®¾ä¸º None</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>ES_AUTH</strong>ï¼šè¿æ¥é›†ç¾¤çš„è´¦å·å¯†ç å…ƒç»„ã€‚</p>
<ul>
<li>è„šæœ¬é‡Œä¼ ç»™ <code>requests</code> çš„ <code>auth=</code> å‚æ•°ï¼Œä¼šè‡ªåŠ¨åŠ  Basic Auth å¤´ã€‚</li>
<li>è‹¥é›†ç¾¤å…³é—­äº†å®‰å…¨è®¤è¯æˆ–èµ°å†…ç½‘åŒ¿åè®¿é—®ï¼Œå°±æŠŠå®ƒè®¾æˆ <code>None</code>ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INDEX    = <span class="string">&quot;rag_demo&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>INDEX</strong>ï¼šå‘é‡ç´¢å¼•ï¼ˆæˆ–æ–‡æ¡£ç´¢å¼•ï¼‰çš„åç§°ã€‚</p>
<ul>
<li>è„šæœ¬åé¢ä¼šå¯¹è¯¥ç´¢å¼•åš <em>create &#x2F; bulk write &#x2F; search</em> ç­‰æ“ä½œã€‚</li>
<li>æ¢æˆåˆ«çš„åå­—æ—¶è®°å¾—ä¿æŒä¸€è‡´ï¼Œä¾‹å¦‚ <code>&quot;knowledge_base&quot;</code>ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OLLAMA_HOST = <span class="string">&quot;http://&lt;ollama_host&gt;:11434&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>OLLAMA_HOST</strong>ï¼šæœ¬åœ° Ollama æœåŠ¡çš„ HTTP èµ·å§‹åœ°å€ã€‚</p>
<ul>
<li><code>&lt;ollama_host&gt;</code> ä¹Ÿæ˜¯å ä½ç¬¦ï¼›è‹¥è„šæœ¬ä¸ Ollama åœ¨åŒä¸€å°æœºå™¨ï¼Œå¯å†™ <code>http://localhost:11434</code>ã€‚</li>
<li>ç«¯å£ <code>11434</code> æ˜¯ Ollama é»˜è®¤ REST ç«¯å£ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EMBED_MODEL = <span class="string">&quot;nomic-embed-text&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>EMBED_MODEL</strong>ï¼šç”¨äºç”Ÿæˆæ–‡æœ¬å‘é‡ï¼ˆembeddingsï¼‰çš„æ¨¡å‹åã€‚</p>
<ul>
<li>åœ¨è„šæœ¬é‡Œä¼šè°ƒç”¨ <code>client.embeddings(model=EMBED_MODEL, â€¦)</code>ã€‚</li>
<li>æ›¿æ¢è§„åˆ™ï¼šå…ˆæ‰§è¡Œ <code>ollama pull &lt;æ¨¡å‹å&gt;</code>ï¼Œç¡®ä¿æœ¬åœ°å·²ä¸‹è½½ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHAT_MODEL  = <span class="string">&quot;deepseek-r1:7b&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>CHAT_MODEL</strong>ï¼šè´Ÿè´£æœ€ç»ˆå›ç­”çš„èŠå¤© &#x2F; ç”Ÿæˆå¼æ¨¡å‹ã€‚</p>
<ul>
<li>è„šæœ¬ä¼šç”¨ <code>client.chat(model=CHAT_MODEL, â€¦)</code> è¿›è¡Œå¯¹è¯ã€‚</li>
<li>åŒç†ï¼Œè‹¥æƒ³ç”¨ <code>llama3:8b-chat</code>ã€<code>qwen:7b-chat</code> ç­‰ï¼Œå…ˆ <code>ollama pull</code> å†æ”¹è¿™é‡Œã€‚</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-2-åµŒå…¥ä¸å¯¹è¯ï¼ˆOllama-SDKï¼‰"><a href="#3-2-åµŒå…¥ä¸å¯¹è¯ï¼ˆOllama-SDKï¼‰" class="headerlink" title="3.2 åµŒå…¥ä¸å¯¹è¯ï¼ˆOllama SDKï¼‰"></a>3.2 åµŒå…¥ä¸å¯¹è¯ï¼ˆOllama SDKï¼‰</h3><p>client æ˜¯è¿æ¥ Ollama æ¨¡å‹æœåŠ¡çš„å®¢æˆ·ç«¯ï¼Œç”¨æ¥å‘è¯·æ±‚ã€‚</p>
<p>session æ˜¯è®¿é—® Elasticsearch ç”¨çš„è¯·æ±‚ä¼šè¯ï¼Œèƒ½æé«˜ç½‘ç»œæ•ˆç‡ã€‚</p>
<p>ç”¨æŒ‡å®šçš„åµŒå…¥æ¨¡å‹ï¼ˆæ¯”å¦‚ nomic-embed-textï¼‰æŠŠæ–‡æœ¬è½¬æˆå‘é‡ï¼Œç”¨äºç›¸ä¼¼åº¦æœç´¢ã€‚</p>
<p>ç”¨æŒ‡å®šçš„èŠå¤©æ¨¡å‹ï¼ˆæ¯”å¦‚ deepseek-r1:7bï¼‰å›ç­”é—®é¢˜ï¼Œè¿”å›å›å¤æ–‡æœ¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆå§‹åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line">client = Client(host=OLLAMA_HOST)</span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ollama å°è£… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">embed</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›æ–‡æœ¬å‘é‡ (list[float])&quot;&quot;&quot;</span></span><br><span class="line">    resp = client.embeddings(model=EMBED_MODEL, prompt=text)</span><br><span class="line">    <span class="keyword">return</span> resp[<span class="string">&quot;embedding&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">prompt: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸èŠå¤©æ¨¡å‹å¯¹è¯ï¼ˆå®Œæ•´å›å¤ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    resp = client.chat(</span><br><span class="line">        model=CHAT_MODEL,</span><br><span class="line">        messages=[&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;],</span><br><span class="line">        <span class="comment"># stream=False</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> resp[<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="3-3-å»ºç´¢å¼•ï¼ˆElastiknnï¼‰"><a href="#3-3-å»ºç´¢å¼•ï¼ˆElastiknnï¼‰" class="headerlink" title="3.3 å»ºç´¢å¼•ï¼ˆElastiknnï¼‰"></a>3.3 å»ºç´¢å¼•ï¼ˆElastiknnï¼‰</h3><p>åœ¨æ„å»ºåŸºäºå‘é‡çš„ RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨å‘é‡æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæ”¯æŒå‘é‡æ£€ç´¢çš„ç´¢å¼•ã€‚æœ¬æ–‡ä½¿ç”¨ EasySearch ä½œä¸ºåº•å±‚å­˜å‚¨ï¼Œå‘å…¶ä¸­æ³¨å†Œä¸€ä¸ªæ”¯æŒè¿‘ä¼¼å‘é‡æœç´¢çš„ç´¢å¼•ç»“æ„ã€‚</p>
<p>create_index å‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡ RESTful API åˆ›å»ºä¸€ä¸ªåä¸º rag_demo çš„ç´¢å¼•ï¼Œå¹¶å®šä¹‰å­—æ®µç»“æ„å¦‚ä¸‹ï¼š</p>
<p>contentï¼šæ–‡æœ¬å†…å®¹å­—æ®µï¼Œç±»å‹ä¸º textï¼Œå¯ç”¨äºå…¨æ–‡æœç´¢æˆ–ä½œä¸ºä¸Šä¸‹æ–‡è¿”å›ã€‚</p>
<p>vecï¼šå‘é‡å­—æ®µï¼Œç±»å‹ä¸º knn_dense_float_vectorï¼Œæ”¯æŒé«˜ç»´å‘é‡çš„å¿«é€Ÿç›¸ä¼¼åº¦æœç´¢ã€‚<br>é…ç½®ä¸­ä½¿ç”¨äº† LSHï¼ˆå±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼‰æ¨¡å‹ä¸ cosine ç›¸ä¼¼åº¦åº¦é‡ï¼ŒåŒæ—¶è®¾å®šäº†è¿‘ä¼¼å‚æ•° L ä¸ kï¼Œåˆ†åˆ«æ§åˆ¶å€™é€‰æ ·æœ¬æ•°é‡å’Œè¿”å›ç»“æœæ•°ã€‚</p>
<p>é€šè¿‡è®¾å®š â€œindex.knnâ€: Trueï¼Œè¯¥ç´¢å¼•æ”¯æŒä½¿ç”¨ k-NN æŸ¥è¯¢æ¥é«˜æ•ˆåœ°æ£€ç´¢ä¸æŸ¥è¯¢å‘é‡æœ€ç›¸ä¼¼çš„æ–‡æ¡£ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒåµŒå…¥æ¨¡å‹å¦‚ nomic-embed-text å¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºé«˜ç»´å‘é‡ï¼Œå­˜å…¥æ­¤ç´¢å¼•ä¸­ï¼Œä¸ç”¨æˆ·æŸ¥è¯¢è¯­ä¹‰å¯¹é½ï¼Œå®ç°é«˜æ•ˆçš„è¯­ä¹‰æ£€ç´¢èƒ½åŠ›ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------- â‘  åˆ›å»ºç´¢å¼•ï¼šElastiknn æ˜ å°„ ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_index</span>(<span class="params">dim: <span class="built_in">int</span></span>):</span><br><span class="line">    mapping = &#123;</span><br><span class="line">        <span class="string">&quot;settings&quot;</span>: &#123; <span class="string">&quot;index.knn&quot;</span>: <span class="literal">True</span> &#125;,</span><br><span class="line">        <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;,</span><br><span class="line">                <span class="string">&quot;vec&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;knn_dense_float_vector&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;knn&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;dims&quot;</span>: dim,</span><br><span class="line">                        <span class="string">&quot;model&quot;</span>: <span class="string">&quot;lsh&quot;</span>,        <span class="comment"># ä¹Ÿå¯ hnsw / exact</span></span><br><span class="line">                        <span class="string">&quot;similarity&quot;</span>: <span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;L&quot;</span>: <span class="number">99</span>,</span><br><span class="line">                        <span class="string">&quot;k&quot;</span>: <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    r = session.put(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/<span class="subst">&#123;INDEX&#125;</span>&quot;</span>,</span><br><span class="line">                    json=mapping, verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    <span class="keyword">if</span> r.status_code <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">200</span>, <span class="number">201</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;resource_already_exists_exception&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Create index error:\n&quot;</span>, r.text)</span><br><span class="line">            r.raise_for_status()</span><br></pre></td></tr></table></figure>

<h3 id="3-4-å†™å…¥æ–‡æ¡£"><a href="#3-4-å†™å…¥æ–‡æ¡£" class="headerlink" title="3.4 å†™å…¥æ–‡æ¡£"></a>3.4 å†™å…¥æ–‡æ¡£</h3><p>ä»¥ä¸‹æ˜¯å¯¹è¿™æ®µ <code>bulk_upload</code> å‡½æ•°çš„ç®€æ˜è§£é‡Šï¼Œå¯ç”¨äºåšå®¢æ­£æ–‡æˆ–æŠ€æœ¯æ–‡æ¡£ï¼š</p>
<p>åœ¨ RAG ç³»ç»Ÿä¸­ï¼Œä¸ºäº†æ”¯æŒé«˜æ•ˆçš„è¯­ä¹‰æ£€ç´¢ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸå§‹æ–‡æœ¬ä¸å…¶å¯¹åº”çš„å‘é‡ä¸€èµ·å†™å…¥å‘é‡ç´¢å¼•ä¸­ã€‚<code>bulk_upload</code> å‡½æ•°æ­£æ˜¯å®Œæˆè¿™ä¸€ä»»åŠ¡çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä½¿ç”¨ Elasticsearch çš„ <code>_bulk</code> æ¥å£å®ç°æ‰¹é‡å†™å…¥ï¼Œæ˜¾è‘—æé«˜å†™å…¥æ•ˆç‡ã€‚</p>
<ul>
<li><p>æ¯æ¡è®°å½•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><p><code>index</code> å…ƒæ•°æ®ï¼ŒæŒ‡å®šç›®æ ‡ç´¢å¼•ï¼ˆ<code>rag_demo</code>ï¼‰åŠæ–‡æ¡£ <code>_id</code>ã€‚</p>
</li>
<li><p>å®é™…æ–‡æ¡£å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>content</code>ï¼šåŸå§‹æ–‡æœ¬å†…å®¹ï¼›</li>
<li><code>vec</code>ï¼šå¯¹åº”çš„æ–‡æœ¬å‘é‡ï¼Œ<strong>å¿…é¡»ä½¿ç”¨ <code>&#123;&quot;values&quot;: [...]&#125;</code> çš„å¯¹è±¡ç»“æ„</strong>ã€‚</li>
</ul>
</li>
</ol>
</li>
<li><p>å‘é‡é€šè¿‡ <code>embed(t)</code> è·å¾—ï¼Œè°ƒç”¨æœ¬åœ°éƒ¨ç½²çš„ Ollama æ¨¡å‹ï¼ˆå¦‚ <code>nomic-embed-text</code>ï¼‰ç”Ÿæˆã€‚</p>
</li>
<li><p>æ‰€æœ‰æ•°æ®æœ€ç»ˆç¼–ç ä¸º JSONï¼Œé€šè¿‡ <code>Content-Type: application/x-ndjson</code> æäº¤åˆ° <code>/_bulk</code> API æ¥å£ï¼Œå®ç°ä¸€æ¬¡æ€§æ‰¹é‡å†™å…¥ã€‚</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------- â‘¡ æ‰¹é‡å†™å…¥ï¼šå‘é‡å¿…é¡»åŒ… &#123;&quot;values&quot;: â€¦&#125; ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bulk_upload</span>(<span class="params">texts: <span class="built_in">list</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">    bulk = []</span><br><span class="line">    <span class="keyword">for</span> i, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(texts):</span><br><span class="line">        bulk.append(&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: INDEX, <span class="string">&quot;_id&quot;</span>: i &#125; &#125;)</span><br><span class="line">        bulk.append(&#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: t,</span><br><span class="line">            <span class="string">&quot;vec&quot;</span>: &#123; <span class="string">&quot;values&quot;</span>: embed(t) &#125;     <span class="comment"># â˜… å…³é”®ï¼šå¯¹è±¡æ ¼å¼</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ndjson = <span class="string">&quot;\n&quot;</span>.join(json.dumps(d, ensure_ascii=<span class="literal">False</span>) <span class="keyword">for</span> d <span class="keyword">in</span> bulk) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    r = session.post(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/_bulk&quot;</span>,</span><br><span class="line">                     data=ndjson.encode(<span class="string">&quot;utf-8&quot;</span>),</span><br><span class="line">                     headers=&#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-ndjson&quot;</span>&#125;,</span><br><span class="line">                     verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    r.raise_for_status()</span><br></pre></td></tr></table></figure>

<h3 id="3-5-è¯­ä¹‰æ£€ç´¢"><a href="#3-5-è¯­ä¹‰æ£€ç´¢" class="headerlink" title="3.5 è¯­ä¹‰æ£€ç´¢"></a>3.5 è¯­ä¹‰æ£€ç´¢</h3><p>è¿™æ®µ <code>search</code> å‡½æ•°çš„ä½œç”¨æ˜¯åœ¨ RAG ç³»ç»Ÿä¸­æ‰§è¡ŒåŸºäºå‘é‡çš„è¯­ä¹‰æ£€ç´¢ï¼Œä»¥ä¸‹æ˜¯é€‚åˆç”¨äºåšå®¢ä¸­çš„ç®€æ˜è§£é‡Šï¼š</p>
<p>RAG ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯ä»å‘é‡ç´¢å¼•ä¸­æ‰¾åˆ°ä¸ç”¨æˆ·é—®é¢˜æœ€ç›¸è¿‘çš„è¯­ä¹‰ç‰‡æ®µã€‚<code>search</code> å‡½æ•°å³å®Œæˆäº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå®ƒè°ƒç”¨ EasySearch çš„å‘é‡æ£€ç´¢æ¥å£ï¼Œè¿”å›æœ€ç›¸ä¼¼çš„æ–‡æœ¬å†…å®¹ã€‚</p>
<ol>
<li><p><strong>æ–‡æœ¬å‘é‡åŒ–</strong>ï¼šé€šè¿‡ <code>embed(question)</code> æŠŠç”¨æˆ·è¾“å…¥çš„é—®é¢˜è½¬æ¢æˆå‘é‡ <code>qvec</code>ã€‚</p>
</li>
<li><p><strong>æ„é€ æ£€ç´¢è¯·æ±‚</strong>ï¼š<br>ä½¿ç”¨ <code>knn_nearest_neighbors</code> æŸ¥è¯¢</p>
<ul>
<li><code>field</code>: å‘é‡å­—æ®µåï¼ˆæœ¬ä¾‹ä¸­æ˜¯ <code>&quot;vec&quot;</code>ï¼‰ï¼›</li>
<li><code>vec</code>: æŸ¥è¯¢å‘é‡ï¼Œå¿…é¡»å†™æˆ <code>&#123; &quot;values&quot;: [...] &#125;</code> çš„å¯¹è±¡ç»“æ„ï¼›</li>
<li><code>model</code>: å‘é‡è¿‘ä¼¼æ£€ç´¢æ¨¡å‹ï¼ˆå¦‚ <code>&quot;lsh&quot;</code>ï¼‰ï¼›</li>
<li><code>similarity</code>: ç›¸ä¼¼åº¦åº¦é‡æ–¹å¼ï¼ˆå¦‚ <code>&quot;cosine&quot;</code>ï¼‰ï¼›</li>
<li><code>k</code>: è¿”å›çš„ç»“æœæ•°ï¼›</li>
<li><code>candidates</code>: å€™é€‰æ± å¤§å°ï¼Œç”¨äºç²—æ’ä¼˜åŒ–æ£€ç´¢æ•ˆæœã€‚</li>
</ul>
</li>
<li><p><strong>å‘é€è¯·æ±‚å¹¶è§£æå“åº”</strong>ï¼š<br>è¯·æ±‚é€šè¿‡ Elasticsearch <code>_search</code> æ¥å£æäº¤ï¼Œè‹¥è¿”å›ä¸æˆåŠŸï¼Œåˆ™è¾“å‡ºæŠ¥é”™ä¿¡æ¯ï¼›æˆåŠŸåæå– <code>_source[&quot;content&quot;]</code> å­—æ®µï¼Œè¿”å›ç»™ä¸Šå±‚ç”¨äºå›ç­”ç”Ÿæˆã€‚</p>
</li>
</ol>
<h3 id="âœ…-ç¤ºä¾‹ç”¨é€”ï¼š"><a href="#âœ…-ç¤ºä¾‹ç”¨é€”ï¼š" class="headerlink" title="âœ… ç¤ºä¾‹ç”¨é€”ï¼š"></a>âœ… ç¤ºä¾‹ç”¨é€”ï¼š</h3><p>ç”¨æˆ·æé—®ï¼šâ€œå¼ ä¸‰æ˜¯è°â€ï¼Œç³»ç»Ÿä¼šå°†è¯¥é—®é¢˜å‘é‡åŒ–ï¼Œç„¶ååœ¨å·²æœ‰æ–‡æœ¬å‘é‡ä¸­è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…ï¼Œä»è€Œè¿”å›å¦‚â€œå¼ ä¸‰æ˜¯æ³•å¾‹ä¸“å®¶â€¦â€¦â€çš„ç‰‡æ®µï¼Œä½œä¸ºæ„å»ºå›ç­”çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>è¿™æ®µé€»è¾‘æ˜¯ RAG æ¨¡å‹â€œRetrieverâ€é˜¶æ®µçš„æ ¸å¿ƒï¼Œè®©å¤§æ¨¡å‹åœ¨â€œæœ‰çŸ¥è¯†â€çš„åŸºç¡€ä¸Šä½œç­”ï¼Œæå‡å‡†ç¡®æ€§å’Œå®ç”¨æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">question: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = TOP_K</span>):</span><br><span class="line">    qvec = embed(question)</span><br><span class="line">    body = &#123;</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: top_k,</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;knn_nearest_neighbors&quot;</span>: &#123;        <span class="comment"># è‹¥ Elastiknn 0.7.x ç”¨ elastiknn_nearest_neighbors</span></span><br><span class="line">                <span class="string">&quot;field&quot;</span>: <span class="string">&quot;vec&quot;</span>,</span><br><span class="line">                <span class="string">&quot;vec&quot;</span>: &#123; <span class="string">&quot;values&quot;</span>: qvec &#125;,</span><br><span class="line">                <span class="string">&quot;model&quot;</span>: <span class="string">&quot;lsh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;similarity&quot;</span>: <span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">                <span class="string">&quot;k&quot;</span>: top_k,</span><br><span class="line">                <span class="string">&quot;candidates&quot;</span>: <span class="number">200</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    r = session.post(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/<span class="subst">&#123;INDEX&#125;</span>/_search&quot;</span>,</span><br><span class="line">                     json=body, verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> r.ok:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;== ES response ==&quot;</span>, r.text)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    <span class="keyword">return</span> [hit[<span class="string">&quot;_source&quot;</span>][<span class="string">&quot;content&quot;</span>] <span class="keyword">for</span> hit <span class="keyword">in</span> r.json()[<span class="string">&quot;hits&quot;</span>][<span class="string">&quot;hits&quot;</span>]]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-6-ä¸»å¾ªç¯"><a href="#3-6-ä¸»å¾ªç¯" class="headerlink" title="3.6 ä¸»å¾ªç¯"></a>3.6 ä¸»å¾ªç¯</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLI ä¸»é€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    docs = [</span><br><span class="line">    <span class="comment"># åŸæ¥çš„ 3 æ¡</span></span><br><span class="line">    <span class="string">&quot;å¼ ä¸‰æ˜¯æ³•å¾‹ä¸“å®¶ï¼Œæ“…é•¿åˆåŒæ³•ä¸çŸ¥è¯†äº§æƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æå››åœ¨äººæœºäº¤äº’é¢†åŸŸç ”ç©¶å¤šå¹´ï¼Œå°¤å…¶å…³æ³¨å¯ç”¨æ€§æµ‹è¯•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç‹äº”æ˜¯ä¸€åèµ„æ·±è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¯¹äº‘åŸç”Ÿã€DevOps æœ‰ä¸°å¯Œç»éªŒã€‚&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ–°å¢ 100 æ¡</span></span><br><span class="line">    <span class="string">&quot;èµµå…­æ˜¯ä¸€åæ•°æ®ç§‘å­¦å®¶ï¼Œä¸“æ³¨æœºå™¨å­¦ä¹ æ¨¡å‹è°ƒä¼˜ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å­™ä¸ƒå…·æœ‰åå¹´é‡‘èé£æ§ç»éªŒï¼Œç†Ÿæ‚‰å·´å¡å°”åè®®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å‘¨å…«æ˜¯åŒºå—é“¾å¼€å‘è€…ï¼Œæ“…é•¿æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å´ä¹é•¿æœŸç ”ç©¶è¾¹ç¼˜è®¡ç®—ï¼Œåœ¨ IoT ç½‘å…³æ¶æ„æ–¹é¢æœ‰å®è·µã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éƒ‘åæ˜¯èµ„æ·± DBAï¼Œç²¾é€š MySQL æ€§èƒ½è°ƒä¼˜ä¸é«˜å¯ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é’±åä¸€æ“…é•¿äº‘åŸç”Ÿå®‰å…¨æ²»ç†ï¼Œä¸»å¯¼å¤šå®¶ä¼ä¸šé›¶ä¿¡ä»»è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è’‹åäºŒæ˜¯ GPU è¿ç»´ä¸“å®¶ï¼Œå¯¹ CUDA ä¼˜åŒ–æœ‰æ·±å…¥ç ”ç©¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ²ˆåä¸‰ä¸“æ³¨æ·±åº¦å­¦ä¹ æ¨ç†åŠ é€Ÿï¼Œç»´æŠ¤ TensorRT æ’ä»¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éŸ©åå››æ˜¯ FaaS å¹³å°æ¶æ„å¸ˆï¼Œå…³æ³¨å†·å¯åŠ¨ä¼˜åŒ–ç­–ç•¥ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å§šåäº”ä»äº‹é‡åŒ–äº¤æ˜“ç®—æ³•å¼€å‘ï¼Œå¯¹é«˜é¢‘æ•°æ®å¤„ç†ç†Ÿç»ƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚µåå…­æ˜¯æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆï¼Œæ“…é•¿ Web æ¼æ´æŒ–æ˜ä¸åˆ©ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ±ªåä¸ƒä¸»æ”» AIGC ç‰ˆæƒåˆè§„ï¼Œä¸ºå¤šå®¶åª’ä½“æœºæ„æä¾›æ–¹æ¡ˆã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å­”åå…«ç ”ç©¶è”é‚¦å­¦ä¹ ï¼Œè§£å†³æ•°æ®å­¤å²›éšç§é—®é¢˜ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ›¹åä¹è´Ÿè´£ SRE å›¢é˜Ÿï¼Œç²¾é€šæ··æ²Œå·¥ç¨‹ä¸é”™è¯¯é¢„ç®—ç®¡ç†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¸¥äºŒåæ˜¯ç½‘ç»œå–è¯ä¸“å®¶ï¼Œå‚ä¸å¤šèµ·é‡å¤§æ¡ˆä»¶åˆ†æã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åäºŒä¸€ç ”å‘ AutoML å¹³å°ï¼Œé™ä½æ¨¡å‹è®­ç»ƒé—¨æ§›ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é›·äºŒäºŒåœ¨ 5G è¾¹ç¼˜ç½‘ååŒè®¡ç®—é¢†åŸŸå‘è¡¨å¤šç¯‡è®ºæ–‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å‡ŒäºŒä¸‰æ˜¯ DevRel ç»ç†ï¼Œæ¨åŠ¨å¼€æºç¤¾åŒºå¢é•¿ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å²äºŒå››å¯¹ RAG æ¶æ„æœ‰æ·±å…¥å®è·µï¼Œä¼˜åŒ–æ£€ç´¢å¬å›ç‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é˜®äºŒäº”æ˜¯ WebGPU å…ˆè¡Œè€…ï¼Œè‡´åŠ›æå‡å‰ç«¯æ¸²æŸ“æ€§èƒ½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ­äºŒå…­ä¸»å¯¼å¤šäº‘æˆæœ¬æ²»ç†é¡¹ç›®ï¼ŒèŠ‚çœ 30% é¢„ç®—ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¹”äºŒä¸ƒæ˜¯ä¸€å AIGC Prompt å·¥ç¨‹å¸ˆï¼Œä¸“ç²¾å¤šæ¨¡æ€æŒ‡ä»¤è®¾è®¡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è©¹äºŒå…«æ“…é•¿å¤§è§„æ¨¡ AB æµ‹è¯•æ¡†æ¶è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é¡¾äºŒä¹æ˜¯ Serverless æ¶æ„å¸ƒé“è€…ï¼Œç¼–å†™å¤šæœ¬æŠ€æœ¯ä¹¦ç±ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é¾šä¸‰åå…³æ³¨ DORA æŒ‡æ ‡ï¼Œç”¨æ•°æ®é©±åŠ¨ DevOps æ”¹è¿›ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è®¡ä¸‰ä¸€æ˜¯ API ç½‘å…³ä¸“å®¶ï¼Œå®ç°ç™¾ä¸‡ QPS ä½å»¶è¿Ÿã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è’²ä¸‰äºŒç ”ç©¶å½±åƒåˆ†å‰²æ¨¡å‹ï¼Œç”¨äºåŒ»å­¦è¾…åŠ©è¯Šæ–­ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚±ä¸‰ä¸‰æ˜¯ Zig è¯­è¨€æ—©æœŸè´¡çŒ®è€…ï¼Œæ¨è¡Œå†…å­˜å®‰å…¨ç¼–ç ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åº„ä¸‰å››é•¿æœŸç»´æŠ¤ Kafka é›†ç¾¤ï¼Œæ“…é•¿ Topic è§„åˆ’ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®«ä¸‰äº”æ˜¯ä½ä»£ç å¹³å°æ¶æ„å¸ˆï¼Œå…³æ³¨æ’ä»¶ç”Ÿæ€ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è“ä¸‰å…­ç ”ç©¶ ICEBERG è¡¨æ ¼å¼ï¼Œæå‡æ¹–ä»“æŸ¥è¯¢æ•ˆç‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‚ä¸‰ä¸ƒåœ¨å®‰å…¨ç¼–æ’ SOAR äº§å“è®¾è®¡ä¸Šç»éªŒä¸°å¯Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é™†ä¸‰å…«ä¸»å¯¼ SaaS äº§å“å›½é™…åŒ–ï¼Œæœ¬åœ°åŒ–æµç¨‹æˆç†Ÿã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¸©ä¸‰ä¹è´Ÿè´£æ··åˆäº‘ DR æ–¹æ¡ˆï¼Œå®ç°åˆ†é’Ÿçº§åˆ‡æ¢ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è¢å››åæ˜¯è¯­éŸ³åˆæˆå·¥ç¨‹å¸ˆï¼Œä¼˜åŒ–å¤š speaker é€‚é…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è´¾å››ä¸€æ·±å…¥ç ”ç©¶ DDDï¼Œå¸®åŠ©å›¢é˜Ÿç†æ¸…é¢†åŸŸè¾¹ç•Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¼å››äºŒä»äº‹å®æ—¶é£æ§å¤§æ•°æ®å¹³å°æ¶æ„ï¼Œå¤„ç†äº¿çº§æµé‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¨‹å››ä¸‰æ˜¯ ARM SoC é©±åŠ¨å·¥ç¨‹å¸ˆï¼Œå¯¹ç”µæºç®¡ç†ç†Ÿæ‚‰ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å±ˆå››å››åœ¨ Federated GraphQL ç½‘å…³æ²»ç†æ–¹é¢æœ‰æ¡ˆä¾‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç”³å››äº”å¸¦é˜Ÿå®ç° MLOps è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç½—å››å…­ç ”ç©¶ VDBMSï¼Œæ”¯æŒ PB çº§å‘é‡æ£€ç´¢ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¥å››ä¸ƒæ˜¯ HTAP æ•°æ®åº“å¸ƒé“è€…ï¼Œä¼˜åŒ–æ··åˆè´Ÿè½½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å·¦å››å…«åœ¨ IAM ä¸ RBAC è®¾è®¡é¢†åŸŸæ·±è€•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å†·å››ä¹æ˜¯é“¾è·¯å¯è§‚æµ‹æ€§å·¥ç¨‹å¸ˆï¼Œæ¨å¹¿ OTEL æ ‡å‡†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åŒ…äº”åæŠ•å…¥å¼‚æ„è®¡ç®—è°ƒåº¦æ¡†æ¶ç ”ç©¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ»‘äº”ä¸€ç²¾é€š eBPF åœ¨å®‰å…¨å¯è§‚æµ‹æ€§åœºæ™¯çš„è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æŸ´äº”äºŒç ”ç©¶é‡å­å®‰å…¨ç®—æ³•ï¼Œå¯¹å›½å¯†è¿ç§»æ–¹æ¡ˆç†Ÿæ‚‰ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è°ˆäº”ä¸‰æ˜¯å†…æ ¸å®‰å…¨ç ”ç©¶å‘˜ï¼Œå‘ç°å¤šä¸ª 0-day æ¼æ´ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é„¢äº”å››ä¸»å¯¼ SaaS è®¡è´¹ç³»ç»Ÿé‡æ„ï¼Œæ”¯æŒçµæ´»å¥—é¤ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚¸äº”äº”æ˜¯ç»¿è‰²æ•°æ®ä¸­å¿ƒè§„åˆ’å¸ˆï¼Œæ¨åŠ¨ PUE é™åˆ° 1.2ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å€™äº”å…­åœ¨è‡ªåŠ¨é©¾é©¶ SLAM ç®—æ³•å…·æœ‰ä¸“åˆ©ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¤äº”ä¸ƒå…³æ³¨ CDP æ¶æ„ï¼Œè¿æ¥å¤šæºè¥é”€æ•°æ®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¸äº”å…«æ˜¯ FPGA åŠ é€Ÿå·¥ç¨‹å¸ˆï¼Œå®ç°ä½å»¶è¿Ÿæ¨ç†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é³äº”ä¹ç ”ç©¶ WASM è¾¹ç¼˜è¿è¡Œæ—¶ï¼Œé™ä½å†·å¯åŠ¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æŸ´å…­ååœ¨ DevSecOps æµæ°´çº¿é›†æˆæ–¹é¢ç»éªŒä¸°å¯Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;èŠ±å…­ä¸€ç­–åˆ’å¤§è§„æ¨¡é»‘å®¢é©¬æ‹‰æ¾ï¼Œä¿ƒæˆ 500+ é¡¹ç›®å­µåŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç‰›å…­äºŒæ˜¯è¾¹ç¼˜ AI æ¨ç†æ¡†æ¶ä½œè€…ï¼Œé‡è§†åŠŸè€—ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç„¦å…­ä¸‰ç ”ç©¶è‡ªç›‘ç£å­¦ä¹ åœ¨æ¨èç³»ç»Ÿçš„åº”ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å•†å…­å››æ˜¯ Rust Web å¼€å‘è€…ï¼Œæ¨å¹¿é›¶æ‹·è´ JSON è§£æã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é˜å…­äº”æŠ•å…¥æ•°å­—å­ªç”ŸåŸå¸‚å¹³å°ç ”å‘ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¼“å…­å…­ä¸»æ”» OTA å‡çº§å®‰å…¨ï¼Œè¦†ç›–æ±½è½¦ ECUã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ€€å…­ä¸ƒæ˜¯ MAC æ•°æ®å¹³é¢ä¸“å®¶ï¼Œä¼˜åŒ–è½¬å‘æ€§èƒ½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®“å…­å…«å‚ä¸å¤šåœºç¾å¤‡æ¼”ç»ƒï¼Œå®Œå–„æ¼”ç»ƒè„šæœ¬ä½“ç³»ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éƒå…­ä¹æ˜¯ PKI æ¶æ„å¸ˆï¼Œè®¾è®¡å¤§è§„æ¨¡è¯ä¹¦ç”Ÿå‘½å‘¨æœŸã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åµ‡ä¸ƒåè‡´åŠ›äºå¤šåª’ä½“ç¼–è§£ç æ ‡å‡†åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚ä¸ƒä¸€ç ”ç©¶ EDA è‡ªåŠ¨å¸ƒçº¿ç®—æ³•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‘ä¸ƒäºŒæ‰“é€  AI å·¥å‚æµæ°´çº¿ï¼Œå®ç°æ¨¡å‹å¿«é€Ÿè¿­ä»£ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‚ä¸ƒä¸‰ä¸“æ³¨ DPU åŠ é€Ÿç½‘ç»œè™šæ‹ŸåŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éº»ä¸ƒå››æ˜¯ Supabase ä¸­å›½ç¤¾åŒºç»´æŠ¤è€…ï¼Œæ¨å¹¿ BaaSã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä»‡ä¸ƒäº”å®ç°ä¼ä¸šçº§ KYC æµç¨‹è‡ªåŠ¨åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è–„ä¸ƒå…­ç ”ç©¶å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æï¼Œç”¨äºå®¢æœè´¨æ£€ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è°¯ä¸ƒä¸ƒæ˜¯ SD-WAN äº§å“ç»ç†ï¼Œèšç„¦æµ·å¤–ä¸“çº¿ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å·«ä¸ƒå…«è´Ÿè´£ Kafka to Pulsar è¿ç§»æ–¹æ¡ˆã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‘ä¸ƒä¹åœ¨ DAG å¼•æ“ä¼˜åŒ– CPS æµæ°´çº¿ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚¬å…«åç ”ç©¶ç«¯ä¾§ LLM è’¸é¦å‹ç¼©ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‡§å…«ä¸€æ˜¯ä¸‰ç»´é‡å»ºç®—æ³•å·¥ç¨‹å¸ˆï¼ŒæœåŠ¡æ–‡åšæ•°å­—åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¦¾å…«äºŒä¸“æ”» S3 å…¼å®¹å¯¹è±¡å­˜å‚¨ç½‘å…³ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åŸå…«ä¸‰å‚ä¸å¯ä¿¡æ‰§è¡Œç¯å¢ƒ TEE æ–¹æ¡ˆè½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ·¦å…«å››æ˜¯å·¥ä¸šäº’è”ç½‘å®‰å…¨è§„åˆ’é¡¾é—®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç»ƒå…«äº”å®ç° GPU å¤šç§Ÿæˆ· QoS è°ƒåº¦å™¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¦¹å…«å…­å…³æ³¨è·¨å¢ƒåˆè§„è¦æ±‚ï¼Œç²¾é€š GDPRã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å»‰å…«ä¸ƒæ˜¯ SDN æ§åˆ¶å™¨å¼€æºè´¡çŒ®è€…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;äº“å…«å…«ä¸“æ³¨é«˜å¹¶å‘é•¿è¿æ¥ç½‘å…³ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®—å…«ä¹æ‰“é€ é›¶ä»£ç æœºå™¨å­¦ä¹ å¹³å°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å…¬å†¶ä¹åç ”ç©¶ PIM å­˜å†…è®¡ç®—æ¶æ„ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çº¢ä¹ä¸€æ˜¯ MESH ç½‘ç»œæ€§èƒ½è°ƒä¼˜ä¸“å®¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çœ­ä¹äºŒè‡´åŠ›äº AI åˆæˆéŸ³é¢‘ç‰ˆæƒæ£€æµ‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç±³ä¹ä¸‰æ¨åŠ¨ç¢³æ’æ”¾æ•°æ®å¹³å°å»ºè®¾ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éš—ä¹å››æ˜¯æœºå™¨äººè¿åŠ¨è§„åˆ’ç®—æ³•ä¸“å®¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ‹‰ä¹äº”ç ”ç©¶è¯­ä¹‰åˆ†å‰²åœ¨é¥æ„Ÿå›¾åƒçš„åº”ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è”ºä¹å…­è´Ÿè´£ 0-RTT QUIC åè®®ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‡§ä¹ä¸ƒä¸“æ³¨ BERT åœ¨æ³•å¾‹æ–‡æœ¬çš„ç»†ç²’åº¦å®ä½“æŠ½å–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ˜ä¹å…«æ˜¯ RPG æ¸¸æˆ AI NPC è¡Œä¸ºæ ‘ä½œè€…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è´ä¹ä¹ç ”ç©¶å·®åˆ†éšç§åœ¨å¹¿å‘Šæ•°æ®çš„å®è·µã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ–½ä¸€ç™¾ä¸»å¯¼äº‘åŸç”Ÿ API å®‰å…¨ç›‘æ§å¹³å°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¼ä¸€é›¶ä¸€ä¼˜åŒ– Kafka Connect å¤§è§„æ¨¡åŒæ­¥ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å µä¸€é›¶äºŒç ”ç©¶è½¦è¾† V2X åè®®æ ˆå®ç°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;èä¸€é›¶ä¸‰èšç„¦ A/B å†³ç­–å¹³å°å¯è§†åŒ–ã€‚&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    dim = <span class="built_in">len</span>(embed(<span class="string">&quot;ç»´åº¦æ¢æµ‹&quot;</span>))      <span class="comment"># åŠ¨æ€æ¢æµ‹å‘é‡ç»´åº¦</span></span><br><span class="line">    create_index(dim)</span><br><span class="line">    bulk_upload(docs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[âˆš] åˆå§‹åŒ–å®Œæˆï¼ˆå‘é‡ç»´åº¦ <span class="subst">&#123;dim&#125;</span>ï¼‰ã€‚å¼€å§‹æé—®ï¼ŒCtrl+C é€€å‡ºã€‚\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            q = <span class="built_in">input</span>(<span class="string">&quot;Q: &quot;</span>).strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> q:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            passages = search(q)</span><br><span class="line">            context  = <span class="string">&quot;\n&quot;</span>.join(<span class="string">f&quot;èµ„æ–™<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>ï¼š<span class="subst">&#123;p&#125;</span>&quot;</span> <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(passages))</span><br><span class="line">            prompt   = (<span class="string">f&quot;å·²çŸ¥èµ„æ–™å¦‚ä¸‹ï¼š\n<span class="subst">&#123;context&#125;</span>\n\nè¯·æ ¹æ®ä»¥ä¸Šèµ„æ–™å›ç­”ç”¨æˆ·é—®é¢˜ï¼š<span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nA:&quot;</span>, chat(prompt))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å¼•ç”¨:&quot;</span>, passages, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nBye!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-è¿è¡Œæ•ˆæœ"><a href="#4-è¿è¡Œæ•ˆæœ" class="headerlink" title="4. è¿è¡Œæ•ˆæœ"></a>4. è¿è¡Œæ•ˆæœ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Q: å¼ ä¸‰æ“…é•¿ä»€ä¹ˆ</span><br><span class="line">A: å¼ ä¸‰æ˜¯ä¸€åæ³•å¾‹ä¸“å®¶ï¼Œä¸“é•¿é¢†åŸŸä¸ºåˆåŒæ³•ä¸çŸ¥è¯†äº§æƒã€‚</span><br><span class="line">å¼•ç”¨: [&#x27;å¼ ä¸‰æ˜¯æ³•å¾‹ä¸“å®¶ï¼Œæ“…é•¿åˆåŒæ³•ä¸çŸ¥è¯†äº§æƒã€‚&#x27;]</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/direct/71056e7c44e147e5837cc0048b896be0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, json, requests, warnings</span><br><span class="line"><span class="keyword">from</span> ollama <span class="keyword">import</span> Client</span><br><span class="line"><span class="keyword">from</span> requests.packages.urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>, category=InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é…ç½®åŒº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line">ES_URL   = os.getenv(<span class="string">&quot;ES_URL&quot;</span>, <span class="string">&quot;https://localhost:9200&quot;</span>)</span><br><span class="line">ES_AUTH  = (<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;c59a759f31e901e8d279&quot;</span>)   <span class="comment"># æ— è®¤è¯è®¾ä¸º None</span></span><br><span class="line">INDEX    = <span class="string">&quot;rag_demo&quot;</span></span><br><span class="line"></span><br><span class="line">OLLAMA_HOST  = os.getenv(<span class="string">&quot;OLLAMA_URL&quot;</span>, <span class="string">&quot;http://localhost:11434&quot;</span>)</span><br><span class="line">EMBED_MODEL  = <span class="string">&quot;nomic-embed-text&quot;</span>         <span class="comment"># å‘é‡æ¨¡å‹</span></span><br><span class="line">CHAT_MODEL   = <span class="string">&quot;deepseek-r1:7b&quot;</span>           <span class="comment"># å¯¹è¯æ¨¡å‹</span></span><br><span class="line">TOP_K        = <span class="number">4</span></span><br><span class="line">NUM_CAND     = <span class="number">200</span>                        <span class="comment"># kNN å…ˆç²—å¬å›æ¡æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆå§‹åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line">client = Client(host=OLLAMA_HOST)</span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ollama å°è£… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">embed</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">float</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›æ–‡æœ¬å‘é‡ (list[float])&quot;&quot;&quot;</span></span><br><span class="line">    resp = client.embeddings(model=EMBED_MODEL, prompt=text)</span><br><span class="line">    <span class="keyword">return</span> resp[<span class="string">&quot;embedding&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">prompt: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸èŠå¤©æ¨¡å‹å¯¹è¯ï¼ˆå®Œæ•´å›å¤ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    resp = client.chat(</span><br><span class="line">        model=CHAT_MODEL,</span><br><span class="line">        messages=[&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;],</span><br><span class="line">        <span class="comment"># stream=False</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> resp[<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- â‘  åˆ›å»ºç´¢å¼•ï¼šElastiknn æ˜ å°„ ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_index</span>(<span class="params">dim: <span class="built_in">int</span></span>):</span><br><span class="line">    mapping = &#123;</span><br><span class="line">        <span class="string">&quot;settings&quot;</span>: &#123; <span class="string">&quot;index.knn&quot;</span>: <span class="literal">True</span> &#125;,</span><br><span class="line">        <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;,</span><br><span class="line">                <span class="string">&quot;vec&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;knn_dense_float_vector&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;knn&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;dims&quot;</span>: dim,</span><br><span class="line">                        <span class="string">&quot;model&quot;</span>: <span class="string">&quot;lsh&quot;</span>,        <span class="comment"># ä¹Ÿå¯ hnsw / exact</span></span><br><span class="line">                        <span class="string">&quot;similarity&quot;</span>: <span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;L&quot;</span>: <span class="number">99</span>,</span><br><span class="line">                        <span class="string">&quot;k&quot;</span>: <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    r = session.put(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/<span class="subst">&#123;INDEX&#125;</span>&quot;</span>,</span><br><span class="line">                    json=mapping, verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    <span class="keyword">if</span> r.status_code <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">200</span>, <span class="number">201</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;resource_already_exists_exception&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Create index error:\n&quot;</span>, r.text)</span><br><span class="line">            r.raise_for_status()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- â‘¡ æ‰¹é‡å†™å…¥ï¼šå‘é‡å¿…é¡»åŒ… &#123;&quot;values&quot;: â€¦&#125; ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bulk_upload</span>(<span class="params">texts: <span class="built_in">list</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">    bulk = []</span><br><span class="line">    <span class="keyword">for</span> i, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(texts):</span><br><span class="line">        bulk.append(&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: INDEX, <span class="string">&quot;_id&quot;</span>: i &#125; &#125;)</span><br><span class="line">        bulk.append(&#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: t,</span><br><span class="line">            <span class="string">&quot;vec&quot;</span>: &#123; <span class="string">&quot;values&quot;</span>: embed(t) &#125;     <span class="comment"># â˜… å…³é”®ï¼šå¯¹è±¡æ ¼å¼</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ndjson = <span class="string">&quot;\n&quot;</span>.join(json.dumps(d, ensure_ascii=<span class="literal">False</span>) <span class="keyword">for</span> d <span class="keyword">in</span> bulk) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    r = session.post(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/_bulk&quot;</span>,</span><br><span class="line">                     data=ndjson.encode(<span class="string">&quot;utf-8&quot;</span>),</span><br><span class="line">                     headers=&#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-ndjson&quot;</span>&#125;,</span><br><span class="line">                     verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- â‘¢ æŸ¥è¯¢ï¼šknn_nearest_neighbors ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">question: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = TOP_K</span>):</span><br><span class="line">    qvec = embed(question)</span><br><span class="line">    body = &#123;</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: top_k,</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;knn_nearest_neighbors&quot;</span>: &#123;        <span class="comment"># è‹¥ Elastiknn 0.7.x ç”¨ elastiknn_nearest_neighbors</span></span><br><span class="line">                <span class="string">&quot;field&quot;</span>: <span class="string">&quot;vec&quot;</span>,</span><br><span class="line">                <span class="string">&quot;vec&quot;</span>: &#123; <span class="string">&quot;values&quot;</span>: qvec &#125;,</span><br><span class="line">                <span class="string">&quot;model&quot;</span>: <span class="string">&quot;lsh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;similarity&quot;</span>: <span class="string">&quot;cosine&quot;</span>,</span><br><span class="line">                <span class="string">&quot;k&quot;</span>: top_k,</span><br><span class="line">                <span class="string">&quot;candidates&quot;</span>: <span class="number">200</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    r = session.post(<span class="string">f&quot;<span class="subst">&#123;ES_URL&#125;</span>/<span class="subst">&#123;INDEX&#125;</span>/_search&quot;</span>,</span><br><span class="line">                     json=body, verify=<span class="literal">False</span>, auth=ES_AUTH)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> r.ok:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;== ES response ==&quot;</span>, r.text)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    <span class="keyword">return</span> [hit[<span class="string">&quot;_source&quot;</span>][<span class="string">&quot;content&quot;</span>] <span class="keyword">for</span> hit <span class="keyword">in</span> r.json()[<span class="string">&quot;hits&quot;</span>][<span class="string">&quot;hits&quot;</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLI ä¸»é€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    docs = [</span><br><span class="line">    <span class="comment"># åŸæ¥çš„ 3 æ¡</span></span><br><span class="line">    <span class="string">&quot;å¼ ä¸‰æ˜¯æ³•å¾‹ä¸“å®¶ï¼Œæ“…é•¿åˆåŒæ³•ä¸çŸ¥è¯†äº§æƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æå››åœ¨äººæœºäº¤äº’é¢†åŸŸç ”ç©¶å¤šå¹´ï¼Œå°¤å…¶å…³æ³¨å¯ç”¨æ€§æµ‹è¯•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç‹äº”æ˜¯ä¸€åèµ„æ·±è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œå¯¹äº‘åŸç”Ÿã€DevOps æœ‰ä¸°å¯Œç»éªŒã€‚&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ–°å¢ 100 æ¡</span></span><br><span class="line">    <span class="string">&quot;èµµå…­æ˜¯ä¸€åæ•°æ®ç§‘å­¦å®¶ï¼Œä¸“æ³¨æœºå™¨å­¦ä¹ æ¨¡å‹è°ƒä¼˜ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å­™ä¸ƒå…·æœ‰åå¹´é‡‘èé£æ§ç»éªŒï¼Œç†Ÿæ‚‰å·´å¡å°”åè®®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å‘¨å…«æ˜¯åŒºå—é“¾å¼€å‘è€…ï¼Œæ“…é•¿æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å´ä¹é•¿æœŸç ”ç©¶è¾¹ç¼˜è®¡ç®—ï¼Œåœ¨ IoT ç½‘å…³æ¶æ„æ–¹é¢æœ‰å®è·µã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éƒ‘åæ˜¯èµ„æ·± DBAï¼Œç²¾é€š MySQL æ€§èƒ½è°ƒä¼˜ä¸é«˜å¯ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é’±åä¸€æ“…é•¿äº‘åŸç”Ÿå®‰å…¨æ²»ç†ï¼Œä¸»å¯¼å¤šå®¶ä¼ä¸šé›¶ä¿¡ä»»è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è’‹åäºŒæ˜¯ GPU è¿ç»´ä¸“å®¶ï¼Œå¯¹ CUDA ä¼˜åŒ–æœ‰æ·±å…¥ç ”ç©¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ²ˆåä¸‰ä¸“æ³¨æ·±åº¦å­¦ä¹ æ¨ç†åŠ é€Ÿï¼Œç»´æŠ¤ TensorRT æ’ä»¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éŸ©åå››æ˜¯ FaaS å¹³å°æ¶æ„å¸ˆï¼Œå…³æ³¨å†·å¯åŠ¨ä¼˜åŒ–ç­–ç•¥ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å§šåäº”ä»äº‹é‡åŒ–äº¤æ˜“ç®—æ³•å¼€å‘ï¼Œå¯¹é«˜é¢‘æ•°æ®å¤„ç†ç†Ÿç»ƒã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚µåå…­æ˜¯æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆï¼Œæ“…é•¿ Web æ¼æ´æŒ–æ˜ä¸åˆ©ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ±ªåä¸ƒä¸»æ”» AIGC ç‰ˆæƒåˆè§„ï¼Œä¸ºå¤šå®¶åª’ä½“æœºæ„æä¾›æ–¹æ¡ˆã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å­”åå…«ç ”ç©¶è”é‚¦å­¦ä¹ ï¼Œè§£å†³æ•°æ®å­¤å²›éšç§é—®é¢˜ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ›¹åä¹è´Ÿè´£ SRE å›¢é˜Ÿï¼Œç²¾é€šæ··æ²Œå·¥ç¨‹ä¸é”™è¯¯é¢„ç®—ç®¡ç†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¸¥äºŒåæ˜¯ç½‘ç»œå–è¯ä¸“å®¶ï¼Œå‚ä¸å¤šèµ·é‡å¤§æ¡ˆä»¶åˆ†æã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åäºŒä¸€ç ”å‘ AutoML å¹³å°ï¼Œé™ä½æ¨¡å‹è®­ç»ƒé—¨æ§›ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é›·äºŒäºŒåœ¨ 5G è¾¹ç¼˜ç½‘ååŒè®¡ç®—é¢†åŸŸå‘è¡¨å¤šç¯‡è®ºæ–‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å‡ŒäºŒä¸‰æ˜¯ DevRel ç»ç†ï¼Œæ¨åŠ¨å¼€æºç¤¾åŒºå¢é•¿ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å²äºŒå››å¯¹ RAG æ¶æ„æœ‰æ·±å…¥å®è·µï¼Œä¼˜åŒ–æ£€ç´¢å¬å›ç‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é˜®äºŒäº”æ˜¯ WebGPU å…ˆè¡Œè€…ï¼Œè‡´åŠ›æå‡å‰ç«¯æ¸²æŸ“æ€§èƒ½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ­äºŒå…­ä¸»å¯¼å¤šäº‘æˆæœ¬æ²»ç†é¡¹ç›®ï¼ŒèŠ‚çœ 30% é¢„ç®—ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¹”äºŒä¸ƒæ˜¯ä¸€å AIGC Prompt å·¥ç¨‹å¸ˆï¼Œä¸“ç²¾å¤šæ¨¡æ€æŒ‡ä»¤è®¾è®¡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è©¹äºŒå…«æ“…é•¿å¤§è§„æ¨¡ AB æµ‹è¯•æ¡†æ¶è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é¡¾äºŒä¹æ˜¯ Serverless æ¶æ„å¸ƒé“è€…ï¼Œç¼–å†™å¤šæœ¬æŠ€æœ¯ä¹¦ç±ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é¾šä¸‰åå…³æ³¨ DORA æŒ‡æ ‡ï¼Œç”¨æ•°æ®é©±åŠ¨ DevOps æ”¹è¿›ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è®¡ä¸‰ä¸€æ˜¯ API ç½‘å…³ä¸“å®¶ï¼Œå®ç°ç™¾ä¸‡ QPS ä½å»¶è¿Ÿã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è’²ä¸‰äºŒç ”ç©¶å½±åƒåˆ†å‰²æ¨¡å‹ï¼Œç”¨äºåŒ»å­¦è¾…åŠ©è¯Šæ–­ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚±ä¸‰ä¸‰æ˜¯ Zig è¯­è¨€æ—©æœŸè´¡çŒ®è€…ï¼Œæ¨è¡Œå†…å­˜å®‰å…¨ç¼–ç ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åº„ä¸‰å››é•¿æœŸç»´æŠ¤ Kafka é›†ç¾¤ï¼Œæ“…é•¿ Topic è§„åˆ’ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®«ä¸‰äº”æ˜¯ä½ä»£ç å¹³å°æ¶æ„å¸ˆï¼Œå…³æ³¨æ’ä»¶ç”Ÿæ€ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è“ä¸‰å…­ç ”ç©¶ ICEBERG è¡¨æ ¼å¼ï¼Œæå‡æ¹–ä»“æŸ¥è¯¢æ•ˆç‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‚ä¸‰ä¸ƒåœ¨å®‰å…¨ç¼–æ’ SOAR äº§å“è®¾è®¡ä¸Šç»éªŒä¸°å¯Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é™†ä¸‰å…«ä¸»å¯¼ SaaS äº§å“å›½é™…åŒ–ï¼Œæœ¬åœ°åŒ–æµç¨‹æˆç†Ÿã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¸©ä¸‰ä¹è´Ÿè´£æ··åˆäº‘ DR æ–¹æ¡ˆï¼Œå®ç°åˆ†é’Ÿçº§åˆ‡æ¢ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è¢å››åæ˜¯è¯­éŸ³åˆæˆå·¥ç¨‹å¸ˆï¼Œä¼˜åŒ–å¤š speaker é€‚é…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è´¾å››ä¸€æ·±å…¥ç ”ç©¶ DDDï¼Œå¸®åŠ©å›¢é˜Ÿç†æ¸…é¢†åŸŸè¾¹ç•Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¼å››äºŒä»äº‹å®æ—¶é£æ§å¤§æ•°æ®å¹³å°æ¶æ„ï¼Œå¤„ç†äº¿çº§æµé‡ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¨‹å››ä¸‰æ˜¯ ARM SoC é©±åŠ¨å·¥ç¨‹å¸ˆï¼Œå¯¹ç”µæºç®¡ç†ç†Ÿæ‚‰ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å±ˆå››å››åœ¨ Federated GraphQL ç½‘å…³æ²»ç†æ–¹é¢æœ‰æ¡ˆä¾‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç”³å››äº”å¸¦é˜Ÿå®ç° MLOps è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç½—å››å…­ç ”ç©¶ VDBMSï¼Œæ”¯æŒ PB çº§å‘é‡æ£€ç´¢ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¥å››ä¸ƒæ˜¯ HTAP æ•°æ®åº“å¸ƒé“è€…ï¼Œä¼˜åŒ–æ··åˆè´Ÿè½½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å·¦å››å…«åœ¨ IAM ä¸ RBAC è®¾è®¡é¢†åŸŸæ·±è€•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å†·å››ä¹æ˜¯é“¾è·¯å¯è§‚æµ‹æ€§å·¥ç¨‹å¸ˆï¼Œæ¨å¹¿ OTEL æ ‡å‡†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åŒ…äº”åæŠ•å…¥å¼‚æ„è®¡ç®—è°ƒåº¦æ¡†æ¶ç ”ç©¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ»‘äº”ä¸€ç²¾é€š eBPF åœ¨å®‰å…¨å¯è§‚æµ‹æ€§åœºæ™¯çš„è½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æŸ´äº”äºŒç ”ç©¶é‡å­å®‰å…¨ç®—æ³•ï¼Œå¯¹å›½å¯†è¿ç§»æ–¹æ¡ˆç†Ÿæ‚‰ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è°ˆäº”ä¸‰æ˜¯å†…æ ¸å®‰å…¨ç ”ç©¶å‘˜ï¼Œå‘ç°å¤šä¸ª 0-day æ¼æ´ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é„¢äº”å››ä¸»å¯¼ SaaS è®¡è´¹ç³»ç»Ÿé‡æ„ï¼Œæ”¯æŒçµæ´»å¥—é¤ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚¸äº”äº”æ˜¯ç»¿è‰²æ•°æ®ä¸­å¿ƒè§„åˆ’å¸ˆï¼Œæ¨åŠ¨ PUE é™åˆ° 1.2ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å€™äº”å…­åœ¨è‡ªåŠ¨é©¾é©¶ SLAM ç®—æ³•å…·æœ‰ä¸“åˆ©ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¤äº”ä¸ƒå…³æ³¨ CDP æ¶æ„ï¼Œè¿æ¥å¤šæºè¥é”€æ•°æ®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¸äº”å…«æ˜¯ FPGA åŠ é€Ÿå·¥ç¨‹å¸ˆï¼Œå®ç°ä½å»¶è¿Ÿæ¨ç†ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é³äº”ä¹ç ”ç©¶ WASM è¾¹ç¼˜è¿è¡Œæ—¶ï¼Œé™ä½å†·å¯åŠ¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æŸ´å…­ååœ¨ DevSecOps æµæ°´çº¿é›†æˆæ–¹é¢ç»éªŒä¸°å¯Œã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;èŠ±å…­ä¸€ç­–åˆ’å¤§è§„æ¨¡é»‘å®¢é©¬æ‹‰æ¾ï¼Œä¿ƒæˆ 500+ é¡¹ç›®å­µåŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç‰›å…­äºŒæ˜¯è¾¹ç¼˜ AI æ¨ç†æ¡†æ¶ä½œè€…ï¼Œé‡è§†åŠŸè€—ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç„¦å…­ä¸‰ç ”ç©¶è‡ªç›‘ç£å­¦ä¹ åœ¨æ¨èç³»ç»Ÿçš„åº”ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å•†å…­å››æ˜¯ Rust Web å¼€å‘è€…ï¼Œæ¨å¹¿é›¶æ‹·è´ JSON è§£æã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é˜å…­äº”æŠ•å…¥æ•°å­—å­ªç”ŸåŸå¸‚å¹³å°ç ”å‘ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å¼“å…­å…­ä¸»æ”» OTA å‡çº§å®‰å…¨ï¼Œè¦†ç›–æ±½è½¦ ECUã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ€€å…­ä¸ƒæ˜¯ MAC æ•°æ®å¹³é¢ä¸“å®¶ï¼Œä¼˜åŒ–è½¬å‘æ€§èƒ½ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®“å…­å…«å‚ä¸å¤šåœºç¾å¤‡æ¼”ç»ƒï¼Œå®Œå–„æ¼”ç»ƒè„šæœ¬ä½“ç³»ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éƒå…­ä¹æ˜¯ PKI æ¶æ„å¸ˆï¼Œè®¾è®¡å¤§è§„æ¨¡è¯ä¹¦ç”Ÿå‘½å‘¨æœŸã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åµ‡ä¸ƒåè‡´åŠ›äºå¤šåª’ä½“ç¼–è§£ç æ ‡å‡†åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚ä¸ƒä¸€ç ”ç©¶ EDA è‡ªåŠ¨å¸ƒçº¿ç®—æ³•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‘ä¸ƒäºŒæ‰“é€  AI å·¥å‚æµæ°´çº¿ï¼Œå®ç°æ¨¡å‹å¿«é€Ÿè¿­ä»£ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‚ä¸ƒä¸‰ä¸“æ³¨ DPU åŠ é€Ÿç½‘ç»œè™šæ‹ŸåŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éº»ä¸ƒå››æ˜¯ Supabase ä¸­å›½ç¤¾åŒºç»´æŠ¤è€…ï¼Œæ¨å¹¿ BaaSã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä»‡ä¸ƒäº”å®ç°ä¼ä¸šçº§ KYC æµç¨‹è‡ªåŠ¨åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è–„ä¸ƒå…­ç ”ç©¶å¤šæ¨¡æ€æƒ…æ„Ÿåˆ†æï¼Œç”¨äºå®¢æœè´¨æ£€ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è°¯ä¸ƒä¸ƒæ˜¯ SD-WAN äº§å“ç»ç†ï¼Œèšç„¦æµ·å¤–ä¸“çº¿ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å·«ä¸ƒå…«è´Ÿè´£ Kafka to Pulsar è¿ç§»æ–¹æ¡ˆã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ¡‘ä¸ƒä¹åœ¨ DAG å¼•æ“ä¼˜åŒ– CPS æµæ°´çº¿ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;é‚¬å…«åç ”ç©¶ç«¯ä¾§ LLM è’¸é¦å‹ç¼©ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‡§å…«ä¸€æ˜¯ä¸‰ç»´é‡å»ºç®—æ³•å·¥ç¨‹å¸ˆï¼ŒæœåŠ¡æ–‡åšæ•°å­—åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¦¾å…«äºŒä¸“æ”» S3 å…¼å®¹å¯¹è±¡å­˜å‚¨ç½‘å…³ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;åŸå…«ä¸‰å‚ä¸å¯ä¿¡æ‰§è¡Œç¯å¢ƒ TEE æ–¹æ¡ˆè½åœ°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ·¦å…«å››æ˜¯å·¥ä¸šäº’è”ç½‘å®‰å…¨è§„åˆ’é¡¾é—®ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç»ƒå…«äº”å®ç° GPU å¤šç§Ÿæˆ· QoS è°ƒåº¦å™¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç¦¹å…«å…­å…³æ³¨è·¨å¢ƒåˆè§„è¦æ±‚ï¼Œç²¾é€š GDPRã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å»‰å…«ä¸ƒæ˜¯ SDN æ§åˆ¶å™¨å¼€æºè´¡çŒ®è€…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;äº“å…«å…«ä¸“æ³¨é«˜å¹¶å‘é•¿è¿æ¥ç½‘å…³ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å®—å…«ä¹æ‰“é€ é›¶ä»£ç æœºå™¨å­¦ä¹ å¹³å°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å…¬å†¶ä¹åç ”ç©¶ PIM å­˜å†…è®¡ç®—æ¶æ„ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çº¢ä¹ä¸€æ˜¯ MESH ç½‘ç»œæ€§èƒ½è°ƒä¼˜ä¸“å®¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;çœ­ä¹äºŒè‡´åŠ›äº AI åˆæˆéŸ³é¢‘ç‰ˆæƒæ£€æµ‹ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ç±³ä¹ä¸‰æ¨åŠ¨ç¢³æ’æ”¾æ•°æ®å¹³å°å»ºè®¾ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;éš—ä¹å››æ˜¯æœºå™¨äººè¿åŠ¨è§„åˆ’ç®—æ³•ä¸“å®¶ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ‹‰ä¹äº”ç ”ç©¶è¯­ä¹‰åˆ†å‰²åœ¨é¥æ„Ÿå›¾åƒçš„åº”ç”¨ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è”ºä¹å…­è´Ÿè´£ 0-RTT QUIC åè®®ä¼˜åŒ–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è‡§ä¹ä¸ƒä¸“æ³¨ BERT åœ¨æ³•å¾‹æ–‡æœ¬çš„ç»†ç²’åº¦å®ä½“æŠ½å–ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ˜ä¹å…«æ˜¯ RPG æ¸¸æˆ AI NPC è¡Œä¸ºæ ‘ä½œè€…ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;è´ä¹ä¹ç ”ç©¶å·®åˆ†éšç§åœ¨å¹¿å‘Šæ•°æ®çš„å®è·µã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æ–½ä¸€ç™¾ä¸»å¯¼äº‘åŸç”Ÿ API å®‰å…¨ç›‘æ§å¹³å°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ä¼ä¸€é›¶ä¸€ä¼˜åŒ– Kafka Connect å¤§è§„æ¨¡åŒæ­¥ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å µä¸€é›¶äºŒç ”ç©¶è½¦è¾† V2X åè®®æ ˆå®ç°ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;èä¸€é›¶ä¸‰èšç„¦ A/B å†³ç­–å¹³å°å¯è§†åŒ–ã€‚&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    dim = <span class="built_in">len</span>(embed(<span class="string">&quot;ç»´åº¦æ¢æµ‹&quot;</span>))      <span class="comment"># åŠ¨æ€æ¢æµ‹å‘é‡ç»´åº¦</span></span><br><span class="line">    create_index(dim)</span><br><span class="line">    bulk_upload(docs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[âˆš] åˆå§‹åŒ–å®Œæˆï¼ˆå‘é‡ç»´åº¦ <span class="subst">&#123;dim&#125;</span>ï¼‰ã€‚å¼€å§‹æé—®ï¼ŒCtrl+C é€€å‡ºã€‚\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            q = <span class="built_in">input</span>(<span class="string">&quot;Q: &quot;</span>).strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> q:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            passages = search(q)</span><br><span class="line">            context  = <span class="string">&quot;\n&quot;</span>.join(<span class="string">f&quot;èµ„æ–™<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>ï¼š<span class="subst">&#123;p&#125;</span>&quot;</span> <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(passages))</span><br><span class="line">            prompt   = (<span class="string">f&quot;å·²çŸ¥èµ„æ–™å¦‚ä¸‹ï¼š\n<span class="subst">&#123;context&#125;</span>\n\nè¯·æ ¹æ®ä»¥ä¸Šèµ„æ–™å›ç­”ç”¨æˆ·é—®é¢˜ï¼š<span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nA:&quot;</span>, chat(prompt))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å¼•ç”¨:&quot;</span>, passages, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nBye!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><blockquote>
<p><strong>EasySearch Ã— Ollama</strong> è®©æˆ‘ä»¬åœ¨æœ¬åœ°å°±èƒ½ä½“éªŒåˆ°â€œRAG çš„çˆ½ç‚¹â€ï¼šæ£€ç´¢å¸¦æ¥å®æ—¶ã€å¯ä¿¡çš„ä¸Šä¸‹æ–‡ï¼Œå¤§æ¨¡å‹è´Ÿè´£è‡ªç„¶è¯­è¨€è¡¨è¾¾ï¼ŒäºŒè€…åˆä½“å³æ˜¯ä¸€ä¸ªå¯äº¤ä»˜çš„â€œä¼ä¸šç§æœ‰çŸ¥è¯†åŠ©æ‰‹â€ã€‚å¦‚æœä½ ä¹Ÿæƒ³åœ¨å†…ç½‘å¿«é€ŸéªŒè¯ PoCï¼Œè¿™ä»½è„šæœ¬æ‹·è¿‡å»æ”¹ä¸¤ä¸ªåœ°å€å³å¯å¼€è·‘ã€‚ç¥ç©å¾—å¼€å¿ƒï¼</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.642Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">12 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1869ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../easysearch-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%92%8C%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%EF%BC%9Ainfini-console-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">Easysearch æ•°æ®å¯è§†åŒ–å’Œç®¡ç†å¹³å°ï¼šINFINI Console ä½¿ç”¨ä»‹ç»</a></p><div class="content"><p>éšç€æ•°æ®åˆ†æéœ€æ±‚çš„ä¸æ–­å¢é•¿ï¼Œé«˜æ•ˆæŸ¥è¯¢å’Œåˆ†æå¤§æ•°æ®é›†å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Easysearch ä½œä¸ºä¸€ç§å¼ºå¤§çš„å›½äº§åŒ–æœç´¢å’Œåˆ†æå¼•æ“ï¼ŒåŒæ—¶ä½œä¸º Elasticsearch å›½äº§æ›¿ä»£æ–¹æ¡ˆï¼Œæ”¯æŒåŸç”Ÿ DSL æŸ¥è¯¢è¯­æ³•å’Œ SQL æŸ¥è¯¢ï¼Œç¡®ä¿åŸä¸šåŠ¡ä»£ç æ— éœ€è°ƒæ•´å³å¯æ— ç¼è¿ç§»ã€‚Easysearch å…¼å®¹ ES 7.x ç°æœ‰çš„ SDK å’Œç´¢å¼•å­˜å‚¨æ ¼å¼ï¼Œæ”¯æŒå†·çƒ­æ¶æ„å’Œç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä¸ºç”¨æˆ·æä¾›äº†å…¨é¢çš„æ•°æ®å¤„ç†è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ ES 7.x Python SDK ä¸ Easysearch è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬å®‰è£…ã€è¿æ¥ã€æ•°æ®æ“ä½œå’ŒæŸ¥è¯¢ç­‰æ–¹é¢ã€‚</p>
<h2 id="1-å®‰è£…-Elasticsearch-Python-å®¢æˆ·ç«¯"><a href="#1-å®‰è£…-Elasticsearch-Python-å®¢æˆ·ç«¯" class="headerlink" title="1. å®‰è£… Elasticsearch Python å®¢æˆ·ç«¯"></a>1. å®‰è£… Elasticsearch Python å®¢æˆ·ç«¯</h2><p>è¦ä½¿ç”¨ Elasticsearch Python å®¢æˆ·ç«¯ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡<code>pip</code>è¿›è¡Œå®‰è£…ã€‚æ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch==7.13.1</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨é»˜è®¤ç‰ˆæœ¬å®‰è£…ï¼Œä¼šå®‰è£… 8.x çš„ä¾èµ–ï¼Œå¯èƒ½ä¼šæŠ¥é”™ <code>elasticsearch.UnsupportedProductError: The client noticed that the server is not Elasticsearch and we do not support this unknown product.</code></p>
<p>ç”±äº Elasticsearch 7.10.2 ä»¥åå˜æ›´äº†è®¸å¯æ¨¡å¼ï¼Œå¼•å…¥äº† Server Side Public License (SSPL) å’Œ Elastic Licenseï¼Œå¾ˆå¤šåŸºäº Elasticsearch 7.10.2 åˆ†æ”¯å‡ºæ¥çš„æœç´¢å¼•æ“éœ€è¦ä½¿ç”¨ 7.x ç‰ˆæœ¬çš„ SDK å’Œ agentï¼Œæ¯”å¦‚ Beats å…¨å®¶æ¡¶ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/direct/c6a4f8799be34a8498aa6b11c43b7788.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ˜¯ä¸€ä¸ªè·å–é›†ç¾¤ä¿¡æ¯çš„ demoï¼Œä½¿ç”¨<code>es.cluster.health()</code> è°ƒç”¨ Elasticsearch é›†ç¾¤çš„å¥åº·æ£€æŸ¥ APIï¼Œè¿”å›é›†ç¾¤çš„å¥åº·çŠ¶æ€ã€‚</p>
<p>ç”±äºä½¿ç”¨äº†è‡ªç­¾åè¯ä¹¦ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶åŠ ä¸Š <code>verify_certs=False</code> å‚æ•°ï¼ŒåŒæ—¶ä½¿ç”¨ <code>warnings.filterwarnings(&quot;ignore&quot;)</code> è®¾ç½® Python çš„è­¦å‘Šç³»ç»Ÿï¼Œå¿½ç•¥æ‰€æœ‰å‘å‡ºçš„è­¦å‘Šã€‚è¿™åœ¨ç”Ÿäº§ä»£ç ä¸­é€šå¸¸ä¸æ¨èï¼Œå› ä¸ºå®ƒä¼šéšè—æ½œåœ¨çš„é—®é¢˜ï¼Œä½†åœ¨å¼€å‘æˆ–æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå¦‚æœè­¦å‘Šä¿¡æ¯å¤ªå¤šå¹²æ‰°è°ƒè¯•ï¼Œå¯èƒ½ä¼šæš‚æ—¶ä½¿ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"><span class="keyword">import</span> elasticsearch</span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨æ‰€æœ‰è­¦å‘Š</span></span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(elasticsearch.VERSION)</span><br><span class="line"><span class="comment"># ç¦ç”¨è­¦å‘Š</span></span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://ip:9200/&quot;</span></span><br><span class="line">user_passwd = (<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;passwd&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºç«‹è¿æ¥</span></span><br><span class="line">es = Elasticsearch(</span><br><span class="line">    [url],</span><br><span class="line">    http_auth=user_passwd,</span><br><span class="line">    verify_certs=<span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€</span></span><br><span class="line">health = es.cluster.health()</span><br><span class="line">pprint(health)</span><br></pre></td></tr></table></figure>

<h2 id="2-å‡†å¤‡ç¤ºä¾‹æ•°æ®"><a href="#2-å‡†å¤‡ç¤ºä¾‹æ•°æ®" class="headerlink" title="2. å‡†å¤‡ç¤ºä¾‹æ•°æ®"></a>2. å‡†å¤‡ç¤ºä¾‹æ•°æ®</h2><p>åœ¨è¿›è¡ŒæŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Easysearch ä¸­åˆ›å»ºä¸€äº›ç¤ºä¾‹æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ç¤ºä¾‹æ•°æ®</span></span><br><span class="line">sample_data = [</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">10</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">20</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;value3&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">30</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value1&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value2&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">200</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value3&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">300</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¹é‡æ’å…¥ç¤ºä¾‹æ•°æ®</span></span><br><span class="line">response = es.bulk(body=sample_data)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h2 id="3-ä½¿ç”¨-REST-API-è¿›è¡ŒæŸ¥è¯¢"><a href="#3-ä½¿ç”¨-REST-API-è¿›è¡ŒæŸ¥è¯¢" class="headerlink" title="3. ä½¿ç”¨ REST API è¿›è¡ŒæŸ¥è¯¢"></a>3. ä½¿ç”¨ REST API è¿›è¡ŒæŸ¥è¯¢</h2><p>REST API æ˜¯ä¸ Easysearch è¿›è¡Œé€šä¿¡çš„å¸¸ç”¨æ–¹å¼ã€‚é€šè¿‡ REST APIï¼Œå¼€å‘è€…å¯ä»¥å‘é€ HTTP è¯·æ±‚æ¥æ‰§è¡Œå„ç§æ“ä½œï¼ŒåŒ…æ‹¬ç´¢å¼•æ–‡æ¡£ã€æœç´¢æ•°æ®ç­‰ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Python ä¸­æ‰§è¡Œ REST æŸ¥è¯¢ã€‚</p>
<p>ç”±äºæ˜¯ REST APIï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä½¿ç”¨ Postman è¿›è¡Œæµ‹è¯•ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/direct/1379de6b582147e6862b04574d6fc58b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° HTTP ç«¯ç‚¹å¯ä»¥æ­£å¸¸è¿”å›ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨ç¼–ç¨‹æ–¹å¼è¿›è¡Œè®¿é—®äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://ip:9200/&quot;</span></span><br><span class="line">user_passwd = (<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;passwd&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºæŸ¥è¯¢å‚æ•°</span></span><br><span class="line">query = &#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;value1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dsl = <span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/my_index/_search&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(dsl, json=query, auth=HTTPBasicAuth(*user_passwd), verify=<span class="literal">False</span>)</span><br><span class="line">pprint(response.json())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    results = response.json()</span><br><span class="line">    <span class="keyword">for</span> hit <span class="keyword">in</span> results[<span class="string">&#x27;hits&#x27;</span>][<span class="string">&#x27;hits&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(hit)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-é€šè¿‡-DSL-å¯¹ç´¢å¼•æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥"><a href="#4-é€šè¿‡-DSL-å¯¹ç´¢å¼•æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥" class="headerlink" title="4. é€šè¿‡ DSL å¯¹ç´¢å¼•æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥"></a>4. é€šè¿‡ DSL å¯¹ç´¢å¼•æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥</h2><p>DSLï¼ˆDomain-Specific Languageï¼‰æ˜¯ Easysearch çš„åŸç”ŸæŸ¥è¯¢è¯­è¨€ï¼Œå…è®¸ç”¨æˆ·æ„å»ºå¤æ‚çš„æŸ¥è¯¢ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»º DSL æŸ¥è¯¢</span></span><br><span class="line">dsl_query = &#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;value1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œ DSL æŸ¥è¯¢</span></span><br><span class="line">response = es.search(index=<span class="string">&quot;my_index&quot;</span>, body=dsl_query)</span><br><span class="line"></span><br><span class="line">results = response.get(<span class="string">&quot;hits&quot;</span>)</span><br><span class="line"><span class="comment"># å¤„ç†æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="keyword">if</span> results:</span><br><span class="line">    <span class="keyword">for</span> hit <span class="keyword">in</span> results[<span class="string">&#x27;hits&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(hit)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><p>å¦‚æœä¸æŒ‡å®š document IDï¼Œé‚£ä¹ˆéšæœºç”Ÿæˆä¸€ä¸ª ID å¹¶å†™å…¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">doc = &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;value4&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">9999</span>&#125;</span><br><span class="line">response = es.index(index=<span class="string">&quot;my_index&quot;</span>, body=doc)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h3><p>æŒ‡å®š ID ä¸º 1 æ¥æ‰‹åŠ¨æ›´æ–°ç´¢å¼•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">doc = &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;value4&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">9999</span>&#125;</span><br><span class="line">response = es.index(index=<span class="string">&quot;my_index&quot;</span>, body=doc, <span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°å•æ¡æ•°æ®"><a href="#æ›´æ–°å•æ¡æ•°æ®" class="headerlink" title="æ›´æ–°å•æ¡æ•°æ®"></a>æ›´æ–°å•æ¡æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ›´æ–°å•æ¡æ•°æ®</span></span><br><span class="line">update_body = &#123;<span class="string">&quot;doc&quot;</span>: &#123;<span class="string">&quot;another_field&quot;</span>: <span class="number">50</span>&#125;&#125;</span><br><span class="line">response = es.update(index=<span class="string">&quot;my_index&quot;</span>, <span class="built_in">id</span>=<span class="string">&quot;1&quot;</span>, body=update_body)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å•æ¡æ•°æ®</span></span><br><span class="line">response = es.delete(index=<span class="string">&quot;my_index&quot;</span>, <span class="built_in">id</span>=<span class="string">&quot;1&quot;</span>)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h2 id="5-ç´¢å¼•æ•°æ®-SQL-æŸ¥è¯¢"><a href="#5-ç´¢å¼•æ•°æ®-SQL-æŸ¥è¯¢" class="headerlink" title="5. ç´¢å¼•æ•°æ® SQL æŸ¥è¯¢"></a>5. ç´¢å¼•æ•°æ® SQL æŸ¥è¯¢</h2><p>åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>sql</code> æ–¹æ³•æ‰§è¡Œ SQL æŸ¥è¯¢ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ‰§è¡Œä¸€ä¸ªç®€å•çš„ SELECT æŸ¥è¯¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œ SQL æŸ¥è¯¢</span></span><br><span class="line">query_sql = &#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: <span class="string">&quot;SELECT * FROM my_index&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = es.sql.query(body=query_sql)</span><br><span class="line">pprint(res)</span><br></pre></td></tr></table></figure>

<h2 id="6-ç´¢å¼•æ•°æ®æ‰¹é‡æ“ä½œ"><a href="#6-ç´¢å¼•æ•°æ®æ‰¹é‡æ“ä½œ" class="headerlink" title="6. ç´¢å¼•æ•°æ®æ‰¹é‡æ“ä½œ"></a>6. ç´¢å¼•æ•°æ®æ‰¹é‡æ“ä½œ</h2><p>Bulk API å…è®¸ç”¨æˆ·ä¸€æ¬¡æ€§å¯¹å¤šä¸ªæ–‡æ¡£è¿›è¡Œåˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ“ä½œï¼Œæå¤§æé«˜äº†æ“ä½œæ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p>
<h3 id="æ‰¹é‡æ’å…¥æ•°æ®"><a href="#æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="æ‰¹é‡æ’å…¥æ•°æ®"></a>æ‰¹é‡æ’å…¥æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ‰¹é‡æ’å…¥æ•°æ®</span></span><br><span class="line">bulk_data = [</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value1&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">100</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value2&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">200</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;index&quot;</span>: &#123;<span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;field&quot;</span>: <span class="string">&quot;bulk_value3&quot;</span>, <span class="string">&quot;another_field&quot;</span>: <span class="number">300</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ‰¹é‡æ’å…¥æ“ä½œ</span></span><br><span class="line">response = es.bulk(body=bulk_data)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h3 id="æ‰¹é‡æ›´æ–°æ•°æ®"><a href="#æ‰¹é‡æ›´æ–°æ•°æ®" class="headerlink" title="æ‰¹é‡æ›´æ–°æ•°æ®"></a>æ‰¹é‡æ›´æ–°æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ‰¹é‡æ›´æ–°æ•°æ®</span></span><br><span class="line">bulk_update_data = [</span><br><span class="line">    &#123;<span class="string">&quot;update&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;doc&quot;</span>: &#123;<span class="string">&quot;another_field&quot;</span>: <span class="number">110</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;update&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;doc&quot;</span>: &#123;<span class="string">&quot;another_field&quot;</span>: <span class="number">220</span>&#125;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ‰¹é‡æ›´æ–°æ“ä½œ</span></span><br><span class="line">response = es.bulk(body=bulk_update_data)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h3 id="æ‰¹é‡åˆ é™¤æ•°æ®"><a href="#æ‰¹é‡åˆ é™¤æ•°æ®" class="headerlink" title="æ‰¹é‡åˆ é™¤æ•°æ®"></a>æ‰¹é‡åˆ é™¤æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ‰¹é‡åˆ é™¤æ•°æ®</span></span><br><span class="line">bulk_delete_data = [</span><br><span class="line">    &#123;<span class="string">&quot;delete&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;delete&quot;</span>: &#123;<span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;my_index&quot;</span>&#125;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œæ‰¹é‡åˆ é™¤æ“ä½œ</span></span><br><span class="line">response = es.bulk(body=bulk_delete_data)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h2 id="7-ç´¢å¼•çº§åˆ«çš„æ“ä½œ"><a href="#7-ç´¢å¼•çº§åˆ«çš„æ“ä½œ" class="headerlink" title="7. ç´¢å¼•çº§åˆ«çš„æ“ä½œ"></a>7. ç´¢å¼•çº§åˆ«çš„æ“ä½œ</h2><p>æ¥ä¸‹æ¥ï¼Œä»‹ç»ç´¢å¼•åˆ›å»ºã€åˆ é™¤å’Œæ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p>
<h3 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç´¢å¼•</span></span><br><span class="line">index_body = &#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;number_of_shards&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;number_of_replicas&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;another_field&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">response = es.indices.create(index=<span class="string">&quot;new_index&quot;</span>, body=index_body)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤ç´¢å¼•</span></span><br><span class="line">response = es.indices.delete(index=<span class="string">&quot;new_index&quot;</span>)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨"><a href="#æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨"></a>æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">response = es.indices.exists(index=<span class="string">&quot;new_index&quot;</span>)</span><br><span class="line">pprint(response)</span><br></pre></td></tr></table></figure>

<h2 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a>8. æ€»ç»“</h2><p>Easysearch è™½ç„¶æ²¡æœ‰ä¸“é—¨çš„ Python SDKï¼Œä½†å®Œå…¨å…¼å®¹ ES 7.x çš„ Python SDK å®¢æˆ·ç«¯ï¼Œè¿™ä¸ºå¼€å‘è€…æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚é€šè¿‡ä½¿ç”¨ ES 7.x Python SDKï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ DSL å’Œ SQL è¯­æ³•å¯¹ Easysearch è¿›è¡ŒæŸ¥è¯¢å’Œæ•°æ®æ“ä½œã€‚Easysearch ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
<ol>
<li>å…¼å®¹æ€§å¼ºï¼šæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œå³å¯ä» ES è¿ç§»åˆ° Easysearchã€‚</li>
<li>åŠŸèƒ½å…¨é¢ï¼šæ”¯æŒ DSL æŸ¥è¯¢ã€SQL æŸ¥è¯¢ã€æ‰¹é‡æ“ä½œç­‰é«˜çº§åŠŸèƒ½ã€‚</li>
<li>æ˜“äºä½¿ç”¨ï¼šæä¾›ç®€æ´æ˜äº†çš„ APIï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚</li>
<li>é«˜æ•ˆæ€§èƒ½ï¼šæ‰¹é‡æ“ä½œ API å¤§å¹…æé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚</li>
</ol>
<p>Easysearch ç»“åˆ ES 7.x Python SDK çš„å¼ºå¤§åŠŸèƒ½ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªé«˜æ•ˆã€çµæ´»çš„å¤§æ•°æ®å¤„ç†å¹³å°ã€‚æ— è®ºæ˜¯æ‰§è¡Œç®€å•çš„ SQL æŸ¥è¯¢ï¼Œè¿˜æ˜¯æ„å»ºå¤æ‚çš„ DSL æŸ¥è¯¢ï¼Œéƒ½èƒ½æ»¡è¶³å„ç§æ•°æ®åˆ†æéœ€æ±‚ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªå¼ºå¤§çš„æœç´¢å’Œåˆ†æè§£å†³æ–¹æ¡ˆï¼ŒEasysearch ç»å¯¹å€¼å¾—ä¸€è¯•ã€‚å®ƒä¸ä»…èƒ½å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°å¤„ç†å’Œåˆ†æå¤§æ•°æ®é›†ï¼Œè¿˜èƒ½ä¸ºæ•°æ®é©±åŠ¨çš„å†³ç­–æä¾›æœ‰åŠ›æ”¯æŒã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.642Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">21 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦3198ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../easysearch%E3%80%81elasticsearch%E3%80%81amazon-opensearch-%E5%BF%AB%E7%85%A7%E5%85%BC%E5%AE%B9%E5%AF%B9%E6%AF%94/">Easysearchã€Elasticsearchã€Amazon OpenSearch å¿«ç…§å…¼å®¹å¯¹æ¯”</a></p><div class="content"><p>åœ¨å½“ä»Šçš„æ•°æ®é©±åŠ¨æ—¶ä»£ï¼Œæœç´¢å¼•æ“çš„å¿«ç…§åŠŸèƒ½åœ¨æ•°æ®ä¿æŠ¤å’Œç¾éš¾æ¢å¤ä¸­è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†å¯¹ Easysearchã€Elasticsearch å’Œ Amazon OpenSearch çš„å¿«ç…§å…¼å®¹æ€§è¿›è¡Œæ¯”è¾ƒï¼Œåˆ†æå®ƒä»¬åœ¨å¿«ç…§åˆ›å»ºã€æ¢å¤ã€å­˜å‚¨æ ¼å¼å’Œè·¨å¹³å°å…¼å®¹æ€§ç­‰æ–¹é¢çš„ç‰¹ç‚¹ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£è¿™äº›æœç´¢å¼•æ“çš„å·®å¼‚ï¼Œä»è€Œé€‰æ‹©æœ€é€‚åˆè‡ªå·±éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="å¯åŠ¨é›†ç¾¤"><a href="#å¯åŠ¨é›†ç¾¤" class="headerlink" title="å¯åŠ¨é›†ç¾¤"></a>å¯åŠ¨é›†ç¾¤</h2><h3 id="Easysearch"><a href="#Easysearch" class="headerlink" title="Easysearch"></a>Easysearch</h3><p>æœåŠ¡å™¨ä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤å‚æ•°éƒ½æ˜¯å¾ˆä½çš„ï¼Œè€Œ Easysearch&#x2F;Elasticsearch æ˜¯å†…å­˜å¤§æˆ·ï¼Œæ‰€ä»¥å°±éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒä¼˜ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>

<p><code>vm.max_map_count</code> æ˜¯ä¸€ä¸ª Linux å†…æ ¸å‚æ•°ï¼Œç”¨äºæ§åˆ¶å•ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„æœ€å¤§å†…å­˜æ˜ å°„åŒºåŸŸï¼ˆVMAï¼ŒVirtual Memory Areasï¼‰çš„æ•°é‡ã€‚å†…å­˜æ˜ å°„åŒºåŸŸæ˜¯æŒ‡é€šè¿‡å†…å­˜æ˜ å°„æ–‡ä»¶æˆ–åŒ¿åå†…å­˜æ˜ å°„åˆ›å»ºçš„è™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚</p>
<p>è¿™ä¸ªå‚æ•°åœ¨ä¸€äº›åº”ç”¨ç¨‹åºä¸­éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯é‚£äº›éœ€è¦å¤§é‡å†…å­˜æ˜ å°„çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ Elasticsearchã€‚Elasticsearch ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶æ¥ç´¢å¼•å’Œæœç´¢æ•°æ®ï¼Œè¿™å¯èƒ½éœ€è¦å¤§é‡çš„å†…å­˜æ˜ å°„åŒºåŸŸã€‚å¦‚æœ <code>vm.max_map_count</code> è®¾ç½®å¾—å¤ªä½ï¼ŒElasticsearch å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>è°ƒæ•´ <code>vm.max_map_count</code> å‚æ•°çš„ä¸€äº›å¸¸è§åŸå› ï¼š</p>
<ol>
<li><p><strong>æ”¯æŒå¤§å‹æ•°æ®é›†</strong>ï¼š<br>åº”ç”¨ç¨‹åºï¼ˆå¦‚ Elasticsearchï¼‰åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶å¯èƒ½éœ€è¦å¤§é‡å†…å­˜æ˜ å°„åŒºåŸŸã€‚å¢åŠ  <code>vm.max_map_count</code> å¯ä»¥ç¡®ä¿è¿™äº›åº”ç”¨ç¨‹åºæœ‰è¶³å¤Ÿçš„å†…å­˜æ˜ å°„åŒºåŸŸæ¥å¤„ç†æ•°æ®ã€‚</p>
</li>
<li><p><strong>é˜²æ­¢å†…å­˜é”™è¯¯</strong>ï¼š<br>å¦‚æœ <code>vm.max_map_count</code> è®¾ç½®å¾—å¤ªä½ï¼Œå½“åº”ç”¨ç¨‹åºå°è¯•åˆ›å»ºè¶…è¿‡é™åˆ¶çš„å†…å­˜æ˜ å°„æ—¶ï¼Œä¼šå‡ºç°é”™è¯¯ï¼Œå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒæˆ–æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
</li>
<li><p><strong>ä¼˜åŒ–æ€§èƒ½</strong>ï¼š<br>é€‚å½“åœ°è®¾ç½® <code>vm.max_map_count</code> å¯ä»¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œç¡®ä¿å†…å­˜æ˜ å°„æ“ä½œé¡ºåˆ©è¿›è¡Œã€‚</p>
</li>
</ol>
<p>æ£€æŸ¥å½“å‰çš„ <code>vm.max_map_count</code> å€¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl vm.max_map_count</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…æŸ¥çœ‹ <code>/proc/sys/vm/max_map_count</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/vm/max_map_count</span><br></pre></td></tr></table></figure>

<p>Elasticsearch å®˜æ–¹å»ºè®®å°† <code>vm.max_map_count</code> è®¾ç½®ä¸ºè‡³å°‘ 262144ã€‚å¯¹äºå…¶ä»–åº”ç”¨ç¨‹åºã€‚</p>
<p>Easysearch å…·ä½“å®‰è£…æ­¥éª¤è§<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38781498/article/details/140077785">INFINI Easysearch å°é²œ Hands on
</a></p>
<h3 id="Amazon-OpenSearch"><a href="#Amazon-OpenSearch" class="headerlink" title="Amazon OpenSearch"></a>Amazon OpenSearch</h3><p>ä½¿ç”¨ Amazon Web Services æ§åˆ¶å°è¿›è¡Œåˆ›å»ºã€‚</p>
<h3 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h3><p>ä½¿ç”¨å¦‚ä¸‹ docker compose éƒ¨ç½²ä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„ ES é›†ç¾¤ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.2&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es01</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data01:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es02</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data02:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line">  <span class="attr">es03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es03</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data03:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data01:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data02:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data03:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">elastic:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºè¿™ä¸ª docker compose æ²¡æœ‰å…³äº kibana çš„é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ç”¨ Console æ·»åŠ åŸç”Ÿçš„ Elasticsearch é›†ç¾¤<img src="https://i-blog.csdnimg.cn/direct/edc37c2feb794c4d8d06ba9a7d8bd190.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<p>é›†ç¾¤ä¿¡æ¯</p>
<p><img src="https://i-blog.csdnimg.cn/direct/b814ba386e294a9f81c3375c0669f59c.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p>
<h2 id="å¿«ç…§è¿˜åŸçš„æ­¥éª¤"><a href="#å¿«ç…§è¿˜åŸçš„æ­¥éª¤" class="headerlink" title="å¿«ç…§è¿˜åŸçš„æ­¥éª¤"></a>å¿«ç…§è¿˜åŸçš„æ­¥éª¤</h2><h3 id="å¿«ç…§å‰çš„å‡†å¤‡"><a href="#å¿«ç…§å‰çš„å‡†å¤‡" class="headerlink" title="å¿«ç…§å‰çš„å‡†å¤‡"></a>å¿«ç…§å‰çš„å‡†å¤‡</h3><h3 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h3><p>æœ¬æ¬¡æµ‹è¯•é€‰æ‹©æŠŠç´¢å¼•å¿«ç…§å¤‡ä»½åˆ° Amazon S3ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ S3 repository pluginï¼Œè¿™ä¸ªæ’ä»¶æ·»åŠ äº†å¯¹ä½¿ç”¨ Amazon S3 ä½œä¸ºå¿«ç…§&#x2F;æ¢å¤å­˜å‚¨åº“çš„æ”¯æŒã€‚</p>
<p>Easysearch å’Œ OpenSearch é›†ç¾¤è‡ªå¸¦äº†è¿™ä¸ªæ’ä»¶ï¼Œæ‰€ä»¥æ— éœ€é¢å¤–å®‰è£…ã€‚</p>
<p>å¯¹äºè‡ªå·±éƒ¨ç½²çš„ä¸‰èŠ‚ç‚¹ Elasticsearch åˆ™éœ€è¦è¿›å…¥æ¯ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œå®‰è£…å‘½ä»¤ç„¶åå†é‡å¯é›†ç¾¤ï¼Œå»ºè®®ä½¿ç”¨è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·æ¥åšè¿™æ­¥ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> bin/elasticsearch-plugin install repository-s3</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸å†éœ€è¦è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥è¿™æ ·åˆ é™¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> bin/elasticsearch-plugin remove repository-s3</span><br></pre></td></tr></table></figure>

<p>ç”±äºéœ€è¦å’Œ Amazon Web Services æ‰“äº¤é“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½® IAM å‡­è¯ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥ä» EC2 IAM instance profileï¼ŒECS task role ä»¥åŠ EKS çš„ Service account è¯»å–ç›¸åº”çš„å‡­è¯ã€‚</p>
<p>å¯¹äºæ‰˜ç®¡çš„ Amazon OpenSearch æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•åœ¨æ‰˜ç®¡çš„ EC2 ä¸Šç»‘å®šæˆ‘ä»¬çš„å‡­è¯ï¼Œæ‰€ä»¥éœ€è¦æ–°å»ºä¸€ä¸ª OpenSearchSnapshotRoleï¼Œç„¶åé€šè¿‡å½“å‰çš„ç”¨æˆ·æŠŠè¿™ä¸ªè§’è‰²ä¼ é€’ç»™æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ IAM:PassRoleã€‚</p>
<p>åˆ›å»º OpenSearchSnapshotRoleï¼Œç­–ç•¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;Version&quot;</span>: <span class="string">&quot;2012-10-17&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Statement&quot;</span>: [&#123;</span><br><span class="line">      <span class="string">&quot;Action&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;s3:ListBucket&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Resource&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;arn:aws:s3:::bucket-name&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;Action&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;s3:GetObject&quot;</span>,</span><br><span class="line">        <span class="string">&quot;s3:PutObject&quot;</span>,</span><br><span class="line">        <span class="string">&quot;s3:DeleteObject&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;Effect&quot;</span>: <span class="string">&quot;Allow&quot;</span>,</span><br><span class="line">      <span class="string">&quot;Resource&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;arn:aws:s3:::bucket-name/*&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿¡ä»»å…³ç³»å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Principal&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Service&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es.amazonaws.com&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sts:AssumeRole&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æˆ‘ä»¬çš„ IAM user ä¸ŠåŠ ä¸Š PassRole çš„æƒé™ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠ OpenSearchSnapshotRole ä¼ é€’ç»™ OpenSearch é›†ç¾¤ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2012-10-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Statement&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Effect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iam:PassRole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Resource&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::123456789012:role/OpenSearchSnapshotRole&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ³¨å†Œå­˜å‚¨åº“"><a href="#æ³¨å†Œå­˜å‚¨åº“" class="headerlink" title="æ³¨å†Œå­˜å‚¨åº“"></a>æ³¨å†Œå­˜å‚¨åº“</h3><p>åœ¨æºé›†ç¾¤æ‰§è¡Œæ³¨å†Œ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /_snapshot/snapshot-repo-name</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;base_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-prefix&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç›®æ ‡é›†ç¾¤åŒæ ·æ‰§è¡Œè¿™ä¸ªè¯­å¥ï¼Œä¸ºäº†é˜²æ­¢è¦†ç›–æºé›†ç¾¤å­˜å‚¨åº“çš„æ•°æ®ï¼Œå°† â€œreadonlyâ€: true æ·»åŠ åˆ°â€settingsâ€ PUT è¯·æ±‚ä¸­ï¼Œè¿™æ ·å°±åªæœ‰ä¸€ä¸ªé›†ç¾¤å…·æœ‰å¯¹å­˜å‚¨åº“çš„å†™å…¥æƒé™ã€‚</p>
<p>å¦‚æœ Bucket åœ¨ä¸­å›½åŒºï¼Œé‚£ä¹ˆè¿˜éœ€è¦åŠ ä¸Š<strong>endpoint: <a target="_blank" rel="noopener" href="https://s3/">https://s3</a>.&lt; region &gt;.amazonaws.com.cn</strong>è¿™æ ·çš„å‚æ•°ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT /_snapshot/snapshot-repo-name</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;base_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-prefix&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äº OpenSearch æ¥è¯´ï¼Œè¿˜éœ€è¦æ‰§è¡Œ passroleï¼Œæ‰€ä»¥è¿˜éœ€è¦æ·»åŠ <strong>role_arn</strong>è¿™ä¸ªå­—æ®µï¼Œç”±äº IAM:PassRole éœ€è¦å¯¹ HTTP è¯·æ±‚åš signV4 æ—¥ç­¾åï¼Œæ‰€ä»¥è¿™éƒ¨å¸¸å¸¸ä½¿ç”¨ Postman æ¥å®Œæˆã€‚æŠŠè§’è‰²ä¼ é€’è¿‡å»ä¹‹åï¼Œæ¥ä¸‹æ¥çš„å¿«ç…§è¿˜åŸæ“ä½œå°±å¯ä»¥åœ¨ OpenSearch Dashboard ä¸­è¿›è¡Œæ“ä½œäº†ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/direct/0db4d578214d47d483d1f15cde3f848e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦åœ¨ auth è¿™é‡Œè¾“å…¥ AccessKeyï¼ŒSecretKeyï¼ŒAWS Regionï¼ŒService Nameï¼ˆesï¼‰æ¥åš SignV4 çš„ç­¾åã€‚<br><img src="https://i-blog.csdnimg.cn/direct/26d8ee62236a4c97a498419328746bfc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¯·æ±‚ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;base_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-prefix&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;role_arn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arn:aws:iam::123456789012:role/OpenSearchSnapshotRole&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><ul>
<li><strong>æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„å­˜å‚¨åº“</strong>ï¼š<ul>
<li><code>GET _snapshot</code>ï¼šè¿™ä¸ªå‘½ä»¤è¿”å›æ‰€æœ‰å·²æ³¨å†Œçš„å¿«ç…§å­˜å‚¨åº“åˆ—è¡¨åŠå…¶åŸºæœ¬ä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;es_repository&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-s3-bucket-name&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;region&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-s3-bucket-region&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æŸ¥çœ‹ç‰¹å®šå­˜å‚¨åº“çš„è¯¦ç»†ä¿¡æ¯</strong>ï¼š<br><code>GET _snapshot/es_repository</code>ï¼šè¿™ä¸ªå‘½ä»¤è¿”å›åä¸º<code>es_repository</code>çš„å­˜å‚¨åº“çš„è¯¦ç»†é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­˜å‚¨æ¡¶åç§°ã€åŒºåŸŸå’Œå…¶ä»–è®¾ç½®ã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot/es_repository</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;es_repository&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-s3-bucket-name&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;region&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-s3-bucket-region&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;access_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-access-key&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;secret_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-secret-key&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æŸ¥çœ‹ç‰¹å®šå­˜å‚¨åº“ä¸­çš„å¿«ç…§</strong>ï¼š<br><code>GET _cat/snapshots/es_repository?v</code>ï¼šè¿™ä¸ªå‘½ä»¤è¿”å›<code>es_repository</code>å­˜å‚¨åº“ä¸­çš„æ‰€æœ‰å¿«ç…§åŠå…¶è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¿«ç…§ IDã€çŠ¶æ€ã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€æŒç»­æ—¶é—´ã€åŒ…å«çš„ç´¢å¼•æ•°é‡ã€æˆåŠŸå’Œå¤±è´¥çš„åˆ†ç‰‡æ•°é‡ç­‰ã€‚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/snapshots/es_repository?v</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span>                     status start_epoch start_time end_epoch end_time duration indices successful_shards failed_shards total_shards</span><br><span class="line">snapshot_1             SUCCESS 1628884800 08:00:00   1628888400 09:00:00 1h       3       10                0             10</span><br><span class="line">snapshot_2             SUCCESS 1628971200 08:00:00   1628974800 09:00:00 1h       3       10                0             10</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç´¢å¼•å¿«ç…§"><a href="#åˆ›å»ºç´¢å¼•å¿«ç…§" class="headerlink" title="åˆ›å»ºç´¢å¼•å¿«ç…§"></a>åˆ›å»ºç´¢å¼•å¿«ç…§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PUT _snapshot/my_repository/&lt;my_snapshot_&#123;now/d&#125;&gt;</span></span><br><span class="line">PUT _snapshot/my_repository/my_snapshot</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;indices&quot;</span>: <span class="string">&quot;my-index,logs-my_app-default&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å¿«ç…§çš„å¤§å°ä¸åŒï¼Œå®Œæˆå¿«ç…§å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcreate snapshot API åªä¼šå¼‚æ­¥å¯åŠ¨å¿«ç…§è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹åœ¨åå°è¿è¡Œã€‚è¦æ›´æ”¹ä¸ºåŒæ­¥è°ƒç”¨ï¼Œå¯ä»¥å°† <code>wait_for_completion</code> æŸ¥è¯¢å‚æ•°è®¾ç½®ä¸º <code>true</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT _snapshot/my_repository/my_snapshot?wait_for_completion=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨ clone snapshot API å…‹éš†ç°æœ‰çš„å¿«ç…§ã€‚è¦ç›‘æ§å½“å‰æ­£åœ¨è¿è¡Œçš„å¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ <code>_current</code> è¯·æ±‚è·¯å¾„å‚æ•°çš„ get snapshot APIã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot/my_repository/_current</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦è·å–å‚ä¸å½“å‰è¿è¡Œå¿«ç…§çš„æ¯ä¸ªåˆ†ç‰‡çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ get snapshot status APIã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _snapshot/_status</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸåˆ›å»ºå¿«ç…§ä¹‹åï¼Œå°±å¯ä»¥åœ¨ S3 ä¸Šçœ‹åˆ°å¤‡ä»½çš„æ•°æ®å—æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯æ­£ç¡®çš„å¿«ç…§å±‚çº§ç»“æ„ï¼š<br><img src="https://i-blog.csdnimg.cn/direct/5f14fe8a4724434bb821fa649e1ce1c1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ â€œbase_pathâ€: â€œ<bucket-prefix>â€œè¿™é‡Œæœ€å¥½ä¸è¦åŠ &#x2F;ï¼Œè™½ç„¶ä¸å½±å“åŒé›†ç¾¤è¿ç§»ï¼Œè¿™ä¸ªä¼šä¸ºæˆ‘ä»¬åœ¨ä¸åŒå‚å•†çš„æœç´¢å¼•æ“ä¸­è¿ç§»é‡åˆ°é—®é¢˜ï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ã€‚<img src="https://i-blog.csdnimg.cn/direct/f07f8927c0724ddc8bd363c1dc13fd64.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°">æ‰€ä»¥åœ¨ Open Search ä¸­è¿˜åŸ Elasticsearch å°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_missing_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[easy_repository:2/-jOQ0oucQDGF3hJMNz-vKQ] is missing&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_missing_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[easy_repository:2/-jOQ0oucQDGF3hJMNz-vKQ] is missing&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caused_by&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;no_such_file_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Blob object [11111/indices/7fv2zAi4Rt203JfsczUrBg/meta-YGnzxZABRBxW-2vqcmci.dat] not found: The specified key does not exist. (Service: S3, Status Code: 404, Request ID: R71DDHX4XXM0434T, Extended Request ID: d9M/HWvPvMFdPhB6KX+wYCW3ZFqeFo9EoscWPkulOXWa+TnovAE5PlemtuVzKXjlC+rrgskXAus=)&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">404</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¢å¤ç´¢å¼•å¿«ç…§"><a href="#æ¢å¤ç´¢å¼•å¿«ç…§" class="headerlink" title="æ¢å¤ç´¢å¼•å¿«ç…§"></a>æ¢å¤ç´¢å¼•å¿«ç…§</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST _snapshot/my_repository/my_snapshot_2099.05.06/_restore</span><br><span class="line">&#123;</span><br><span class="line">  &quot;indices&quot;: &quot;my-index,logs-my_app-default&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å„ä¸ªé›†ç¾¤çš„è¿˜åŸ"><a href="#å„ä¸ªé›†ç¾¤çš„è¿˜åŸ" class="headerlink" title="å„ä¸ªé›†ç¾¤çš„è¿˜åŸ"></a>å„ä¸ªé›†ç¾¤çš„è¿˜åŸ</h2><ol>
<li><p>Elasticsearch 7.10.2 çš„å¿«ç…§å¯ä»¥è¿˜åŸåˆ° Easysearch å’Œ Amazon OpenSearch</p>
</li>
<li><p>ä» Easysearch 1.8.2 è¿˜åŸåˆ° Elasticsearch 7.10.2 æŠ¥é”™å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[s3_repository:1/a2qV4NYIReqvgW6BX_nxxw] cannot restore index [my_indexs] because it cannot be upgraded&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[s3_repository:1/a2qV4NYIReqvgW6BX_nxxw] cannot restore index [my_indexs] because it cannot be upgraded&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caused_by&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_state_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The index [[my_indexs/ALlTCIr0RJqtP06ouQmf0g]] was created with version [1.8.2] but the minimum compatible version is [6.0.0-beta1]. It should be re-indexed in Elasticsearch 6.x before upgrading to 7.10.2.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä» Amazon OpenSearch 2.1.3 è¿˜åŸåˆ° Elasticsearch 7.10.2 æŠ¥é”™å¦‚ä¸‹ï¼ˆæ— è®ºæ˜¯å¦å¼€å¯å…¼å®¹æ¨¡å¼ï¼‰ï¼š</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[aos:2/D-oyYSscSdCbZFcmPZa_yg] the snapshot was created with Elasticsearch version [36.34.78-beta2] which is higher than the version of this node [7.10.2]&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[aos:2/D-oyYSscSdCbZFcmPZa_yg] the snapshot was created with Elasticsearch version [36.34.78-beta2] which is higher than the version of this node [7.10.2]&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä» Easysearch 1.8.2 è¿˜åŸåˆ° Amazon OpenSearch2.13 æŠ¥é”™å¦‚ä¸‹ï¼ˆæ— è®ºæ˜¯å¦å¼€å¯å…¼å®¹æ¨¡å¼ï¼‰ï¼š</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[easy_repository:2/LE18AWHlRJu9rpz9BJatUQ] cannot restore index [my_indexs] because it cannot be upgraded&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[easy_repository:2/LE18AWHlRJu9rpz9BJatUQ] cannot restore index [my_indexs] because it cannot be upgraded&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caused_by&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_state_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The index [[my_indexs/VHOo7yfDTRa48uhQvquFzQ]] was created with version [1.8.2] but the minimum compatible version is OpenSearch 1.0.0 (or Elasticsearch 7.0.0). It should be re-indexed in OpenSearch 1.x (or Elasticsearch 7.x) before upgrading to 2.13.0.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Amazon OpenSearch è¿˜åŸåˆ° Easysearch åŒæ ·å¤±è´¥</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[aoss:2/D-oyYSscSdCbZFcmPZa_yg] cannot restore index [aos] because it cannot be upgraded&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;snapshot_restore_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[aoss:2/D-oyYSscSdCbZFcmPZa_yg] cannot restore index [aos] because it cannot be upgraded&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caused_by&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;illegal_state_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The index [[aos/864WjTAXQCaxJ829V5ktaw]] was created with version [36.34.78-beta2] but the minimum compatible version is [6.0.0]. It should be re-indexed in Easysearch 6.x before upgrading to 1.8.2.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>Elasticsearch8.14.3 è¿ç§»åˆ° Amazon OpenSearch æˆ–è€… Elasticsearch éƒ½æ˜¯æœ‰è¿™ä¸ªæŠ¥é”™ï¼š</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;parsing_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Failed to parse object: unknown field [uuid] found&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;line&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;col&quot;</span><span class="punctuation">:</span> <span class="number">25</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;repository_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[snap] Unexpected exception when loading repository data&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;caused_by&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;parsing_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Failed to parse object: unknown field [uuid] found&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;line&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;col&quot;</span><span class="punctuation">:</span> <span class="number">25</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">500</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ç”±äº Elasticsearch8 åœ¨åˆ›å»ºå¿«ç…§çš„æ—¶å€™ä¼šé»˜è®¤åŠ ä¸Šä¸€ä¸ª UUID çš„å­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬ä½ç‰ˆæœ¬çš„ Easysearchã€Amazon OpenSearch ä¸­ä¼šæ‰¾ä¸åˆ°è¿™ä¸ªå­—æ®µï¼Œåœ¨æ‰§è¡Œ<code>GET _cat/snapshots/snap?v</code>çš„æ—¶å€™å°±æŠ¥é”™ï¼ŒåŠæ—¶åœ¨æ³¨å†Œå­˜å‚¨åº“çš„æ—¶å€™æ˜¾ç¤ºåŠ ä¸Š UUID çš„å­—æ®µä¹Ÿæ— äº‹æ— è¡¥ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;snapshot-repo-name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qlJ0uqErRmW6aww2Fyt4Fg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;base_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;bucket-prefix&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ˜¯å…¼å®¹æ€§å¯¹æ¯”ï¼Œæ¯è¡Œç¬¬ä¸€åˆ—ä»£è¡¨æºé›†ç¾¤ï¼Œç¬¬ä¸€è¡Œä»£è¡¨ç›®æ ‡é›†ç¾¤ï¼š</p>
<table>
<thead>
<tr>
<th>å¿«ç…§å…¼å®¹å¯¹æ¯”</th>
<th>Easysearch 1.8.2</th>
<th>Elasticsearch 7.10.2</th>
<th>OpenSearch 2.13</th>
</tr>
</thead>
<tbody><tr>
<td>Easysearch 1.8.2</td>
<td>å…¼å®¹</td>
<td><strong>ä¸å…¼å®¹</strong></td>
<td><strong>ä¸å…¼å®¹</strong></td>
</tr>
<tr>
<td>Elasticsearch 7.10.2</td>
<td>å…¼å®¹</td>
<td>å…¼å®¹</td>
<td>å…¼å®¹</td>
</tr>
<tr>
<td>OpenSearch 2.13</td>
<td><strong>ä¸å…¼å®¹</strong></td>
<td><strong>ä¸å…¼å®¹</strong></td>
<td>å…¼å®¹</td>
</tr>
</tbody></table>
<p>Elasticsearch çš„å…¼å®¹åˆ—è¡¨å®˜æ–¹çš„åˆ—è¡¨å¦‚ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/direct/42760eba986a4605a15256c0b9264b1c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>å¼€å§‹ä½¿ç”¨ Elastic Stack å’Œ Docker Composeï¼šç¬¬ 1 éƒ¨åˆ†<br><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/blog/getting-started-with-the-elastic-stack-and-docker-compose">https://www.elastic.co/cn/blog/getting-started-with-the-elastic-stack-and-docker-compose</a></p>
<p>Docker Compose éƒ¨ç½²å¤šèŠ‚ç‚¹ Elasticsearch</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/docker.html#docker-compose-file">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/docker.html#docker-compose-file</a></p>
<p>repository-s3 æ•™ç¨‹</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/8.14/repository-s3.html">https://www.elastic.co/guide/en/elasticsearch/reference/8.14/repository-s3.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/plugins/7.10/repository-s3.html">https://www.elastic.co/guide/en/elasticsearch/plugins/7.10/repository-s3.html</a></p>
<p>snapshot-restore</p>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.10/snapshot-restore.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/snapshot-restore.html</a></p>
<p>åœ¨äºšé©¬é€Š OpenSearch æœåŠ¡ä¸­åˆ›å»ºç´¢å¼•å¿«ç…§</p>
<p><a target="_blank" rel="noopener" href="https://docs.amazonaws.cn/zh_cn/opensearch-service/latest/developerguide/managedomains-snapshots.html#managedomains-snapshot-restore">https://docs.amazonaws.cn/zh_cn/opensearch-service/latest/developerguide/managedomains-snapshots.html#managedomains-snapshot-restore</a></p>
<p>æ•™ç¨‹ï¼šè¿ç§»è‡³ Amazon OpenSearch Service</p>
<p><a target="_blank" rel="noopener" href="https://docs.amazonaws.cn/zh_cn/opensearch-service/latest/developerguide/migration.html">https://docs.amazonaws.cn/zh_cn/opensearch-service/latest/developerguide/migration.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-07-01T16:00:00.000Z" title="7/1/2025, 4:00:00 PM">2025-07-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-06-30T11:27:39.643Z" title="6/30/2025, 11:27:39 AM">2025-06-30</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/">æé™ç§‘æŠ€</a></span><span class="level-item">5 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦738ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="../../%E6%8E%A8%E8%8D%90%E7%BB%99-easysearch-%E6%96%B0%E7%94%A8%E6%88%B7%E7%9A%84%E5%87%A0%E4%B8%AA-elasticsearch-%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7/">æ¨èç»™ Easysearch æ–°ç”¨æˆ·çš„å‡ ä¸ª Elasticsearch å¯è§†åŒ–å·¥å…·</a></p><div class="content"><p>Easysearch ä½œä¸ºå›½äº§åŒ–çš„ Elasticsearchï¼ˆESï¼‰æ›¿ä»£æ–¹æ¡ˆï¼Œå…¼å®¹ Elasticsearch ç”Ÿæ€ç³»ç»Ÿä¸­çš„å¤šç§å·¥å…·ã€‚æœ¬æ–‡å°†ä»‹ç»å‡ æ¬¾é€‚åˆ Easysearch ç”¨æˆ·çš„å¯è§†åŒ–å·¥å…·ï¼Œå¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°ç®¡ç†å’ŒæŸ¥è¯¢æ•°æ®ã€‚</p>
<h3 id="1-Elasticsearch-Head-æ’ä»¶"><a href="#1-Elasticsearch-Head-æ’ä»¶" class="headerlink" title="1. Elasticsearch Head æ’ä»¶"></a>1. Elasticsearch Head æ’ä»¶</h3><p>åœ¨ ES åŸ¹è®­ç»å¸¸æåˆ°çš„ Elasticsearch Head æ˜¯ä¸€æ¬¾åŸºäºæµè§ˆå™¨çš„æ’ä»¶ï¼Œé€‚åˆä¸æƒ³éƒ¨ç½² Kibana ç­‰å¤æ‚å·¥å…·çš„ç”¨æˆ·ã€‚å®ƒæä¾›äº†ç®€æ´çš„ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€ç´¢å¼•åˆ†å¸ƒã€åˆ†ç‰‡ä¿¡æ¯ç­‰ã€‚</p>
<h4 id="ä¸»è¦åŠŸèƒ½ï¼š"><a href="#ä¸»è¦åŠŸèƒ½ï¼š" class="headerlink" title="ä¸»è¦åŠŸèƒ½ï¼š"></a>ä¸»è¦åŠŸèƒ½ï¼š</h4><ul>
<li><p><strong>ç´¢å¼•åˆ†å¸ƒæŸ¥çœ‹</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/3b97af37be16f5933582b9ff59cc1f0e.png" alt="image-20250220212800529"></p>
</li>
<li><p><strong>ç´¢å¼•è¯¦ç»†ä¿¡æ¯</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/48457d48ecd03439f8c5e5fdf522df28.png" alt="image-20250220214716206"></p>
</li>
<li><p><strong>åˆ†ç‰‡ä¿¡æ¯æŸ¥çœ‹</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/2b0dbf3a2b97198d122ba8b3f40e8662.png" alt="image-20250220214729464"></p>
</li>
<li><p><strong>DSL æŸ¥è¯¢</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/fb96526276868690ff0c01af4207f6ca.png"></p>
</li>
</ul>
<h3 id="2-Elasticvue-æ’ä»¶"><a href="#2-Elasticvue-æ’ä»¶" class="headerlink" title="2. Elasticvue æ’ä»¶"></a>2. Elasticvue æ’ä»¶</h3><p>Elasticvue æ˜¯ä¸€æ¬¾é«˜è¯„åˆ†ã€é«˜é¢œå€¼çš„ Chrome æ’ä»¶ï¼ŒåŠŸèƒ½å…¨é¢ï¼Œé€‚åˆéœ€è¦æ›´ä¸°å¯ŒåŠŸèƒ½çš„ç”¨æˆ·ã€‚</p>
<h4 id="ä¸»è¦åŠŸèƒ½ï¼š-1"><a href="#ä¸»è¦åŠŸèƒ½ï¼š-1" class="headerlink" title="ä¸»è¦åŠŸèƒ½ï¼š"></a>ä¸»è¦åŠŸèƒ½ï¼š</h4><ul>
<li><p><strong>èŠ‚ç‚¹ä¿¡æ¯æŸ¥çœ‹</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/1fe678284f16178ec42847dcfd6f3857.png"></p>
</li>
<li><p><strong>ç´¢å¼•æŸ¥çœ‹</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/1fe678284f16178ec42847dcfd6f3857.png" alt="image-20250220214619935"></p>
</li>
<li><p><strong>DSL æŸ¥è¯¢</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/26f4d54f74c49a8c624a9c0b5a5937b8.png" alt="image-20250220214557277"></p>
</li>
<li><p><strong>å¿«ç…§å­˜å‚¨åº“ç®¡ç†</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/6375e74b0e378bd8f7af75f9f9b4dc03.png" alt="image-20250220214520263"></p>
</li>
</ul>
<h3 id="3-Cerebro"><a href="#3-Cerebro" class="headerlink" title="3. Cerebro"></a>3. Cerebro</h3><p>Cerebro æ˜¯ä¸€æ¬¾éœ€è¦è‡ªè¡Œéƒ¨ç½²çš„å·¥å…·ï¼Œå»ºè®®ä½¿ç”¨ Docker è¿›è¡Œå®‰è£…ã€‚ä¸ºäº†é¿å…ç«¯å£å†²çªå’Œ TLS è®¤è¯é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡ Gateway è¿›è¡Œè½¬å‘ã€‚</p>
<h4 id="éƒ¨ç½²æ­¥éª¤ï¼š"><a href="#éƒ¨ç½²æ­¥éª¤ï¼š" class="headerlink" title="éƒ¨ç½²æ­¥éª¤ï¼š"></a>éƒ¨ç½²æ­¥éª¤ï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9100:9000 lmenezes/cerebro</span><br></pre></td></tr></table></figure>

<h4 id="ä¸»è¦åŠŸèƒ½ï¼š-2"><a href="#ä¸»è¦åŠŸèƒ½ï¼š-2" class="headerlink" title="ä¸»è¦åŠŸèƒ½ï¼š"></a>ä¸»è¦åŠŸèƒ½ï¼š</h4><ul>
<li><p><strong>é›†ç¾¤ç®¡ç†</strong><br><img src="https://i-blog.csdnimg.cn/img_convert/c4684c2805620db2baa822137df95b00.png" alt="image-20250220214359979"></p>
</li>
<li><p><strong>ç½‘ç»œè¯·æ±‚å¤„ç†</strong><br>Cerebro æœ‰è‡ªå·±çš„åç«¯æœåŠ¡ï¼Œè¯·æ±‚å¹¶éç›´æ¥ä»æµè§ˆå™¨å‘å‡ºã€‚å› æ­¤ï¼Œå¯åŠ¨ Docker å®¹å™¨æ—¶ï¼Œé¿å…è¿æ¥ <code>localhost</code>ï¼Œä»¥å…è¿›å…¥å®¹å™¨å†…éƒ¨ã€‚<br><img src="https://i-blog.csdnimg.cn/img_convert/1690bffb19a0cfeb124742d3ac18dd9b.png" alt="image-20250220213719116"></p>
</li>
</ul>
<p>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/direct/9cbda99b13ef4d84827e69e7c3043a68.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å¯è§†åŒ–åŠŸèƒ½ä¸€è§ˆï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/img_convert/165c89bef5d1d63f8a9e7ae63534f609.png" alt="image-20250220215239365"></p>
<h3 id="4-è®¤è¯ä¸å®‰å…¨"><a href="#4-è®¤è¯ä¸å®‰å…¨" class="headerlink" title="4. è®¤è¯ä¸å®‰å…¨"></a>4. è®¤è¯ä¸å®‰å…¨</h3><p>å¯¹äºéœ€è¦å¯†ç è®¤è¯çš„è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li><p><strong>ç›´æ¥è¿æ¥</strong>ï¼š<br><code>https://admin:xxxxx@localhost:9200/</code></p>
</li>
<li><p><strong>Base64 ç¼–ç å‡­è¯</strong>ï¼š<br>å¯ä»¥ä½¿ç”¨ Postman æˆ–å…¶ä»–å·¥å…·ç”Ÿæˆ Base64 ç¼–ç çš„å‡­è¯ï¼Œå¹¶åœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’ã€‚</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://localhost:9200&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Basic YWRtaW46NzllYTM4MzMwMmM2OGZiYWM0MDc=&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.request(<span class="string">&quot;GET&quot;</span>, url, headers=headers, data=payload)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»¥ä¸Šå·¥å…·å„æœ‰ç‰¹è‰²ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚æ— è®ºæ˜¯ç®€å•çš„æµè§ˆå™¨æ’ä»¶ï¼Œè¿˜æ˜¯åŠŸèƒ½æ›´å¼ºå¤§çš„ Cerebroï¼Œéƒ½èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç®¡ç†å’ŒæŸ¥è¯¢ Easysearch é›†ç¾¤ã€‚</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="../5/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next"><a href="../7/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="../../">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="../5/">5</a></li><li><a class="pagination-link is-current" href="">6</a></li><li><a class="pagination-link" href="../7/">7</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="../14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="../../images/me.png" alt="Xu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Xu</p><p class="is-size-6 is-block">éšæ‰‹è®°</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>BEI JING</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="../../archives/"><p class="title">140</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="../../categories/"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="../../tags/"><p class="title">35</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Xu-Hardy/Xu-Hardy.github.io" target="_blank" rel="me noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Home" href="https://xu-hardy.github.io/"><i class="fa fa-home"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="AWS" href="https://xu-hardy.github.io/aws"><i class="fab fa-aws"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="archives" href="https://xu-hardy.github.io/archives"><i class="fa fa-calendar"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Tags" href="https://xu-hardy.github.io/tags"><i class="fa fa-tags"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="../../atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li><li><a class="level is-mobile" href="https://liarlee.site/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Liarlee</span></span><span class="level-right"><span class="level-item tag">liarlee.site</span></span></a></li><li><a class="level is-mobile" href="https://easyhexo.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">easyhexo</span></span><span class="level-right"><span class="level-item tag">easyhexo.com</span></span></a></li><li><a class="level is-mobile" href="https://ppoffice.github.io/hexo-theme-icarus/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">hexo-theme-icarus</span></span><span class="level-right"><span class="level-item tag">ppoffice.github.io</span></span></a></li><li><a class="level is-mobile" href="https://ctext.org/histories/zhs" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ä¸­å›½å“²å­¦ä¹¦ç”µå­åŒ–è®¡åˆ’</span></span><span class="level-right"><span class="level-item tag">ctext.org</span></span></a></li><li><a class="level is-mobile" href="http://mahacashiaba.blogspot.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">äº”ä¸ªäº”ç™¾å¹´å‰</span></span><span class="level-right"><span class="level-item tag">mahacashiaba.blogspot.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="../../categories/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="../../categories/Apple/"><span class="level-start"><span class="level-item">Apple</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../categories/LLM/"><span class="level-start"><span class="level-item">LLM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E5%90%83%E8%B4%A7/"><span class="level-start"><span class="level-item">åƒè´§</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E5%A4%96%E8%AE%BE/"><span class="level-start"><span class="level-item">å¤–è®¾</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E6%87%92%E7%8C%AB%E5%BE%AE%E6%9C%8D/"><span class="level-start"><span class="level-item">æ‡’çŒ«å¾®æœ</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E6%9E%81%E9%99%90%E7%A7%91%E6%8A%80/"><span class="level-start"><span class="level-item">æé™ç§‘æŠ€</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E7%BE%A4%E6%99%96/"><span class="level-start"><span class="level-item">ç¾¤æ™–</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">è¯»ä¹¦ç¬”è®°</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/"><span class="level-start"><span class="level-item">è¿œç¨‹è®¿é—®</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">éšç¬”</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-02T16:00:00.000Z">2025-07-03</time></p><p class="title"><a href="../../%E6%87%92%E7%8C%AB%E5%BE%AE%E6%9C%8D%E5%BC%80%E5%8F%91%E7%AF%87%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E6%87%92%E7%8C%AB%E5%BE%AE%E6%9C%8D%E5%85%A8%E6%A0%88%E4%B8%8A%E6%9E%B6%E6%8C%87%E5%8D%97%EF%BC%8C%E4%B8%80%E6%AD%A5%E6%89%93%E5%8C%85%EF%BC%8C%E4%B8%80%E9%94%AE%E5%8F%91%E5%B8%83/">æ‡’çŒ«å¾®æœå¼€å‘ç¯‡ï¼ˆä¸€ï¼‰ï¼šæ‡’çŒ«å¾®æœå…¨æ ˆä¸Šæ¶æŒ‡å—ï¼Œä¸€æ­¥æ‰“åŒ…ï¼Œä¸€é”®å‘å¸ƒ</a></p><p class="categories"><a href="../../categories/%E6%87%92%E7%8C%AB%E5%BE%AE%E6%9C%8D/">æ‡’çŒ«å¾®æœ</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-01T16:00:00.000Z">2025-07-02</time></p><p class="title"><a href="../../gemini-cli-%E8%B8%A9%E5%9D%91%E6%9C%BA%EF%BC%9A%E5%9B%BD%E5%86%85%E7%8E%AF%E5%A2%83-%E7%94%A8%E8%BF%87-google-cloud-%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%EF%BC%9F/">Gemini-cli è¸©å‘æœºï¼šå›½å†…ç¯å¢ƒ , ç”¨è¿‡ Google Cloud å¦‚ä½•è®¾ç½®ï¼Ÿ</a></p><p class="categories"><a href="../../categories/LLM/">LLM</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-01T16:00:00.000Z">2025-07-02</time></p><p class="title"><a href="../../%E5%A6%82%E4%BD%95%E5%9C%A8-aws-ec2-%E4%B8%8A%E9%83%A8%E7%BD%B2-isaac-sim/">å¦‚ä½•åœ¨ AWS EC2 ä¸Šéƒ¨ç½² Isaac Sim</a></p><p class="categories"><a href="../../categories/AWS/">AWS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-01T16:00:00.000Z">2025-07-02</time></p><p class="title"><a href="../../%E7%BB%84%E9%98%9F%E5%8F%82%E5%8A%A0-amazon-q-idea-1000%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E4%BD%9C%E5%93%81%E4%B8%8A%E4%BA%86-aws-%E5%B3%B0%E4%BC%9A/">ç»„é˜Ÿå‚åŠ  Amazon Q Idea 1000ï¼Œæˆ‘ä»¬çš„ä½œå“ä¸Šäº† AWS å³°ä¼š</a></p><p class="categories"><a href="../../categories/AWS/">AWS</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-07-01T16:00:00.000Z">2025-07-02</time></p><p class="title"><a href="../../%E8%AE%B0%E4%B8%80%E6%AC%A1amazon-q-pro%E7%9A%84%E4%BD%BF%E7%94%A8/">è®°ä¸€æ¬¡Amazon Q proçš„ä½¿ç”¨</a></p><p class="categories"><a href="../../categories/AWS/">AWS</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="../../archives/2025/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2025</span></span><span class="level-end"><span class="level-item tag">76</span></span></a></li><li><a class="level is-mobile" href="../../archives/2025/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2025</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="../../archives/2025/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2025</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2024/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/04/"><span class="level-start"><span class="level-item">å››æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2023/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/10/"><span class="level-start"><span class="level-item">åæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2022/04/"><span class="level-start"><span class="level-item">å››æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2021/10/"><span class="level-start"><span class="level-item">åæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2021/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="../../archives/2020/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2018/10/"><span class="level-start"><span class="level-item">åæœˆ 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="../../archives/2018/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="../../archives/2017/10/"><span class="level-start"><span class="level-item">åæœˆ 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="../../archives/2017/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="../../tags/AWS/"><span class="tag">AWS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Apple/"><span class="tag">Apple</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Coco-AI/"><span class="tag">Coco-AI</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/DIY/"><span class="tag">DIY</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Docker/"><span class="tag">Docker</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Isaac/"><span class="tag">Isaac</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/LLM/"><span class="tag">LLM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Linux/"><span class="tag">Linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/MFA/"><span class="tag">MFA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/NAS/"><span class="tag">NAS</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/PWA/"><span class="tag">PWA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E4%BB%A3%E7%90%86/"><span class="tag">ä»£ç†</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%8C%97%E6%BC%82/"><span class="tag">åŒ—æ¼‚</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/"><span class="tag">å•ç‚¹ç™»å½•</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%8F%8D%E6%8A%97/"><span class="tag">åæŠ—</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%A4%96%E8%AE%BE/"><span class="tag">å¤–è®¾</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%AE%B6%E5%BA%AD%E7%BD%91%E7%BB%9C/"><span class="tag">å®¶åº­ç½‘ç»œ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%AE%B6%E6%9C%89%E5%90%83%E8%B4%A7/"><span class="tag">å®¶æœ‰åƒè´§</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E5%BC%80%E5%8F%91/"><span class="tag">å¼€å‘</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E6%87%92%E7%8C%AB%E5%BE%AE%E6%9C%8D/"><span class="tag">æ‡’çŒ«å¾®æœ</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%EF%BC%88ES%EF%BC%89/"><span class="tag">æœç´¢å¼•æ“ï¼ˆESï¼‰</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E6%95%88%E7%8E%87/"><span class="tag">æ•ˆç‡</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E6%A2%A6/"><span class="tag">æ¢¦</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E6%B8%B8%E8%AE%B0/"><span class="tag">æ¸¸è®°</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E7%94%9F%E6%B4%BB/"><span class="tag">ç”Ÿæ´»</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E7%94%9F%E6%B4%BB%E5%B0%8F%E5%A6%99%E6%8B%9B/"><span class="tag">ç”Ÿæ´»å°å¦™æ‹›</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E7%94%B5%E5%AD%90%E6%9E%81%E5%AE%A2/"><span class="tag">ç”µå­æå®¢</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E7%A1%AC%E4%BB%B6%E4%B8%8E%E5%A4%96%E8%AE%BE/"><span class="tag">ç¡¬ä»¶ä¸å¤–è®¾</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E7%A7%9F%E6%88%BF/"><span class="tag">ç§Ÿæˆ¿</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E8%A3%85%E4%BF%AE%E6%97%A5%E8%AE%B0/"><span class="tag">è£…ä¿®æ—¥è®°</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E8%A3%85%E6%9C%BA/"><span class="tag">è£…æœº</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E8%AF%97/"><span class="tag">è¯—</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E8%AF%BB%E4%B9%A6/"><span class="tag">è¯»ä¹¦</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="../../tags/%E9%9A%8F%E7%AC%94/"><span class="tag">éšç¬”</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="../../index.html"><img src="../../img/favicon.svg" alt="é•œæ¹–" height="28"></a><p class="is-size-7"><span>&copy; 2025 Xu</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cloudsmithy/cloudsmithy.github.io"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="../../js/column.js"></script><script src="../../js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="../../js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script data-pjax src="../../js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="../../js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"../../content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>