---
title: Easysearch ç´¢å¼•å…³é—­ä¸é‡å¼€å…¨æ”»ç•¥ï¼šopen close æ“ä½œã€æ‰¹é‡å¤„ç†åŠé˜²è¯¯æ“ä½œé…ç½®
tags: æœç´¢å¼•æ“ï¼ˆESï¼‰
toc: true
categories: æé™ç§‘æŠ€
abbrlink: af48f3e
date: 2025-06-24 00:00:00
---

åœ¨ Easysearchï¼ˆå…¼å®¹ Elasticsearch çš„æœç´¢å¼•æ“ï¼‰ä¸­ï¼Œç´¢å¼•æ˜¯å­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸºæœ¬å•å…ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•æ˜¯å¤„äº `open` çŠ¶æ€çš„ï¼Œå¯ä»¥æ­£å¸¸å†™å…¥å’Œæœç´¢ã€‚å½“ä½ æš‚æ—¶ä¸ä½¿ç”¨æŸäº›ç´¢å¼•ï¼Œä½†åˆä¸æƒ³åˆ é™¤å®ƒä»¬æ—¶ï¼Œå¯ä»¥é€šè¿‡ `close` æ“ä½œæ¥å…³é—­ç´¢å¼•ï¼Œä»è€Œé‡Šæ”¾éƒ¨åˆ†å†…å­˜èµ„æºã€‚

---

## ğŸ“Š æŸ¥çœ‹ç´¢å¼•çŠ¶æ€

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰ç´¢å¼•çš„çŠ¶æ€ï¼š

```bash
GET _cat/indices?v
```

åˆ›å»ºä¸€ä¸ªç´¢å¼•å¹¶æ’å…¥æ•°æ®ï¼š

```bash
POST abc/_doc
{
  "a": 1
}
```

<!-- more -->

æ­¤æ—¶ä½ ä¼šçœ‹åˆ°ç´¢å¼• `abc` å·²åˆ›å»ºï¼Œå¹¶å¤„äº `open` çŠ¶æ€ï¼š

![ç´¢å¼• open çŠ¶æ€](https://i-blog.csdnimg.cn/img_convert/2aceb6d717390a7c8df6ac76c45b748d.png)

é»˜è®¤æ¯ä¸ªç´¢å¼•æœ‰ 1 ä¸ªä¸»åˆ†ç‰‡ã€1 ä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œä¸”ä¸ºå¯è¯»å†™çŠ¶æ€ã€‚

---

## ğŸ”’ å…³é—­ç´¢å¼•

å¦‚æœä½ æš‚æ—¶ä¸éœ€è¦æŸä¸ªç´¢å¼•ï¼Œåˆä¸å¸Œæœ›åˆ é™¤å®ƒï¼Œå¯ä»¥å°†å…¶å…³é—­ï¼š

```bash
POST abc/_close
```

è¿”å›ç»“æœï¼š

```json
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "indices": {
    "abc": {
      "closed": true
    }
  }
}
```

---

## ğŸš« å…³é—­åçš„è¡Œä¸ºé™åˆ¶

å…³é—­ç´¢å¼•åï¼Œä¸ä»…ä¸èƒ½å†™å…¥ï¼Œ**è¿æœç´¢éƒ½æ— æ³•è¿›è¡Œ**ã€‚

### ğŸ” æœç´¢å·²å…³é—­ç´¢å¼•ï¼ˆ403 é”™è¯¯ï¼‰

```bash
GET abc/_search
```

è¿”å›ï¼š

```json
{
  "error": {
    "type": "cluster_block_exception",
    "reason": "index [abc] blocked by: [FORBIDDEN/4/index closed];"
  },
  "status": 403
}
```

![å…³é—­åæœç´¢æŠ¥é”™](https://i-blog.csdnimg.cn/img_convert/f1edce36572eb74cd2a9e0fdb8a04223.png)

---

### ğŸ“ å†™å…¥å·²å…³é—­ç´¢å¼•ï¼ˆ400 é”™è¯¯ï¼‰

```bash
POST abc/_doc
{
  "a": 2
}
```

è¿”å›ï¼š

```json
{
  "error": {
    "type": "index_closed_exception",
    "reason": "closed",
    "index": "abc"
  },
  "status": 400
}
```

![å…³é—­åå†™å…¥æŠ¥é”™](https://i-blog.csdnimg.cn/img_convert/bbad6f804fbbdbc5b7849c2f3c34864d.png)

---

## âœ³ï¸ æ‰¹é‡å…³é—­ç´¢å¼•ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰

```bash
POST ab*,test/_close
```

è¿”å›ç»“æœï¼š

```json
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "indices": {
    "test": { "closed": true },
    "abd": { "closed": true },
    "abc": { "closed": true }
  }
}
```

![æ‰¹é‡å…³é—­æˆåŠŸ](https://i-blog.csdnimg.cn/img_convert/4448625bea11f429679f4ca32e28c2e0.png)

ç¡®è®¤ç´¢å¼•çŠ¶æ€ï¼š

```bash
GET _cat/indices?v
```

![ç´¢å¼•å·²å…³é—­](https://i-blog.csdnimg.cn/img_convert/8ce15dcd81a81351aab9dce010749dea.png)

---

## ğŸ”“ é‡æ–°æ‰“å¼€ç´¢å¼•

å½“éœ€è¦é‡æ–°å¯ç”¨è¿™äº›ç´¢å¼•æ—¶ï¼š

```bash
POST */_open
```

è¿”å›ï¼š

```json
{
  "acknowledged": true,
  "shards_acknowledged": true
}
```

![æ‰“å¼€ç´¢å¼•æˆåŠŸ](https://i-blog.csdnimg.cn/img_convert/b9fe797a08c2fb1b6bf183b04633c8a8.png)

---

## âš™ï¸ ç¦æ­¢å…³é—­ç´¢å¼•çš„é›†ç¾¤é…ç½®

æœ‰äº›åœºæ™¯ä¸­ï¼ˆå¦‚è¿è¥å¹³å°é˜²æ­¢è¯¯æ“ä½œï¼‰ï¼Œç®¡ç†å‘˜å¯èƒ½ä¼š**ç¦æ­¢ç´¢å¼•å…³é—­æ“ä½œ**ã€‚è®¾ç½®å¦‚ä¸‹ï¼š

```json
PUT _cluster/settings
{
  "persistent": {
    "cluster.indices.close.enable": false
  }
}
```

è¿”å›ç»“æœè¡¨ç¤ºè®¾ç½®å·²ç”Ÿæ•ˆï¼š

```json
{
  "acknowledged": true,
  "persistent": {
    "cluster": {
      "indices": {
        "close": {
          "enable": "false"
        }
      }
    }
  },
  "transient": {}
}
```

![è®¾ç½®ç¦æ­¢å…³é—­ç´¢å¼•](https://i-blog.csdnimg.cn/img_convert/a180ec9eea33c1a3027762d56a92fea8.png)

---

## ğŸ§¯ ç¦æ­¢åå…³é—­ç´¢å¼•ä¼šæŠ¥é”™

å†æ¬¡å°è¯•å…³é—­ç´¢å¼•æ—¶ï¼Œå°†è¿”å›å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š

```json
{
  "error": {
    "root_cause": [
      {
        "type": "illegal_state_exception",
        "reason": "closing indices is disabled - set [cluster.indices.close.enable: true] to enable it. NOTE: closed indices still consume a significant amount of diskspace"
      }
    ],
    "type": "illegal_state_exception",
    "reason": "closing indices is disabled - set [cluster.indices.close.enable: true] to enable it. NOTE: closed indices still consume a significant amount of diskspace"
  },
  "status": 500
}
```

---

## ğŸ” å¦‚ä½•ç¡®è®¤å…³é—­è¢«ç¦ç”¨ï¼Ÿ

æ‰§è¡Œï¼š

```bash
GET _cluster/settings
```

ç»“æœä¼šåŒ…å«ï¼š

```json
{
  "persistent": {
    "cluster": {
      "indices": {
        "close": {
          "enable": "false"
        }
      }
    },
    "index_state_management": {
      "template_migration": {
        "control": "-1"
      }
    },
    "rollup": {
      "search": {
        "enabled": "true"
      },
      "hours_before": "24"
    }
  },
  "transient": {}
}
```

---

## âœ… æ€»ç»“

| æ“ä½œ                   | æ˜¯å¦æ”¯æŒ                                      | æ¡ä»¶                                           |
| ---------------------- | --------------------------------------------- | ---------------------------------------------- |
| `POST /<index>/_close` | âœ… é»˜è®¤æ”¯æŒ                                   | é™¤éè®¾ç½® `cluster.indices.close.enable: false` |
| `POST /<index>/_open`  | âœ… æ€»æ˜¯æ”¯æŒ                                   | æ— éœ€é¢å¤–å¼€å¯                                   |
| `POST ab*/_close`      | âœ… æ”¯æŒæ‰¹é‡å…³é—­                               | åŒä¸Š                                           |
| æŸ¥çœ‹å…³é—­é™åˆ¶é…ç½®       | `GET _cluster/settings?include_defaults=true` |                                                |

å…³é—­ç´¢å¼•é€‚ç”¨äºèµ„æºæ§åˆ¶ã€è°ƒè¯•æ’æŸ¥ç­‰åœºæ™¯ï¼Œä½†è¦æ³¨æ„ï¼š**å…³é—­ç´¢å¼•ä»ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œä¸ä¼šé‡Šæ”¾å­˜å‚¨**ï¼Œä»…ä»…æ˜¯èŠ‚çœå†…å­˜å’Œ CPU èµ„æºã€‚
