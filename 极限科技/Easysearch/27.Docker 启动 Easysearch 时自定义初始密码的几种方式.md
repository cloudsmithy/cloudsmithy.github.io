---
title: Docker å¯åŠ¨ Easysearch æ—¶è‡ªå®šä¹‰åˆå§‹å¯†ç çš„å‡ ç§æ–¹å¼
tags: æœç´¢å¼•æ“ï¼ˆESï¼‰
toc: true
categories: æé™ç§‘æŠ€
abbrlink: 588b9d1d
date: 2025-10-05 00:00:00
---

åœ¨ä½¿ç”¨ Docker éƒ¨ç½² **Easysearch** æ—¶ï¼Œé€šå¸¸éœ€è¦åœ¨å¯åŠ¨å®¹å™¨æ—¶è®¾ç½®åˆå§‹ç®¡ç†å‘˜å¯†ç ã€‚å¦‚æœæ²¡æœ‰é¢„å…ˆè®¾ç½®å¯†ç ï¼Œç³»ç»Ÿå¯èƒ½ä¼šä½¿ç”¨é»˜è®¤å€¼æˆ–éšæœºç”Ÿæˆå¯†ç ï¼Œä¸ä»…å¢åŠ åç»­ç®¡ç†çš„å¤æ‚æ€§ï¼Œä¹Ÿå­˜åœ¨å®‰å…¨éšæ‚£ã€‚

æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»åœ¨ `docker run` å¯åŠ¨ Easysearch å®¹å™¨æ—¶ï¼Œé€šè¿‡ä¸åŒæ–¹å¼ä¼ å…¥ç¯å¢ƒå˜é‡ï¼ˆ`env`ï¼‰æ¥è‡ªå®šä¹‰å¯†ç çš„å¤šç§æ–¹æ³•ã€‚æ¯ç§æ–¹æ³•éƒ½é…æœ‰å®ç”¨ç¤ºä¾‹å’Œè¯´æ˜ï¼Œå¸®åŠ©ä½ æ ¹æ®å®é™…ç¯å¢ƒçµæ´»é€‰æ‹©ã€‚

  <!-- more -->

### ç›´æ¥åœ¨å‘½ä»¤ä¸­ä¼ å…¥å•ä¸ªç¯å¢ƒå˜é‡

è¿™æ˜¯æœ€ç®€å•ã€æœ€ç›´æ¥çš„æ–¹å¼ï¼Œé€‚åˆå¿«é€Ÿå¯åŠ¨æˆ–ä¸´æ—¶æµ‹è¯•åœºæ™¯ã€‚

```bash
docker run --name easysearch \
  -e EASYSEARCH_INITIAL_ADMIN_PASSWORD=passwd123 \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

å¯åŠ¨å®Œæˆåï¼Œå¯è¿›å…¥å®¹å™¨éªŒè¯å˜é‡æ˜¯å¦ç”Ÿæ•ˆï¼š

```bash
docker exec -it easysearch bash
echo $EASYSEARCH_INITIAL_ADMIN_PASSWORD
```

è¾“å‡ºç»“æœï¼š

```
passwd123
```

![image-20251005152811756](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20251005152811756.png)

è¿™ä¸ªæ˜¯åœ¨å®¹å™¨å†…éƒ¨æŸ¥çœ‹ ENV çš„ç»“æœï¼š

![image-20251005152846742](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20251005152846742.png)

âœ… **ä¼˜ç‚¹ï¼š**

- ç®€å•ç›´æ¥ï¼Œé€‚åˆæ‰‹åŠ¨è°ƒè¯•ï¼›
- ä¸éœ€è¦é¢å¤–æ–‡ä»¶ã€‚

âš ï¸ **ç¼ºç‚¹ï¼š**

- å¯†ç ä¼šæš´éœ²åœ¨å‘½ä»¤è¡Œå†å²ä¸­ï¼›
- ä¿®æ”¹ä¸ä¾¿ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚

### ğŸ—‚ äºŒã€ä»ç¯å¢ƒæ–‡ä»¶åŠ è½½ï¼ˆæ¨èï¼‰

å¦‚æœä½ éœ€è¦è®¾ç½®å¤šä¸ªå˜é‡æˆ–å¸Œæœ›æ›´å¥½åœ°ç®¡ç†é…ç½®ï¼Œå»ºè®®ä½¿ç”¨ `.env` æ–‡ä»¶ã€‚
è¿™ç§æ–¹å¼æ¸…æ™°ã€å®‰å…¨ã€æ˜“äºç»´æŠ¤ï¼Œæ˜¯ **æœ€æ¨èçš„åšæ³•**ã€‚

#### åˆ›å»º `.env` æ–‡ä»¶

åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»º `.env` æ–‡ä»¶ï¼š

```
EASYSEARCH_INITIAL_ADMIN_PASSWORD=envfile123
```

#### å¯åŠ¨å®¹å™¨ï¼š

```bash
docker run --name easysearch \
  --env-file .env \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

![image-20251005153637750](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20251005153637750.png)

éªŒè¯å˜é‡ï¼š

```bash
docker exec -it easysearch bash
echo $EASYSEARCH_INITIAL_ADMIN_PASSWORD
```

è¾“å‡ºï¼š

```
envfile123
```

![image-20251005154705982](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20251005154705982.png)

âœ… **ä¼˜ç‚¹ï¼š**

- ç¯å¢ƒå˜é‡é›†ä¸­ç®¡ç†ï¼›
- é¿å…æ˜æ–‡å¯†ç å‡ºç°åœ¨å‘½ä»¤è¡Œï¼›
- æ–‡ä»¶å¯å¤ç”¨ã€ä¾¿äºåä½œã€‚

âš ï¸ **æ³¨æ„äº‹é¡¹ï¼š**

- `.env` æ–‡ä»¶è·¯å¾„éœ€æ­£ç¡®ï¼ˆç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼‰ï¼›
- å˜é‡ä¸­å«æœ‰ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦æ—¶è¯·ç”¨å¼•å·åŒ…è£¹ï¼š

  ```
  EASYSEARCH_INITIAL_ADMIN_PASSWORD="P@ss word!123"
  ```

ğŸ’¡ **è¡¥å……è¯´æ˜ï¼š**

- åœ¨ **Docker Compose** ä¸­ï¼Œ`.env` æ–‡ä»¶ä¼šè‡ªåŠ¨è¯»å–ï¼›
- ä½¿ç”¨ `docker run` æ—¶ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®š `--env-file`ã€‚

### ğŸ’» ä¸‰ã€å¼•ç”¨å®¿ä¸»æœºç¯å¢ƒå˜é‡

å½“å®¿ä¸»æœºä¸Šå·²ç»å®šä¹‰äº†æŸäº›å˜é‡æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†å®ƒä»¬ä¼ é€’ç»™å®¹å™¨ã€‚
è¿™ç§æ–¹å¼éå¸¸é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬å’Œ CI/CD åœºæ™¯ã€‚

#### 1ï¸âƒ£ å¯¼å‡ºå®¿ä¸»æœºå˜é‡

```bash
export EASYSEARCH_INITIAL_ADMIN_PASSWORD=hostenv123
```

#### 2ï¸âƒ£ å¯åŠ¨å®¹å™¨æ—¶å¼•ç”¨

```bash
docker run -e EASYSEARCH_INITIAL_ADMIN_PASSWORD \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

æˆ–ï¼š

```bash
docker run --env EASYSEARCH_INITIAL_ADMIN_PASSWORD \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

![image-20251005153800103](https://raw.githubusercontent.com/cloudsmithy/picgo-imh/master/image-20251005153800103.png)

éªŒè¯å˜é‡ï¼š

```bash
docker exec -it easysearch bash
echo $EASYSEARCH_INITIAL_ADMIN_PASSWORD
```

è¾“å‡ºï¼š

```
hostenv123
```

âœ… **ä¼˜ç‚¹ï¼š**

- æ›´å®‰å…¨ï¼Œä¸ä¼šåœ¨å‘½ä»¤è¡Œä¸­æš´éœ²ï¼›
- é€‚ç”¨äº CI/CD ç¯å¢ƒå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

âš ï¸ **æ³¨æ„ï¼š**

- å¯åŠ¨å®¹å™¨å‰ç¡®è®¤å˜é‡å·²å¯¼å‡ºï¼›
- ä½¿ç”¨ `printenv` æŸ¥çœ‹å®¿ä¸»æœºå˜é‡ã€‚

### ğŸ”’ å››ã€ç”Ÿäº§çº§æ–¹æ¡ˆï¼šç»“åˆ Secret ç®¡ç†å·¥å…·

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä¸è¦ç›´æ¥åœ¨ `.env` æ–‡ä»¶æˆ–å‘½ä»¤è¡Œä¸­å­˜å‚¨å¯†ç ã€‚
å¯ä»¥ç»“åˆä»¥ä¸‹å·¥å…·æ¥å®‰å…¨åœ°ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼š

- **Docker Secrets**ï¼šåœ¨ Swarm æ¨¡å¼ä¸­å®‰å…¨æ³¨å…¥æ•æ„Ÿå€¼ï¼›
- **HashiCorp Vault / AWS Secrets Manager / Kubernetes Secrets**ï¼šé€šè¿‡å¤–éƒ¨å¯†é’¥æœåŠ¡åŠ¨æ€ä¼ é€’ï¼›
- **`.gitignore`**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸è¢«æäº¤åˆ°ä»£ç ä»“åº“ã€‚

### âš™ï¸ äº”ã€éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ

æ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
docker exec -it easysearch env | grep EASYSEARCH_INITIAL_ADMIN_PASSWORD
```

æˆ–ï¼š

```bash
docker inspect easysearch | grep EASYSEARCH_INITIAL_ADMIN_PASSWORD
```

è‹¥è¾“å‡ºåŒ…å«ä½ çš„å¯†ç å€¼ï¼Œå³è¡¨ç¤ºè®¾ç½®æˆåŠŸã€‚

### ğŸ§© å…­ã€ä¸åŒæ–¹å¼å¯¹æ¯”

| æ–¹å¼           | é€‚ç”¨åœºæ™¯   | å®‰å…¨æ€§   | ä¾¿åˆ©æ€§   | æ˜¯å¦æ¨è |
| -------------- | ---------- | -------- | -------- | -------- |
| å‘½ä»¤è¡Œç›´æ¥ä¼ å…¥ | å¿«é€Ÿæµ‹è¯•   | â­       | â­â­â­   | âŒ       |
| `.env` æ–‡ä»¶    | å¼€å‘/æµ‹è¯•  | â­â­     | â­â­â­â­ | âœ…       |
| å®¿ä¸»æœºå˜é‡     | è‡ªåŠ¨åŒ–éƒ¨ç½² | â­â­â­   | â­â­â­   | âœ…       |
| Secret å·¥å…·    | ç”Ÿäº§ç¯å¢ƒ   | â­â­â­â­ | â­â­     | âœ…âœ…âœ…   |

### ğŸ“¦ ä¸ƒã€ç»¼åˆç¤ºä¾‹ï¼šå¤šå˜é‡ + é»˜è®¤å€¼

å‡è®¾æˆ‘ä»¬è¦åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼Œå¹¶å®šä¹‰å¤šä¸ªå‚æ•°ï¼š

`.env` æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```
EASYSEARCH_INITIAL_ADMIN_PASSWORD=${EASYSEARCH_PASS:-default123}
EASYSEARCH_CLUSTER_NAME=prod_cluster
EASYSEARCH_HEAP_SIZE=4g
```

å¯åŠ¨å‘½ä»¤ï¼š

```bash
EASYSEARCH_PASS=SuperSecret123 \
docker run --name easysearch-prod \
  --env-file .env \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

æ­¤æ—¶ï¼š

- è‹¥å¤–éƒ¨å®šä¹‰äº† `EASYSEARCH_PASS`ï¼Œåˆ™ä½¿ç”¨è¯¥å€¼ï¼›
- å¦åˆ™å›é€€åˆ° `.env` æ–‡ä»¶ä¸­çš„é»˜è®¤å€¼ `default123`ã€‚

### ğŸ§­ æ€»ç»“

åœ¨ Docker ç¯å¢ƒä¸­é…ç½® Easysearch åˆå§‹å¯†ç çš„å¸¸ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼š

1. **å‘½ä»¤è¡Œä¼ å…¥ï¼ˆ-eï¼‰**ï¼šé€‚åˆå¿«é€Ÿæµ‹è¯•ï¼›
2. **ç¯å¢ƒæ–‡ä»¶ï¼ˆ--env-fileï¼‰**ï¼šç®¡ç†æ–¹ä¾¿ã€æœ€æ¨èï¼›
3. **å¼•ç”¨å®¿ä¸»æœºå˜é‡**ï¼šå®‰å…¨çµæ´»ï¼Œé€‚åˆ CI/CDã€‚

> ğŸš€ **æœ€ä½³å®è·µå»ºè®®ï¼š**
>
> - å¼€å‘ç¯å¢ƒä½¿ç”¨ `.env` æ–‡ä»¶ï¼›
> - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Secret ç®¡ç†ï¼›
> - å°† `.env` æ–‡ä»¶åŠ å…¥ `.gitignore`ï¼›
> - å®šæœŸè½®æ¢å¯†ç ï¼Œç¡®ä¿å®‰å…¨ã€‚

**å‚è€ƒå‘½ä»¤ï¼š**

```bash
docker run --name easysearch \
  -e EASYSEARCH_INITIAL_ADMIN_PASSWORD=passwd123 \
  --ulimit memlock=-1:-1 \
  -p 9200:9200 \
  infinilabs/easysearch:1.15.3
```

```bash
version: "3.3"
services:
  easysearch:
    restart: always
    image: registry.lazycat.cloud/u04123229/infinilabs/easysearch:5dc6296f5370aacc
    ports:
      - 9200:9200
    environment:
      - EASYSEARCH_INITIAL_ADMIN_PASSWORD=admin123
networks: {}ÃŸ
```
