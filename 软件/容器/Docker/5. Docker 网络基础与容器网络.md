### Docker 网络基础与容器网络

在本节课程中，我们将探讨 Docker 的网络基本概念。Docker 的网络配置有很多不同的方式，而容器如何与外部世界进行交互，也是 Docker 的一个核心部分。

#### Docker 网络基础

Docker 默认使用**桥接网络**（bridge network）。当我们启动一个容器时，如果没有指定网络，Docker 会将容器加入到默认的桥接网络中。容器与宿主机的网络有隔离，但它们能够互相访问。

Docker 提供了几种不同的网络类型，我们将介绍其中三种：

1. **桥接网络（bridge network）**
2. **主机网络（host network）**
3. **无网络（none network）**

#### 使用桥接网络

首先，我们使用一个基于 Ubuntu 16.04 的镜像，并在其上安装一些网络工具。通过构建一个简单的 Web 应用程序，我们将容器设置为可以访问网络并与外部进行通信。

##### Dockerfile 示例：

```Dockerfile
FROM ubuntu:16.04
RUN apt-get update && apt-get install -y iputils-ping arp-scan
COPY webapp /webapp
CMD ["/bin/bash"]
```

此 Dockerfile 首先从 Ubuntu 16.04 开始，然后安装了一些网络工具（如 ping 和 arp-scan）。最后，它会将`webapp`二进制文件复制到容器中，并设置`/bin/bash`为默认命令。

##### 运行容器

在构建镜像后，我们启动一个容器，并查看其网络接口。容器默认会分配一个 IP 地址，并且可以进行网络通信。

```bash
docker run -it ubuntu_networking /bin/bash
```

进入容器后，我们可以通过命令查看网络接口（如 eth0），并能够使用`ping`测试连接。

```bash
ping google.com
```

容器内的网络访问已经配置好，我们可以通过宿主机的 IP 与容器进行通信。使用以下命令查看所有容器并验证它们是否正常运行。

```bash
docker ps -a
```

##### 使用 ARP 扫描工具查看网络

我们还可以使用`arp-scan`工具来查看同一网络中的其他容器，并验证它们是否能够互相通信。

#### 使用主机网络（host network）

主机网络允许容器直接使用宿主机的网络接口。这意味着容器暴露的端口会直接绑定到宿主机的端口。我们可以通过指定`--network host`来运行容器。

```bash
docker run -d --network host ubuntu_networking
```

此时，容器不会获得自己的 IP 地址，而是直接使用宿主机的网络接口。我们可以通过访问宿主机的端口来与容器进行交互。

#### 使用无网络（none network）

`none`网络配置表示容器没有任何网络连接，它只能与自己进行通信，无法访问外部网络。启动一个使用`none`网络的容器，查看其网络接口，只有`lo`接口（本地回环接口）可用，无法访问外部网络。

```bash
docker run --network none ubuntu_networking /bin/bash
```

此时容器无法与外部网络通信，尝试 ping 外部站点会失败。

#### 总结

1. **桥接网络（bridge）**：默认网络类型，容器与宿主机有隔离但可以相互通信。
2. **主机网络（host）**：容器与宿主机共享网络接口，端口直接绑定。
3. **无网络（none）**：容器没有网络连接，无法访问外部世界。

Docker 的网络系统非常灵活，可以根据不同的需求来选择合适的网络类型。在更复杂的使用场景中，你还可以创建自定义网络来实现更精细的控制。网络是 Docker 容器与外界交互的重要部分，理解这些基本网络配置对高效使用 Docker 至关重要。
